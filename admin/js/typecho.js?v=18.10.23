function scrollableEditor(x,y){var A=x.css(),E=x.width(),v=null,q=[],D=[],d=[],k={display:"block",position:"absolute",left:"-99999px",top:"-99999px"},b=$("<div></div>").appendTo(document.body),B=!1;for(var j in A){j.match(/^(direction|font-family|font-size|font-style|font-weight|letter-spacing|line-height|text-align|vertical-align|white-space|word-wrap|word-break|word-spacing)$/i)&&(k[j]=A[j])}function C(c){var a=x.val().split("\n"),g=0;b.width(x.width()),D=[];for(var f=0;f<a.length;f++){b.text(a[f]),g+=b.height(),D.push(g)}b.html(""),function(l){var h=0;d=[],q=[],$(".line",y).each(function(){var s=$(this),m=s.data("start"),G=s.data("end"),u=s.data("start-original"),p=s.position().top+y.scrollTop();d.push([m,G,p,this]),void 0!==u?(q.push([m,u-1,D[u-1],h,0]),q.push([u,G,D[G],D[u-1],1])):q.push([m,G,D[G],h,1]),h=D[G]});var i=z();l?null!==i&&w(i):w()}(c)}function w(I){var N=x.height(),m=(x.innerHeight()-N)/2,h=x.scrollTop()-m,g=y.scrollTop(),L=0,G=0,p=null;if(void 0===I){for(var K=0;K<q.length;K++){if(h<=(p=q[K])[2]){L=(h-p[3])*p[4]/(p[2]-p[3]);break}}if(p){for(var O=0;O<d.length;O++){H=d[O];if(p[0]>=H[0]&&p[1]<=H[1]){var M=d[O+1]?d[O+1][2]:y.get(0).scrollHeight,G=(0==K?0:H[2])+(M-H[2])*L;y.scrollTop(G);break}}}}else{for(var H,J=0;J<d.length;J++){if(I>=(H=d[J])[0]&&I<=H[1]){(J==d.length-1||H[2]<g||d[J+1][2]>g+y.height())&&y.scrollTop(H[2]);break}}}}function F(c){var a=$(c),f=a.parent();return 0<a.length&&a.prop("tagName").match(/^(hr|tr)$/i)?a:0<f.length&&"div"==f.prop("tagName").toLowerCase()?a.next():f}function z(){var l=x.val(),g=x.getSelection().start,p=0,m=0,h=null;if(!B){return h}for(;0<=(p=l.indexOf("\n",p))&&p<g;){m++,p+=1}for(var c=0;c<d.length;c++){var f=d[c];if(m>=f[0]&&m<=f[1]){F(v).removeClass("focus"),F(f[3]).addClass("focus"),v=f[3],h=m;break}}return h}return b.css(k),b.css("min-height",k["line-height"]),setInterval(function(){x.width()!=E&&(E=x.width(),x.trigger("resize"))},150),x.on("touch keypress click",z),x.on("focus",function(){B=!0}).on("blur",function(){B=!1,F(v).removeClass("focus")}),x.on("resize",C),x.on("DOMMouseScroll mousewheel touchmove",function(){w()}),y.on("DOMMouseScroll mousewheel touchmove",function(){!function(){var u,I=x.height(),h=(x.innerHeight()-I)/2,g=y.scrollTop(),f=!1;if(!(d.length<=0)){for(var H=0;H<d.length;H++){if(g<d[H][2]){f=!0;break}}var p=0<(u=f?d[0<H?H-1:0]:d[d.length-1])[0]?D[u[0]-1]:0,m=D[u[1]],G=f?d[0<H?H:1][2]:y.get(0).scrollHeight,J=(g-u[2])/(G-u[2]);x.scrollTop(p+(m-p)*J+h)}}()}),C}window.Typecho={insertFileToEditor:function(b,a,c){},uploadFile:function(a){},editorResize:function(b,a){$("#"+b).resizeable({minHeight:100,afterResize:function(c){$.post(a,{size:c})}})},uploadComplete:function(a){}},function(a){a.fn.dropdownMenu=function(b){this.each(function(){var d=this,c=a.extend({menuEl:null,btnEl:null},b);a(c.btnEl,d).click(function(){return a(this).toggleClass("active"),a(c.menuEl,d).toggle(),!1})})},a.fn.resizeable=function(c){var b=a.extend({minHeight:100,afterResize:null},c);return this.each(function(){var k,j=a('<span class="resize"><i></i></span>').insertAfter(this),h=0,f=b.minHeight,p=this;function g(l){var i=m(l).y,o=k+i;return i<=h&&(o-=5),h=i,o=Math.max(f,o),textarea.height(o+"px"),o<f&&d(),!1}function d(l){var i=textarea.outerHeight();a(document).unbind("mousemove",g).unbind("mouseup",d),textarea.css("opacity",1),textarea.focus(),textarea=null,k=null,h=0,b.afterResize&&b.afterResize.call(p,i)}function m(i){return{x:i.clientX+document.documentElement.scrollLeft,y:i.clientY+document.documentElement.scrollTop}}j.bind("mousedown",{el:this},function(i){return textarea=a(i.data.el),textarea.blur(),h=m(i).y,k=textarea.height()-h,textarea.css("opacity",0.25),a(document).mousemove(g).mouseup(d),!1})})},a.fn.tableSelectable=function(c){var f=this,d=a.extend({checkEl:null,rowEl:null,selectAllEl:null,actionEl:null},c);function b(h){var h=a(h),g=a(d.checkEl,h),i=g.prop("checked");g.length&&(g.prop("checked",!i),i?h.removeClass("checked"):h.addClass("checked"))}a(d.rowEl,this).each(function(){a(d.checkEl,this).click(function(g){b(a(this).parents(d.rowEl))})}).click(function(h){var g=a(h.toElement?h.toElement:h.target),i=g.prop("tagName").toLowerCase();0<=a.inArray(i,["input","textarea","a","button","i"])&&"checkbox"!=g.attr("type")?h.stopPropagation():b(this)}),a(d.selectAllEl).click(function(){a(this).prop("checked")?a(d.rowEl,f).each(function(){var g=a(this);0<a(d.checkEl,this).prop("checked",!0).length&&g.addClass("checked")}):a(d.rowEl,f).each(function(){var g=a(this);0<a(d.checkEl,this).prop("checked",!1).length&&g.removeClass("checked")})}),a(d.actionEl).click(function(){var h=a(this),g=h.attr("lang");return g&&!confirm(g)||f.parents("form").attr("action",h.attr("href")).submit(),!1})}}($),function(a){a.tableDnD={currentTable:null,dragObject:null,mouseOffset:null,oldY:0,build:function(b){return b=b||{},this.each(function(){var g,d,i,h,f,c;this.tableDnDConfig={onDragStyle:b.onDragStyle,onDropStyle:b.onDropStyle,onDragClass:b.onDragClass?b.onDragClass:"tDnD_whileDrag",onDrop:b.onDrop,onDragStart:b.onDragStart,scrollAmount:b.scrollAmount?b.scrollAmount:5},a.tableDnD.makeDraggable(this),0==$("tfoot",this).length&&0<$("thead",this).length&&(g=$("thead",this),d=$("th",g).length,i=$('<tfoot><tr><td style="padding:0;height:0;line-height:0;border:none" colspan="'+d+'"></td></tr></tfoot>').insertAfter(g),"tfoot"!=(h=$("tr:last",this)).parent().prop("tagName").toLowerCase()&&(c=(f=$("td",h)).height(),f.height(c-i.outerHeight())))}),a(document).bind("mousemove",a.tableDnD.mousemove).bind("mouseup",a.tableDnD.mouseup),this},makeDraggable:function(b){for(var c=b.rows,f=b.tableDnDConfig,d=0;d<c.length;d++){$(c[d]).hasClass("nodrag")||a(c[d]).mousedown(function(g){if("TD"==g.target.tagName){return a.tableDnD.dragObject=this,a.tableDnD.currentTable=b,a.tableDnD.mouseOffset=a.tableDnD.getMouseOffset(this,g),f.onDragStart&&f.onDragStart(b,this),!1}}).css("cursor","move")}},mouseCoords:function(b){return b.pageX||b.pageY?{x:b.pageX,y:b.pageY}:{x:b.clientX+document.body.scrollLeft-document.body.clientLeft,y:b.clientY+document.body.scrollTop-document.body.clientTop}},getMouseOffset:function(c,b){b=b||window.event;var f=this.getPosition(c),d=this.mouseCoords(b);return{x:d.x-f.x,y:d.y-f.y}},getPosition:function(c){var b=0,d=0;for(0==c.offsetHeight&&(c=c.firstChild);c.offsetParent;){b+=c.offsetLeft,d+=c.offsetTop,c=c.offsetParent}return{x:b+=c.offsetLeft,y:d+=c.offsetTop}},mousemove:function(h){if(null!=a.tableDnD.dragObject){var f,k,j=a(a.tableDnD.dragObject),g=a.tableDnD.currentTable.tableDnDConfig,c=a.tableDnD.mouseCoords(h),d=c.y-a.tableDnD.mouseOffset.y,b=window.pageYOffset;return document.all&&(void 0!==document.compatMode&&"BackCompat"!=document.compatMode?b=document.documentElement.scrollTop:void 0!==document.body&&(b=document.body.scrollTop)),c.y-b<g.scrollAmount?window.scrollBy(0,-g.scrollAmount):(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight)-(c.y-b)<g.scrollAmount&&window.scrollBy(0,g.scrollAmount),d!=a.tableDnD.oldY&&(f=d>a.tableDnD.oldY,a.tableDnD.oldY=d,g.onDragClass?j.addClass(g.onDragClass):j.css(g.onDragStyle),(k=a.tableDnD.findDropTargetRow(j,d))&&(f&&a.tableDnD.dragObject!=k?a.tableDnD.dragObject.parentNode.insertBefore(a.tableDnD.dragObject,k.nextSibling):f||a.tableDnD.dragObject==k||a.tableDnD.dragObject.parentNode.insertBefore(a.tableDnD.dragObject,k))),!1}},findDropTargetRow:function(h,f){for(var k=a.tableDnD.currentTable.rows,j=0;j<k.length;j++){var g=k[j],c=this.getPosition(g).y,d=parseInt(g.offsetHeight)/2;if(0==g.offsetHeight&&(c=this.getPosition(g.firstChild).y,d=parseInt(g.firstChild.offsetHeight)/2),c-d<f&&f<c+d){if(g==h){return null}var b=a.tableDnD.currentTable.tableDnDConfig;return b.onAllowDrop?b.onAllowDrop(h,g)?g:null:$(g).hasClass("nodrop")?null:g}}return null},mouseup:function(c){var b,d;a.tableDnD.currentTable&&a.tableDnD.dragObject&&(b=a.tableDnD.dragObject,(d=a.tableDnD.currentTable.tableDnDConfig).onDragClass?a(b).removeClass(d.onDragClass):a(b).css(d.onDropStyle),a.tableDnD.dragObject=null,d.onDrop&&d.onDrop(a.tableDnD.currentTable,b),a.tableDnD.currentTable=null)},serialize:function(){if(a.tableDnD.currentTable){for(var c="",b=a.tableDnD.currentTable.id,f=a.tableDnD.currentTable.rows,d=0;d<f.length;d++){0<c.length&&(c+="&"),c+=b+"[]="+f[d].id}return c}return"Error: No Table id set, you need to set an id on your table and every row"}},a.fn.extend({tableDnD:a.tableDnD.build})}($),function(a){var g,f,b,c=(f=document.createElement("input"),b="onpaste",f.setAttribute(b,""),("function"==typeof f[b]?"paste":"input")+".mask"),i=navigator.userAgent,d=/iphone/i.test(i),h=/android/i.test(i);a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},a.fn.extend({caret:function(k,j){var l;if(0!==this.length&&!this.is(":hidden")){return"number"==typeof k?(j="number"==typeof j?j:k,this.each(function(){this.setSelectionRange?this.setSelectionRange(k,j):this.createTextRange&&((l=this.createTextRange()).collapse(!0),l.moveEnd("character",j),l.moveStart("character",k),l.select())})):(this[0].setSelectionRange?(k=this[0].selectionStart,j=this[0].selectionEnd):document.selection&&document.selection.createRange&&(l=document.selection.createRange(),k=0-l.duplicate().moveStart("character",-100000),j=k+l.text.length),{begin:k,end:j})}},unmask:function(){return this.trigger("unmask")},mask:function(k,l){var r,o,j,q,e;return !k&&0<this.length?a(this[0]).data(a.mask.dataName)():(l=a.extend({placeholder:a.mask.placeholder,completed:null},l),r=a.mask.definitions,o=[],j=e=k.length,q=null,a.each(k.split(""),function(n,m){"?"==m?(e--,j=n):r[m]?(o.push(new RegExp(r[m])),null===q&&(q=o.length-1)):o.push(null)}),this.trigger("unmask").each(function(){var t=a(this),n=a.map(k.split(""),function(u,s){if("?"!=u){return r[u]?l.placeholder:u}}),m=t.val();function y(s){for(;++s<e&&!o[s];){}return s}function v(u,s){var A,z;if(!(u<0)){for(A=u,z=y(s);A<e;A++){if(o[A]){if(!(z<e&&o[A].test(n[z]))){break}n[A]=n[z],n[z]=l.placeholder,z=y(z)}}w(),t.caret(Math.max(q,u))}}function p(u,s){for(var z=u;z<s&&z<e;z++){o[z]&&(n[z]=l.placeholder)}}function w(){t.val(n.join(""))}function x(z){var s,B=t.val(),A=-1,u=0;for(pos=0;u<e;u++){if(o[u]){for(n[u]=l.placeholder;pos++<B.length;){if(s=B.charAt(pos-1),o[u].test(s)){n[u]=s,A=u;break}}if(pos>B.length){break}}else{n[u]===B.charAt(pos)&&u!==j&&(pos++,A=u)}}return z?w():A+1<j?(t.val(""),p(0,e)):(w(),t.val(t.val().substring(0,A+1))),j?u:q}t.data(a.mask.dataName,function(){return a.map(n,function(u,s){return o[s]&&u!=l.placeholder?u:null}).join("")}),t.attr("readonly")||t.one("unmask",function(){t.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){var s;clearTimeout(g),m=t.val(),s=x(),g=setTimeout(function(){w(),s==k.length?t.caret(0,s):t.caret(s)},10)}).bind("blur.mask",function(){x(),t.val()!=m&&t.change()}).bind("keydown.mask",function(z){var s,B,A,u=z.which;8===u||46===u||d&&127===u?(B=(s=t.caret()).begin,(A=s.end)-B==0&&(B=46!==u?function(C){for(;0<=--C&&!o[C];){}return C}(B):A=y(B-1),A=46===u?y(A):A),p(B,A),v(B,A-1),z.preventDefault()):27==u&&(t.val(m),t.caret(0,x()),z.preventDefault())}).bind("keypress.mask",function(A){var u,C,B,z=A.which,s=t.caret();A.ctrlKey||A.altKey||A.metaKey||z<32||z&&(s.end-s.begin!=0&&(p(s.begin,s.end),v(s.begin,s.end-1)),(u=y(s.begin-1))<e&&(C=String.fromCharCode(z),o[u].test(C)&&(function(F){for(var D,H,G=F,E=l.placeholder;G<e;G++){if(o[G]){if(D=y(G),H=n[G],n[G]=E,!(D<e&&o[D].test(H))){break}E=H}}}(u),n[u]=C,w(),B=y(u),h?setTimeout(a.proxy(a.fn.caret,t,B),0):t.caret(B),l.completed&&e<=B&&l.completed.call(t))),A.preventDefault())}).bind(c,function(){setTimeout(function(){var s=x(!0);t.caret(s),l.completed&&s==t.val().length&&l.completed.call(t)},0)}),x()}))}})}(jQuery),jQuery.fn.extend({getSelection:function(){var a=this.get(0);return a?(("selectionStart" in a?function(){var b=a.selectionEnd-a.selectionStart;return{start:a.selectionStart,end:a.selectionEnd,length:b,text:a.value.substr(a.selectionStart,b)}}:window.getSelection()&&function(){var b=window.getSelection().getRangeAt(0);return{start:b.startOffset,end:b.endOffset,length:b.endOffset-b.startOffset,text:b.toString()}})||document.selection&&function(){a.focus();var c=document.selection.createRange();if(null===c){return{start:0,end:a.value.length,length:0}}var b=a.createTextRange(),d=b.duplicate();return b.moveToBookmark(c.getBookmark()),d.setEndPoint("EndToStart",b),{start:d.text.length,end:d.text.length+c.text.length,length:c.text.length,text:c.text}}||function(){return null})():null},setSelection:function(b,a){var d,c=this.get(0);c&&(c.setSelectionRange?(c.focus(),c.setSelectionRange(b,a)):c.createTextRange&&((d=c.createTextRange()).collapse(!0),d.moveEnd("character",a),d.moveStart("character",b),d.select()))},replaceSelection:function(){var b=this.get(0);if(!b){return null}var a=arguments[0]||"";return(("selectionStart" in b?function(){return b.value=b.value.substr(0,b.selectionStart)+a+b.value.substr(b.selectionEnd,b.value.length),this}:document.selection&&function(){return b.focus(),document.selection.createRange().text=a,this})||function(){return b.value+=a,jQuery(b)})()}}),jQuery.cookie=function(g,d,j){var h,f;if(1<arguments.length&&"[object Object]"!==String(d)){return j=jQuery.extend({},j),null==d&&(j.expires=-1),"number"==typeof j.expires&&(h=j.expires,(f=j.expires=new Date).setDate(f.getDate()+h)),d=String(d),document.cookie=[encodeURIComponent(g),"=",j.raw?d:encodeURIComponent(d),j.expires?"; expires="+j.expires.toUTCString():"",j.path?"; path="+j.path:"",j.domain?"; domain="+j.domain:"",j.secure?"; secure":""].join("")}var b,c=(j=d||{}).raw?function(a){return a}:decodeURIComponent;return(b=new RegExp("(?:^|; )"+encodeURIComponent(g)+"=([^;]*)").exec(document.cookie))?c(b[1]):null},function(a){var c=a.scrollTo=function(f,d,g){a(window).scrollTo(f,d,g)};function b(d){return"object"==typeof d?d:{top:d,left:d}}c.defaults={axis:"xy",duration:1.3<=parseFloat(a.fn.jquery)?0:1,limit:!0},c.window=function(d){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var f=this;if(!(!f.nodeName||-1!=a.inArray(f.nodeName.toLowerCase(),["iframe","#document","html","body"]))){return f}var d=(f.contentWindow||f).document||f.ownerDocument||f;return/webkit/i.test(navigator.userAgent)||"BackCompat"==d.compatMode?d.body:d.documentElement})},a.fn.scrollTo=function(e,f,d){return"object"==typeof f&&(d=f,f=0),"function"==typeof d&&(d={onAfter:d}),"max"==e&&(e=9000000000),d=a.extend({},c.defaults,d),f=f||d.duration,d.queue=d.queue&&1<d.axis.length,d.queue&&(f/=2),d.offset=b(d.offset),d.over=b(d.over),this._scrollable().each(function(){if(null!=e){var o,k=this,i=a(k),m=e,n={},j=i.is("html,body");switch(typeof m){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(m)){m=b(m);break}if(!(m=a(m,this)).length){return}case"object":(m.is||m.style)&&(o=(m=a(m)).offset())}a.each(d.axis.split(""),function(u,q){var w,v="x"==q?"Left":"Top",s=v.toLowerCase(),h="scroll"+v,p=k[h],g=c.max(k,q);o?(n[h]=o[s]+(j?0:p-i.offset()[s]),d.margin&&(n[h]-=parseInt(m.css("margin"+v))||0,n[h]-=parseInt(m.css("border"+v+"Width"))||0),n[h]+=d.offset[s]||0,d.over[s]&&(n[h]+=m["x"==q?"width":"height"]()*d.over[s])):(w=m[s],n[h]=w.slice&&"%"==w.slice(-1)?parseFloat(w)/100*g:w),d.limit&&/^\d+$/.test(n[h])&&(n[h]=n[h]<=0?0:Math.min(n[h],g)),!u&&d.queue&&(p!=n[h]&&l(d.onAfterFirst),delete n[h])}),l(d.onAfter)}function l(g){i.animate(n,f,d.easing,g&&function(){g.call(this,e,d)})}}).end()},c.max=function(j,g){var l="x"==g?"Width":"Height",k="scroll"+l;if(!a(j).is("html,body")){return j[k]-a(j)[l.toLowerCase()]()}var h="client"+l,d=j.ownerDocument.documentElement,f=j.ownerDocument.body;return Math.max(d[k],f[k])-Math.min(d[h],f[h])}}(jQuery),jQuery.fn.css2=jQuery.fn.css,jQuery.fn.css=function(){if(arguments.length){return jQuery.fn.css2.apply(this,arguments)}for(var b=["font-family","font-size","font-weight","font-style","color","box-sizing","text-transform","text-decoration","letter-spacing","box-shadow","line-height","text-align","vertical-align","direction","background-color","background-image","background-repeat","background-position","background-attachment","opacity","width","height","top","right","bottom","left","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","border-top-width","border-right-width","border-bottom-width","border-left-width","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","position","display","visibility","z-index","overflow-x","overflow-y","white-space","clip","float","clear","cursor","list-style-image","list-style-position","list-style-type","marker-offset","word-wrap","word-break","word-spacing"],a=b.length,d={},c=0;c<a;c++){d[b[c]]=jQuery.fn.css2.call(this,b[c])}return d};