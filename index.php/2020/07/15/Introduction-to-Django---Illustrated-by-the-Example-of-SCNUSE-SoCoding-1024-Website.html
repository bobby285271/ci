
<!DOCTYPE HTML>
<html class="no-js bg" lang="zh-cmn-Hans">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<meta charset="UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">

<meta name="renderer" content="webkit">

<meta name="theme-color" content="#3a3f51" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<title>Introduction to Django - Illustrated by the Example of SCNUSE SoCoding 1024 Website - Dasyatis</title>
<link rel="icon" type="image/ico" href="https://bobby285271.coding.net/p/img/d/img/git/raw/master/favicon.ico">
<meta name="description" content="好久没有出文章了，尝试再造一遍 2019 年 SCNUSE 软协 1024 程序员节活动网站（尽量还原，会有一些差别），算是 Django 框架的一个学习项目吧，搞不好把题目换掉就是今年活动网站..." />
<meta name="keywords" content="SCNU,Python,Guide,HTML,Django" />
<meta name="generator" content="Typecho 1.2/18.10.23" />
<meta name="template" content="handsome" />
<link rel="alternate" type="application/rss+xml" title="Introduction to Django - Illustrated by the Example of SCNUSE SoCoding 1024 Website &raquo; Dasyatis &raquo; RSS 2.0" href="../../../feed/2020/07/15/Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html" />
<link rel="alternate" type="application/rdf+xml" title="Introduction to Django - Illustrated by the Example of SCNUSE SoCoding 1024 Website &raquo; Dasyatis &raquo; RSS 1.0" href="../../../feed/rss/2020/07/15/Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html" />
<link rel="alternate" type="application/atom+xml" title="Introduction to Django - Illustrated by the Example of SCNUSE SoCoding 1024 Website &raquo; Dasyatis &raquo; ATOM 1.0" href="../../../feed/atom/2020/07/15/Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html" />
<script type="text/x-mathjax-config">
        MathJax.Hub.Config({messageStyle: "none",tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>

<link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="../../../../usr/themes/handsome/assets/css/function.min.css%3Fv=6.0.020191205.css" type="text/css" />
<link rel="stylesheet" href="../../../../usr/themes/handsome/assets/css/handsome.min.css%3Fv=6.0.020191205.css" type="text/css" />

<link rel="stylesheet" href="../../../../usr/themes/handsome/assets/css/features/jquery.fancybox.min.css%3Fv=6.0.020191205.css" type="text/css" />
<link rel="stylesheet" href="../../../../usr/themes/handsome/assets/css/features/code/vs.min.css%3Fv=6.0.020191205.css" type="text/css" />

<link rel="stylesheet" href="../../../../usr/themes/handsome/assets/css/font.min.css%3Fv=6.0.020191205.css" type="text/css" />
<style type="text/css">
        
        html.bg {
        background: #EFEFEF
        }
        .cool-transparent .off-screen+* .app-content-body {
        background: #EFEFEF
        }
@media (max-width:767px){
    html.bg {
        background: #EFEFEF
        }
        .cool-transparent .off-screen+* .app-content-body {
        background: #EFEFEF
        }
}
#post-panel .blog-post .single-post .item-thumb {
    background-position: 50% 35%;
}#aside .wrapper:hover {
	background: url(../../../../usr/themes/handsome/assets/img/snow.gif);
	background-size: cover;
	color: #999;
}    </style>

<script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js" type="6b677945121e6806c012d3d9-text/javascript"></script>

<script src="../../../../usr/themes/handsome/assets/js/features/fancyMorph.min.js" type="6b677945121e6806c012d3d9-text/javascript"></script>
</head>
<body id="body" class="fix-padding">

<div id="alllayout" class="app app-aside-fix container app-header-fixed "> 
<header id="header" class="fix-padding app-header navbar box-shadow-bottom-lg" role="menu">

<div class="text-ellipsis navbar-header bg-white">
<button class="pull-right visible-xs" ui-toggle-class="show animated animated-lento fadeIn" target=".navbar-collapse">
<span class="menu-icons"><i data-feather="search"></i></span>
</button>
<button class="pull-left visible-xs" ui-toggle-class="off-screen animated" target=".app-aside" ui-scroll="app">
<span class="menu-icons"><i data-feather="menu"></i></span>
</button>

<a href="../../../../index.html" class="navbar-brand text-lt">
<i class="fontello fontello-home"></i>
<span class="hidden-folded m-l-xs">Dasyatis</span>
</a>

</div>


<div class="collapse pos-rlt navbar-collapse bg-white">

<form id="searchform1" class="searchform navbar-form navbar-form-sm navbar-left shift" method="post" role="search">
<div class="form-group">
<div class="input-group rounded bg-white-pure box-shadow-wrap-normal">
<input autocomplete="off" id="search_input" type="search" name="s" class="transparent rounded form-control input-sm no-borders padder" required placeholder="输入关键词搜索…">

<ul id="search_tips_drop" class="small-scroll-bar dropdown-menu hide" style="display: block;top: 
                30px; left: 0px;">
</ul>
<span id="search_submit" class="transparent input-group-btn">
<button type="submit" class="transparent btn btn-sm">
<span class="feathericons" id="icon-search"><i data-feather="search"></i></span>
<span class="feathericons animate-spin  hide" id="spin-search"><i data-feather="loader"></i></span>


</button>
</span>
</div>
</div>
</form>
<a href="Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html" style="display: none" id="searchUrl"></a>

<ul class="nav navbar-nav navbar-right">
<li class="music-box hidden-xs hidden-sm">
<div id="skPlayer"></div>
</li>
<li class="dropdown "><a class="skPlayer-list-switch dropdown-toggle
            feathericons"><i data-feather="disc"></i><span class="visible-xs-inline"></span></a></li>

<li class="dropdown">
<a href="Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html#" data-toggle="dropdown" class="feathericons dropdown-toggle">
<i data-feather="twitch"></i>
<span class="visible-xs-inline">
闲言碎语 </span>
<span class="badge badge-sm up bg-danger pull-right-xs"></span>
</a>

<div class="dropdown-menu w-xl animated fadeInUp">
<div class="panel bg-white">
<div class="panel-heading b-light bg-light">
<strong>
闲言碎语 </strong>
</div>
<div class="list-group" id="smallRecording">
<a href="../../../cross.html" class="list-group-item"><span class="clear block m-b-none words_contents">随机壁纸 API：https://www.lxzzz.cn/337.html可以用于背景图，为了使人物露脸，自定义 CSS 如下：post-panel .blog-post .single-post .item-thumb {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;background-position: 50% 35%;}<br><small class="text-muted">2020-7-6 20:06:24</small></span></a><a href="../../../cross.html" class="list-group-item"><span class="clear block m-b-none words_contents">GDM 使用的字体和 GNOME 使用的字体不一样就很烦躁，发现一个简单的解决方法。其实就是登录 gdm 用户然后用 gsettings 改字体，毕竟人家似乎也不管你的 /etc/fonts/local.conf。machinectl shell <span class="__cf_email__" data-cfemail="7215161f32">[email&#160;protected]</span> /bin/bashgsettings set org.gnome.desktop.interface font-name "Noto S...<br><small class="text-muted">2020-5-14 12:19:43</small></span></a> </div>
</div>
</div>
</li>


<li class="dropdown" id="easyLogin">
<a onclick="if (!window.__cfRLUnblockHandlers) return false; return false" data-toggle="dropdown" class="dropdown-toggle clear" data-toggle="dropdown" data-cf-modified-6b677945121e6806c012d3d9-="">
<span class="feathericons"><i data-feather="key"></i></span>
<b class="caret"></b>
</a>

<div class="dropdown-menu w-lg wrapper bg-white animated fadeIn" aria-labelledby="navbar-login-dropdown">
<form id="Login_form" action="https://static.bobby285271.top/index.php/action/login?_=ef9496f4e69f1859eb0425af107a4ec3" method="post">
<div class="form-group">
<label for="navbar-login-user">用户名</label>
<input type="text" name="name" id="navbar-login-user" class="form-control" placeholder="用户名或电子邮箱"></div>
<div class="form-group">
<label for="navbar-login-password">密码</label>
<input type="password" name="password" id="navbar-login-password" class="form-control" placeholder="密码"></div>
<button style="width: 100%" type="submit" id="login-submit" name="submitLogin" class="btn-rounded box-shadow-wrap-lg btn-gd-primary padder-lg">
<span>登录</span>
<span class="text-active">登录中...</span>
<span class="banLogin_text">刷新页面后登录</span>
<i class="animate-spin  fontello fontello-spinner hide" id="spin-login"></i>
<i class="animate-spin fontello fontello-refresh hide" id="ban-login"></i>
</button>
<input type="hidden" name="referer" value="https://static.bobby285271.top" data-current-url="value"></form>
</div>
</li>

</ul>
</div>

</header>


<aside id="aside" class="app-aside hidden-xs bg-white"> 
<div class="aside-wrap" layout="column">
<div class="navi-wrap scroll-y scroll-hide" flex>

<div class="clearfix hidden-xs text-center hide  show" id="aside-user">
<div class="dropdown wrapper ">
<div ui-nav>
<a href="../../../About.html">
<span class="thumb-lg w-auto-folded avatar m-t-sm  ">
<img src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/9bd9b167ly1fwsfucs1hrj21hc0u01kx_gaitubao_1080x1080.jpg" class="img-full img-circle normal-shadow">
</span>
</a>
</div>
<a href="Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html#" data-toggle="dropdown" class="dropdown-toggle hidden-folded  ">
<span class="clear">
<span class="block m-t-sm">
<strong class="font-bold text-lt">Bobby Rong</strong>
<b class="caret"></b>
</span>
<span class="text-muted text-xs block">SCNUSE 学生</span>
</span>
</a>

<ul class="dropdown-menu animated fadeInRight w hidden-folded no-padder">
<li class="wrapper b-b m-b-sm bg-info m-n">
<span class="arrow top hidden-folded arrow-info"></span>
<div>
<p>下午好，是时候打个盹了</p>
</div>
<div class="progress progress-xs m-b-none dker">
<div class="progress-bar bg-white" data-toggle="tooltip" data-original-title="时间已经度过66.67%" style="width: 66.67%"></div>
</div>
</li>
</ul>

</div>
</div>


<nav ui-nav class="navi clearfix">
<ul class="nav">

<div class="line dk hidden-folded"></div>
<li class="hidden-folded padder m-t m-b-sm text-muted text-xs">
<span>导航</span>
</li>

<li>
<a href="../../../../index.html" class="auto">
<span class="nav-icon"><i data-feather="home"></i></span>
<span>首页</span>
</a>
</li>

<li> <a target="_blank" href="https://start.bobby285271.top/" class="auto"><span class="nav-icon"><i data-feather="crosshair"></i></span><span>Start Page</span></a></li><li> <a target="_blank" href="https://codeforces.bobby285271.top/" class="auto"><span class="nav-icon"><i data-feather="code"></i></span><span>Codeforces Ladders</span></a></li> <li class="line dk"></li>

<li class="hidden-folded padder m-t m-b-sm text-muted text-xs">
<span>组成</span>
</li>

<li>
<a class="auto">
<span class="pull-right text-muted">
<i class="fontello icon-fw fontello-angle-right text"></i>
<i class="fontello icon-fw fontello-angle-down text-active"></i>
</span>

<span class="nav-icon"><i data-feather="grid"></i></span>
<span>分类</span>
</a>
<ul class="nav nav-sub dk">
<li class="nav-sub-header">
<a>
<span>分类</span>
</a>
</li>

<li><a href="../../../category/Uncategorized/index.html"><b class="badge pull-right">0</b><span>Uncategorized</span></a></li><li><a href="../../../category/Linux-Distributions/index.html"><b class="badge pull-right">3</b><span>Linux Distributions</span></a></li><li><a href="../../../category/Algorithm-and-ACM/index.html"><b class="badge pull-right">5</b><span>Algorithm and ACM</span></a></li><li><a href="../../../category/Web-and-Internet/index.html"><b class="badge pull-right">3</b><span>Web and Internet</span></a></li><li><a href="../../../category/applications/index.html"><b class="badge pull-right">1</b><span>Desktop Applications</span></a></li> </ul>
</li>

<li>
<a class="auto">
<span class="pull-right text-muted">
<i class="fontello icon-fw fontello-angle-right text"></i>
<i class="fontello icon-fw fontello-angle-down text-active"></i>
</span>
<span class="nav-icon"><i data-feather="file"></i></span>
<span>页面</span>
</a>
<ul class="nav nav-sub dk">
<li class="nav-sub-header">
<a data-no-instant>
<span>页面</span>
</a>
</li>

<li><a href="../../../Studio.html"><span>Studio</span></a></li>
<li><a href="../../../archiso.html"><span>Archiso</span></a></li>
<li><a href="../../../About.html"><span>About</span></a></li>
<li><a href="../../../cross.html"><span>Cross</span></a></li>
<li><a href="../../../Archives.html"><span>Archives</span></a></li>
</ul>
</li>

<li>
<a class="auto">
<span class="pull-right text-muted">
<i class="fontello icon-fw fontello-angle-right text"></i>
<i class="fontello icon-fw fontello-angle-down text-active"></i>
</span>
<span class="nav-icon"><i data-feather="user"></i></span>
<span>友链</span>
</a>
<ul class="nav nav-sub dk">
<li class="nav-sub-header">
<a data-no-instant>
<span>友链</span>
</a>
</li>

<li data-original-title="在 Arch Linux 社区疯狂输出的大佬" data-toggle="tooltip" data-placement="top"><a href="https://felixc.at/" target="_blank"><span>Felix Yan</span></a></li><li data-original-title="早期的百度贴吧 Linux 吧大水怪" data-toggle="tooltip" data-placement="top"><a href="https://fiveyellowmice.com/" target="_blank"><span>FiveYellowMice</span></a></li><li data-original-title="SCNU ACMer，神犇" data-toggle="tooltip" data-placement="top"><a href="https://www.cnblogs.com/JNzH/" target="_blank"><span>JNzH</span></a></li><li data-original-title="GDUT ACMer，神犇" data-toggle="tooltip" data-placement="top"><a href="https://kaidora.github.io/" target="_blank"><span>Kaidora</span></a></li><li data-original-title="SCNU SE1905 同班同学" data-toggle="tooltip" data-placement="top"><a href="https://user-kay.github.io/" target="_blank"><span>Kay Chen</span></a></li><li data-original-title="0xFFFF.one 站长，大佬" data-toggle="tooltip" data-placement="top"><a href="https://izgq.net/" target="_blank"><span>ZGQ</span></a></li><li data-original-title="百度贴吧 Linux 吧魔法大吧" data-toggle="tooltip" data-placement="top"><a href="http://www.wenyinos.org/" target="_blank"><span>WenyinOS</span></a></li><li data-original-title="早期的百度贴吧 Linux 吧大水怪，北大学霸" data-toggle="tooltip" data-placement="top"><a href="https://lightmelodies.github.io/" target="_blank"><span>LightMelodies</span></a></li><li data-original-title="软协技术部锅长" data-toggle="tooltip" data-placement="top"><a href="https://mikyming.online/" target="_blank"><span>MikyMing</span></a></li><li data-original-title="百度贴吧 Linux 吧吧友" data-toggle="tooltip" data-placement="top"><a href="https://realasking.tk/" target="_blank"><span>Realasking</span></a></li> </ul>
</li>
</ul>
</nav>

</div>


<div id="left_footer" class="footer wrapper-xs text-center nav-xs lt">
<div class="col-xs-4 no-padder">
<a target="_blank" class="tinav" href="../../../../admin/index.html" title="" data-toggle="tooltip" data-placement="top" data-original-title="后台管理">
<span class="left-bottom-icons block"><i data-feather="settings"></i></span>
<small class="text-muted">管理</small>
</a>
</div>
<div class="col-xs-4 no-padder">
<a target="_blank" class="tinav" href="../../../feed/index.html" title="" data-toggle="tooltip" data-placement="top" data-original-title="文章RSS地址">
<span class="left-bottom-icons block"><i data-feather="rss"></i></span>
<small class="text-muted">文章</small>
</a>
</div>
<div class="col-xs-4 no-padder">
<a target="_blank" href="../../../feed/comments/index.html" title="" data-toggle="tooltip" data-placement="top" data-original-title="评论RSS地址">
<span class="left-bottom-icons block"><i data-feather="message-square"></i></span>
<small class="text-muted">评论</small>
</a>
</div>
</div>
</div>
</aside>

<div id="content" class="app-content">

<div id="loading" class="butterbar active hide">
<span class="bar"></span>
</div> 
<style>
    #post-content{
        font-size: 14px;
    }
</style>

<a class="off-screen-toggle hide"></a>
<main class="app-content-body ">
<div class="hbox hbox-auto-xs hbox-auto-sm">

<div class="col center-part">


<header id="small_widgets" class="bg-light lter wrapper-md">
<h1 class="entry-title m-n font-thin text-black l-h">Introduction to Django - Illustrated by the Example of SCNUSE SoCoding 1024 Website<a class="plus-font-size" data-toggle="tooltip" data-original-title="点击改变文章字体大小"><i data-feather="type"></i></a><a data-morphing="" id="morphing" data-src="#morphing-content" href="javascript:;" class="read_mode superscript m-l-sm" data-toggle="tooltip" data-placement="right" data-original-title="阅读模式"><i data-feather="book-open"></i></a></h1> 
<ul class="entry-meta text-muted list-inline m-b-none small
             post-head-icon">

<li class="meta-author"><span class="post-icons"><i data-feather="user"></i></span><span class="sr-only">博主：</span> <a class="meta-value" href="../../../author/1/index.html" rel="author"> Bobby Rong</a></li>

<li class="meta-date"><span class="post-icons"><i data-feather="clock"></i></span><span class="sr-only">发布时间：</span><time class="meta-value">2020 年 07 月 15 日</time></li>

<li class="meta-views"><span class="post-icons"><i data-feather="eye"></i></span><span class="meta-value">71次浏览</span></li>

<li class="meta-comments"><span class="post-icons"><i data-feather="message-circle"></i></span><a class="meta-value" href="Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html#comments">暂无评论</a></li>

<li class="meta-word"><span class="post-icons"><i data-feather="pen-tool"></i></span><span class="meta-value">46637字数</span></li>

<li class="meta-categories"><span class="post-icons"><i data-feather="hash"></i></span><span class="sr-only">分类：</span> <span class="meta-value"><a href="../../../category/Web-and-Internet/index.html">Web and Internet</a></span></li>
</ul>
</header>
<div class="wrapper-md" id="post-panel">
<ol class="breadcrumb bg-white-pure" itemscope=""><li>
<a href="../../../../index.html" itemprop="breadcrumb" title="返回首页" data-toggle="tooltip"><span class="home-icons"><i data-feather="home"></i></span>首页</a>
</li><li class="active">正文&nbsp;&nbsp;</li>
<div style="float:right;">
分享到：
<style>
   .breadcrumb i.iconfont.icon-qzone:after {
    padding: 0 0 0 5px;
    color: #ccc;
    content: "/\00a0";
    }
    
   </style>
<a href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://static.bobby285271.top/index.php/2020/07/15/Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html&title=Introduction to Django - Illustrated by the Example of SCNUSE SoCoding 1024 Website&site=https://static.bobby285271.top/" itemprop="breadcrumb" target="_blank" title="" data-toggle="tooltip" data-original-title="分享到QQ空间" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(this.href, 'qzone-share', 'width=550,height=335');return false;" data-cf-modified-6b677945121e6806c012d3d9-=""><i style="font-size:15px;" class="iconfont icon-qzone" aria-hidden="true"></i></a>
<a href="http://service.weibo.com/share/share.php?url=https://static.bobby285271.top/index.php/2020/07/15/Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html&title=Introduction to Django - Illustrated by the Example of SCNUSE SoCoding 1024 Website" target="_blank" itemprop="breadcrumb" title="" data-toggle="tooltip" data-original-title="分享到微博" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(this.href, 'weibo-share', 'width=550,height=335');return false;" data-cf-modified-6b677945121e6806c012d3d9-=""><i style="font-size:15px;" class="fontello fontello-weibo" aria-hidden="true"></i></a></div></ol> 
<div id="postpage" class="blog-post">
<article class="single-post panel">

<div class="entry-thumbnail" aria-hidden="true"><div class="item-thumb lazy" data-original="https://tva2.sinaimg.cn/large/9bd9b167gy1g4lj02qyq2j21hc0xcqv5.jpg" style="background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=)"></div></div> 
<div id="post-content" class="wrapper-lg">
<div class="entry-content l-h-2x">
<p>好久没有出文章了，尝试再造一遍 2019 年 SCNUSE 软协 1024 程序员节活动网站（尽量还原，会有一些差别），算是 Django 框架的一个学习项目吧，<del>搞不好把题目换掉就是今年活动网站了</del>。博主本人的基本功也不怎么扎实，下文用到了非常多不严谨的表述，如果有任何错误欢迎指出。</p><blockquote>更新进度：7 月 23 日基本更新完成。</blockquote><h2>要实现什么</h2><p>去年也是参与到这个活动中来了，但是只是做了一个关卡，比较划水。简单来说整个网站做的就是注册登录（这个没啥好说的）和闯关（七个关卡，根据游戏、图片、代码或文字提示要求用户找出 Flag 并输入，要保存用户进度和通关时间），去年最后具体实现用到的是 Django 框架，使用 MySQL 数据库。</p><p>由于博主快被 ACM 多校训练和团委项目两座大山压垮了，这里就略过需求分析，把注册登录、其中的三个关卡和通关页给做出来。页面的规划、数据表字段的规划等系统分析部分会在文章中穿插。博主使用的是 SQLite 数据库。</p><h2>铺垫</h2><p>博主认为有一些技能在开始动手之前还是要先掌握的。</p><p>首先是 Python，其实有了程序设计基础之后 Python 的语法其实很简单。完全不会 Python 的推荐看 <span class="external-link"><a href="https://github.com/jackfrued/Python-100-Days" target="_blank">Python 100 天教程<i data-feather='external-link'></i></a></span> 前 15 天部分的内容，然后找个 Online Judge 做几道水题，最多两个小时应该都能熟悉。</p><p>然后是 Web 前端 HTML、CSS、Javascript 的一些最基本的应用，学校讲的足够用了，这里推荐 <span class="external-link"><a href="https://www.runoob.com/" target="_blank">菜鸟教程<i data-feather='external-link'></i></a></span>，可以尝试自己写一些小的静态网站。</p><p>最后 Django 本身还是要先做了解的。可以简单浏览 <span class="external-link"><a href="https://github.com/jackfrued/Python-100-Days" target="_blank">Python 100 天教程<i data-feather='external-link'></i></a></span> 第 14 天和第 41 天的内容，另外也推荐阅读官方推荐的一些 <span class="external-link"><a href="https://docs.djangoproject.com/zh-hans/3.0/misc/design-philosophies/" target="_blank">设计理念<i data-feather='external-link'></i></a></span> 。</p><h2>准备</h2><p>先来做一些准备工作，包括开发环境的配置、项目和应用的初始化。开发环境可以按照自己的喜好来配置，不一定要按照这里的来；项目和应用的初始化有对应的具体的命令，执行即可。</p><h3>开发环境</h3><p>要做的事情就是安装一个对 Python 支持良好的 IDE 或者为你的代码编辑器添加 Python 支持，然后安装 Django。</p><p>假设你跟我一样已经是 Arch Linux + VS Code 用户。VS Code 下的 Python 支持是需要到 pip 的，pip 是 Python 的包管理器，直接使用 Linux 下的包管理器安装。</p><pre><code># pacman -S python-pip</code></pre><p>pip 既然是包管理器，能条件反射到的是肯定要换源，我们在家目录创建并编辑 <code>.pip/pip.conf</code>：</p><pre><code>$ cd 
$ mkdir .pip
$ nano .pip/pip.conf</code></pre><pre><code>[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple</code></pre><p>启动 VS Code，先装上 Python 扩展和 Visual Studio IntelliCode 扩展，然后打开任意 Python 文件，尝试格式化文档，VS Code 就会提示你安装格式化程序，安装就可。可以观察到实质就是调用 pip 安装 <code>autopep8</code>。</p><p>接下来安装 Django，这里有两个方法，一个是继续使用 Linux 下的包管理器安装：</p><pre><code># pacman -S python-django</code></pre><p>或者是用上面刚刚讲到的 pip：</p><pre><code>$ pip install django</code></pre><p>要注意的是给 Arch Linux 软件包锁版本是不被提倡的，毕竟是滚动更新发行版。所以如果你使用 Pacman 安装 <code>python-django</code> 就得一直跟着系统走用最新版，要考虑其利弊。</p><p>接下来尝试使用 <code>django-admin</code> 命令，测试一下是不是一切都准备妥当了：</p><pre><code>$ django-admin version</code></pre><p>理想情况是输出一个版本号。如果提示命令没有找到，那就是在普通用户下使用 pip 按照 Django 导致 <code>django-admin</code> 不在 PATH 里。解决方法很多，例如改用 root 安装，或是修改 PATH，可以参考 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/faq/troubleshooting/#troubleshooting-django-admin" target="_blank">官方文档<i data-feather='external-link'></i></a></span>。</p><h3>创建项目</h3><p>我们首先使用 <code>django-admin</code> 命令为站点创建一个已经初始化的项目目录，不妨叫 <code>mysite</code>。</p><blockquote>如果你起的名字跟我的不一样，只要看到 <code>mysite</code> 改过来就行，另外不要用保留字命名，后面也是一样的道理。</blockquote><pre><code>$ django-admin startproject mysite
$ cd mysite</code></pre><p>进入项目目录之后，应该能见到另一个 <code>mysite/</code> 目录和一个 <code>manage.py</code> 文件：</p><ul><li><code>mysite/</code> 包含了 Django 项目实例需要的设置项集合，包括数据库配置、Django 配置和应用配置。</li><li><code>manage.py</code> 就是一个让你用各种方式管理 Django 项目的命令行工具。</li></ul><p>我们约定，后面涉及的所有文件和文件夹均以当前所在的项目目录为基准标注<strong>相对路径</strong>。</p><h3>创建应用</h3><p>在 Django 中，每一个应用都是一个 Python 包。<strong>应用</strong>通常是一个专门做某件事的网络应用程序，比如博客系统、投票程序。<strong>项目</strong>则是一个网站使用的配置和应用的集合。一个项目可以包含很多个应用，但这里我们只创建一个，就叫 <code>myapp</code>：</p><pre><code>$ python manage.py startapp myapp</code></pre><p>接下来往项目添加这个应用。编辑 <code>mysite/settings.py</code>，找到 <code>INSTALLED_APPS</code>：</p><blockquote>这里没有展示整个的完整的文件，只会展示需要改动的代码或是关键的代码，后面也是一样的道理。我们会在文末附上成品的代码，可以结合成品代码理解。</blockquote><pre><code class="lang-python">INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'myapp',
]</code></pre><h2>站点调试</h2><p>我们可以利用 <code>manage.py</code> 运行 Django 自带的用于开发的简易 Web 服务器对我们的网站进行预览和调试。</p><blockquote>不要将这个服务器用于和生产环境相关的任何地方，这个服务器只是为了开发而设计的。</blockquote><pre><code>$ python manage.py runserver</code></pre><p>终端应该会输出类似这样的东西：</p><pre><code>Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.</code></pre><p>按照上面的输出，我们打开浏览器访问 <span class="external-link"><a href="http://127.0.0.1:8000/" target="_blank">http://127.0.0.1:8000/<i data-feather='external-link'></i></a></span>，在下文中我们假设你的服务器设置和我的一样为监听本机内部 IP 的 <code>8000</code> 端口。在一个网页都没有完成的情况下，你应该能看到 Django 自带的测试页面。当我们写好我们的网站之后则应该能看到自己的网站，测试页面就不会再出现了。</p><p>现在我们尝试将测试页面改成中文的，其实是为 Django 设置语言。编辑 <code>mysite/settings.py</code>：</p><pre><code class="lang-python">LANGUAGE_CODE = 'zh-hans'
TIME_ZONE = 'Asia/Shanghai'</code></pre><p>不必重新启动服务器，直接刷新页面，现在测试页面显示的是中文，你的改动生效了。通常来说服务器会对每一次的访问请求重新载入一遍 Python 代码，但是例外还是有的（如添加新文件）。如果你发现你的改动没有生效，尝试重启服务器就好了。</p><p>如果你想把服务器停掉，就按照终端的提示按下 Ctrl + C 组合键即可，和 Linux 杀死其它命令的方式是一样的。</p><h2>第一个页面</h2><p>几乎所有教程做第一个页面都是 Hello World，虽然这和 1024 站点没啥关联，我们也先实现一下，目标是访问站点首页后显示一行文字 <code>Hello World</code>。</p><p>博主认为虽然是 Hello World，但可能还是会有点难度。其实不需要纠结太多，关键是记住具体的实现，知道哪些地方是套路，哪些地方要改动。我们在后面会制作更多的页面，自然就会熟悉了。</p><h3>响应与视图函数</h3><p><strong>视图函数</strong>（简称视图）是一个简单的 Python 函数，它接受 Web 请求并且返回 Web 响应。响应可以是 HTML、重定向、404、XML、图片等等。无论视图函数本身包含什么逻辑，都要返回响应。我们通常将视图函数放置在 <code>views.py</code> 文件中。</p><p>我们现在只需要在页面上显示上一行 <code>Hello World</code>，所以这个视图函数不需要做什么，直接返回响应就行。既然是首页，不妨将函数命名为 <code>index</code>，我们看看具体的实现。编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">from django.shortcuts import render, redirect
from django.http import HttpResponse

def index(request):
    return HttpResponse(&quot;&lt;h1&gt;Hello, World&lt;/h1&gt;&quot;)</code></pre><p>视图函数就写好啦！这里我们用到了 <code>HttpResponse</code> 对象，你可以翻阅 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/ref/request-response/#httpresponse-objects" target="_blank">官方文档<i data-feather='external-link'></i></a></span> 了解这个对象，并尝试将 <code>&lt;h1&gt;Hello, World&lt;/h1&gt;</code> 改成其它内容。</p><h3>URL 的映射</h3><p>接下来我们建立 URL（统一资源定位符）与视图函数 <code>index</code> 的映射。具体可以分成两步，第一步是在应用下面处理自己的映射关系，第二步是进行路由分发。</p><p>博主认为这可以理解为一个相对路径的确定，当然这里的路径指的是我们访问的 URL，和项目文件的放置没有关联。第一步实际上就是将应用根目录的绝对路径作为基准，确定各个网页的相对路径。第二步就是将项目根目录的绝对路径作为基准，确定各个应用根目录的相对路径。</p><p>现在我们想在首页显示 Hello World，我们来看看具体的实现。</p><p>先来做第一步，在 <code>myapp</code> 下面新建一个 <code>urls.py</code>：</p><pre><code class="lang-python">from django.urls import path
from . import views

urlpatterns = [
    path('', views.index, name='index'),
]</code></pre><p><code>path('', views.index, name='index')</code> 可以理解为这个网页就位于应用的根目录，响应的是 <code>views.py</code> 文件里的 <code>index</code> 函数。而最后的 <code>name='index'</code> 则是指定 <code>name</code> 属性，这里的 <code>name</code> 和 HTML 下的 <code>id</code> 属性是类似的，必须要唯一。我们会在后面用到它。</p><p>再来做第二步，编辑 <code>mysite/urls.py</code>：</p><pre><code class="lang-python">from django.contrib import admin
from django.urls import include, path

urlpatterns = [
    path('', include('myapp.urls')),
    path('admin/', admin.site.urls),
]</code></pre><p><code>path('', include('myapp.urls'))</code> 可以理解为 <code>myapp</code> 这个应用的根目录就位于项目的根目录，<code>path('admin/', admin.site.urls)</code> 为 Django 自带的管理页面，可以暂时不用理会，我们会在后面用到它。</p><p>当然了这样的理解自然是不严谨的，还是建议大家深入了解 URL 和路由，详情可以查阅 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/topics/http/urls/" target="_blank">官方文档<i data-feather='external-link'></i></a></span>。</p><p>现在使用 <code>python manage.py runserver</code> 调试，访问 <span class="external-link"><a href="http://127.0.0.1:8000/" target="_blank">http://127.0.0.1:8000/<i data-feather='external-link'></i></a></span>，显示的是 Hello World 页了。你可以尝试再对 <code>myapp/urls.py</code> 和 <code>mysite/urls.py</code> 进行编辑，看看 Hello World 页是否能在你期望的位置出现。</p><h3>更多的页面</h3><p>有了 Hello World 页的铺垫之后，我们就可以愉快地进行页面规划了。</p><p>我们需要做的实际上只有四个页面，一个是注册页（<code>register</code>），一个是登录页（<code>login</code>），一个是闯关页（<code>play</code>），还有一个通关页（<code>win</code>）。现在我们不需要把他们实际的功能做出来，而是做四个 Hello World 页，这时为了避免因为「挖了坑没填完」而导致的站点调试时报错。</p><p>现在我们就来仿照上面 Hello World 页的例子，初始化注册页、登录页、闯关页和通关页。具体来说，我们为他们分别写一个临时的视图函数并建立好 URL 映射。我们后面每一章都会展开说明一个页面具体的实际的实现，届时再对我们的视图函数做进一步的修改，也有可能因为处理表单的需要继续创建页面。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-a9ef82961cc1f233b6e23ddea17cc58b57" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-a9ef82961cc1f233b6e23ddea17cc58b57" class="panel-body collapse">
</p><p>首先我们写视图函数，编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">def register(request):
    return HttpResponse(&quot;&lt;p&gt;这是注册页&lt;/p&gt;&quot;)

def login(request):
    return HttpResponse(&quot;&lt;p&gt;这是登录页&lt;/p&gt;&quot;)

def play(request):
    return HttpResponse(&quot;&lt;p&gt;这是闯关页&lt;/p&gt;&quot;)

def win(request):
    return HttpResponse(&quot;&lt;p&gt;这是通关页&lt;/p&gt;&quot;)</code></pre><p>接下来我们建立 URL 映射，编辑 <code>myapp/urls.py</code>：</p><pre><code class="lang-python">urlpatterns = [
    path('', views.index, name='index'),
    path('register/', views.register, name='register'),
    path('login/', views.login, name='login'),
    path('play/', views.play, name='play'),
    path('win/', views.win, name='win'),
]</code></pre><p>路由分发我们在做 Hello World 页的时候已经做好了，无需再做改动。</p><p>
</div>
</div></p><p>现在使用 <code>python manage.py runserver</code> 调试，访问 <span class="external-link"><a href="http://127.0.0.1:8000/register/" target="_blank">http://127.0.0.1:8000/register/<i data-feather='external-link'></i></a></span> 查看注册页目前的效果。然后尝试访问登录页、关卡页和通关页。</p><h2>注册页的实现</h2><p>现在访问注册页，显示的只有五个字「这是注册页」，但我们实际需要的是：前端一个表单供用户输入账户密码，后端处理用户输入与数据库交互。接下来，我们会根据实际的需求进一步改造这个注册页，使其达到我们所要的效果。</p><h3>模板</h3><p>首先我们改造注册页的前端部分，刚刚学完 Web 前端，应该不是什么难点。现在的问题讲通俗点就是，怎样做到我访问这个地址就给我渲染指定的 HTML 文件呢？</p><p>一个方法是，我把这个 HTML 文件的内容压成一行，换掉 <code>&lt;p&gt;这是注册页&lt;/p&gt;</code> 。可以是可以，但是一个很最突出的问题是维护起来很难受。事实上这样子其实是将数据与视图混合在一起，我们说是不符合 Django 的 MVC 思想（Model View Controller，具体请百度）。于是我们有了另外一个东西叫做<strong>模板</strong>。我们可以在 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/howto/overriding-templates/" target="_blank">官方文档 How-to 部分<i data-feather='external-link'></i></a></span> 找到相关的文档。</p><p>目前而言，你可以简单地把模板跟 HTML 文件划上等号，我们后面会介绍 Django 标签，届时你将会进一步了解模板的神奇之处。模板是有专门地方存放的，在 <code>myapp/</code> 下面建立一个 <code>templates/</code> 文件夹。接下来往里面放你的 HTML 文件。</p><p>例如我把注册页命名为 <code>register.html</code>，也就是说文件的相对路径为 <code>myapp/templates/register.html</code>。就和初学 Web 前端一样，先不要管样式，也不要管按钮链接能不能工作，这些在后面会提及。</p><p>为了节省时间，这里就直接开抄了。以下的代码为去年的代码改动而来：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-9d58273d167ba711270212d736d92bbd3" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-9d58273d167ba711270212d736d92bbd3" class="panel-body collapse">
</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Register&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;lg_content&quot;&gt;
        &lt;table cellspacing=&quot;30px&quot; align=&quot;center&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;#&quot;&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;userid&quot; class=&quot;reg_ip&quot; placeholder=&quot;学号&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;username&quot; class=&quot;reg_ip&quot; placeholder=&quot;昵称&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;passwd&quot; class=&quot;reg_ip&quot; placeholder=&quot;密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;repasswd&quot; class=&quot;reg_ip&quot; placeholder=&quot;确认密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;

                &lt;tr&gt;
                    &lt;td align=&quot;left&quot;&gt;

                        &lt;input type=&quot;submit&quot; value=&quot;注册&quot; style=&quot;position:relative;left:40px;&quot; class=&quot;button&quot;&gt;

                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/form&gt;
            &lt;td align=&quot;center&quot; style=&quot;position:relative;left:-50px&quot;&gt;
                &lt;span class=&quot;font1&quot;&gt;已经注册？&lt;/span&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;直接登录&quot;
                    onclick=&quot;location.href='#'&quot;&gt;
            &lt;/td&gt;
        &lt;/table&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre><p>
</div>
</div></p><p>接下来我们把「注册页」三个字换掉，这里我们使用的是 <code>render</code> 方法，它可接收三个参数，一是 <code>request</code> 参数，二是待渲染的 HTML 模板文件，三是保存具体数据的字典参数。它的作用就是将数据填充进模板文件，最后把结果返回给浏览器。编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">def register(request):
    return render(request, 'register.html')</code></pre><p>我们再访问 <span class="external-link"><a href="http://127.0.0.1:8000/register/" target="_blank">http://127.0.0.1:8000/register/<i data-feather='external-link'></i></a></span>，发现已经有一个注册页面的样子了。</p><h3>静态资源</h3><p>现在我们来做注册页的样式吧！你们可能尝试过在 <code>myapp/templates/</code> 直接放一个 CSS 文件，然后在 <code>myapp/templates/register.html</code> 直接加 <code>&lt;link href=&quot;style.css&quot; rel=&quot;stylesheet&quot;&gt;</code>，你会发现是行不通的。调试的时候，你会发现它实际请求的是 <span class="external-link"><a href="http://127.0.0.1:8000/register/style.css" target="_blank">http://127.0.0.1:8000/register/style.css<i data-feather='external-link'></i></a></span>，直接 404。</p><p>注意到 <code>mysite/settings.py</code> 有这么一行：</p><pre><code class="lang-python"># Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/3.0/howto/static-files/

STATIC_URL = '/static/'</code></pre><p>事实上，关于静态资源的存放，<span class="external-link"><a href="https://docs.djangoproject.com/zh-hans/3.0/howto/static-files/" target="_blank">官方文档 How-to 部分<i data-feather='external-link'></i></a></span> 依然给出了具体的说明。和模板类似，我们要单独建立 <code>static/</code> 目录来存放这些静态资源。通常我们把这个目录放在应用目录下，我们 <code>myapp/</code> 下新建 <code>static/</code> 目录，里面再建一个 <code>css/</code> 目录。</p><p>接下来，我们尝试往 <code>css/</code> 目录里面添加我们的样式。这个样式我们会在后面多次使用，编辑 <code>myapp/static/css/style.css</code>，这里我们继续偷懒开抄：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-e27f179c11c19bd90231bfb6fdef0ff344" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-e27f179c11c19bd90231bfb6fdef0ff344" class="panel-body collapse">
</p><pre><code class="lang-css">body {
    /* background: url(&quot;../img/bg_img.jpg&quot;); */
    /* background-size: cover; */
    margin: 0px;
    padding: 0px;
    text-align: center;
}

.containerDiv {
    margin-top: 0;
    margin-bottom: 0;
    background-size: 100% 100%;
    width: 100%;
    text-align: center;
}

.lg_content {
    margin-top: 100px;
}

.titleDiv {
    width: 100%;
    height: 150px;
}

.problemDiv {
    width: 80%;
    height: 360px;
    margin-left: 10%;
    margin-right: 10%;
    position: relative;
}

.leftDiv {
    width: 50%;
    height: 360px;
    text-align: center;
    float: left;
}

.rightDiv {
    width: 40%;
    margin-left: 10%;
    height: 360px;
    text-align: center;
    float: left;
}

.answerDiv {
    width: 100%;
    height: 60px;
    position: relative;
}

.background {
    background-size: 100% 100%;
    width: 100%;
    height: 100%;
}

.button {
    width: 68px;
    height: 34px;
    font-size: 18px;
    color: rgb(255, 255, 255);
    background-color: rgb(76, 129, 179);
    box-shadow: none;
    border: none;
    border-style: inline;
}

.input {
    height: 40px;
    width: 250px;
    font-size: 14px;
    color: rgba(155, 152, 151, 0.774);
    border: none;
    box-shadow: none;
    border-style: none;
    border-width: 0px;
}

.font1 {
    font-family: &quot;Microsoft YaHei&quot;;
    font-size: 12px;
    font-weight: bold;
    color: azure;
}

.font2 {
    font-family: &quot;Microsoft YaHei&quot;;
    font-size: 22px;
    width: 400px;
    color: rgb(88, 99, 192);
}

#game_div,
p {
    width: 400px;
    margin: auto;
    margin-top: 0px;
}</code></pre><p>
</div>
</div></p><p>根据 <code>STATIC_URL = '/static/'</code> 这一线索，我们尝试访问 <span class="external-link"><a href="http://127.0.0.1:8000/static/css/style.css" target="_blank">http://127.0.0.1:8000/static/css/style.css<i data-feather='external-link'></i></a></span>，发现确实是有这个文件的。</p><p>事实上，只要将 <code>&lt;link href=&quot;style.css&quot; rel=&quot;stylesheet&quot;&gt;</code> 改成 <code>&lt;link href=&quot;/static/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;</code> 就可以往页面加载样式了。</p><p><strong>但是</strong>，这样后续维护是很困难的。</p><p>一个问题是如果我们后面突然又需要创建应用，需要的是不同的样式呢？想象一下，你有两个应用 <code>myapp</code> 和 <code>yourapp</code>，然后你在 <code>myapp/static/css/style.css</code> 和 <code>yourapp/static/css/style.css</code> 放了不同的样式文件，你访问 <span class="external-link"><a href="http://127.0.0.1:8000/static/css/style.css" target="_blank">http://127.0.0.1:8000/static/css/style.css<i data-feather='external-link'></i></a></span> 得到的是什么呢？</p><p>对这个问题，官方的解决方案是，在 <code>myapp/static/</code> 下面再建立一个目录 <code>myapp</code>（就是应用本身的名称），然后把静态资源放里面，我们尝试将 <code>myapp/static/css</code> 目录移动到 <code>myapp/static/myapp/css</code>。现在我们在 <span class="external-link"><a href="http://127.0.0.1:8000/static/myapp/css/style.css" target="_blank">http://127.0.0.1:8000/static/myapp/css/style.css<i data-feather='external-link'></i></a></span> 可以看到我们的样式文件了。</p><p>另一个问题是如果我突然想更换一下映射到静态资源的 URL 呢？也就是说我把 <code>STATIC_URL = '/static/'</code> 改成别的，是不是所有的 HTML 文件我要逐个修改呢？</p><p>所以我们是不建议按照前面的方式去写的，我们有一个船新的方法。编辑 <code>myapp/templates/register.html</code>：</p><pre><code class="lang-html">&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;register&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;</code></pre><p>要注意的是 <code>{% load static %}</code> 和 <code>{%static 'myapp/css/style.css'%}</code> 的 <code>static</code> 和 <code>STATIC_URL = '/static/'</code> 中的路径 <code>static</code> 是没有任何联系的，就是静态资源的意思。你可以尝试将 <code>STATIC_URL</code> 改成别的再来试试。</p><p>现在访问 <span class="external-link"><a href="http://127.0.0.1:8000/register/" target="_blank">http://127.0.0.1:8000/register/<i data-feather='external-link'></i></a></span>，F12 看一下，会发现上面 <code>{% %}</code> 标签的内容都已经被替换掉了。</p><p>接下来是背景图片。同样地，我们将 <code>bg_img.jpg</code> 放置在 <code>myapp/static/myapp/img/</code> 目录中。这回没那么复杂，在 CSS 文件里引用时直接写相对路径即可，因为无论怎么修改 <code>STATIC_URL</code> 都不会对其产生影响：</p><pre><code class="lang-css">body {
    background: url(&quot;../img/bg_img.jpg&quot;);
    background-size: cover;
    margin: 0px;
    padding: 0px;
    text-align: center;
}</code></pre><p>好了，现在注册页看上去跟去年是一个样子了。</p><h3>数据库与模型</h3><p>来到后端部分了！后端部分是离不开数据库的，我们首先把数据库配置好。这里我们使用的是 SQLite 数据库，为什么在这个项目使用 SQLite 呢？</p><ul><li>轻量，无客户端和服务器端之分，跨平台，单文件。</li><li>我们现在做的网站也只是供我们自娱自乐的而已，没有高并发。</li><li>Python 内置 SQLite，所以你无需安装额外东西来使用它。</li><li>不需要事先创建数据库，数据库会在需要的时候自动创建。</li><li>Django 默认的数据库就是 SQLite，我们查看 <code>mysite/settings.py</code>：</li></ul><pre><code class="lang-python">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
    }
}</code></pre><p>让我们开始吧！首先我们对设定的数据库进行初始化：</p><pre><code>$ python manage.py migrate</code></pre><p>所谓的初始化实际上是<strong>迁移</strong>操作，为在 <code>mysite/settings.py</code> 涉及到的 <code>INSTALLED_APPS</code> 创建一些数据表。这里先不需要去纠结具体是做什么的，有兴趣的可以查看 <span class="external-link"><a href="https://docs.djangoproject.com/zh-hans/3.0/intro/tutorial02/#database-setup" target="_blank">官方文档<i data-feather='external-link'></i></a></span>。我们在后面还会使用到这个命令，到时再做说明。</p><p>接下来我们进行数据表字段的规划。在 Django，我们称数据库结构设计为<strong>模型</strong>。你可以把模型类比为数据库里的数据表，在这里我们只需要为学生这个对象创建一个模型，不妨将它命名为 <code>STUDB</code>。</p><p>下面我们就来实现这个模型，博主认为整个流程和 Git 提交代码的流程非常类似。在 Git 我们并不会在版本库直接改动代码，而是：</p><ul><li>第一步，你在工作区对文件作出改动，你的改动并不会影响到版本库。</li><li>第二步，<code>git add</code>：你的改动从工作区被转移到了暂存区。</li><li>第三步，<code>git commit</code>：你的改动从暂存区被转移到了版本库。</li></ul><p>在这个项目，我们的第一步就是编辑 <code>myapp/models.py</code> 文件，在文件记录我们需要的模型。</p><p>作为我们需要建立的唯一一个模型，我们要为其添加的字段有：</p><table><thead><tr><th>字段名</th><th>数据类型</th><th>作用</th><th>备注</th></tr></thead><tbody><tr><td><code>userid</code></td><td>文本 <code>TextField</code></td><td>学号</td><td>最大长度为 11 <code>max_length=11</code></td></tr><tr><td><code>username</code></td><td>文本 <code>TextField</code></td><td>昵称</td><td>最大长度为 10 <code>max_length=10</code></td></tr><tr><td><code>passwd</code></td><td>文本 <code>TextField</code></td><td>密码</td><td>最大长度为 20 <code>max_length=20</code></td></tr><tr><td><code>firstflag</code></td><td>时间 <code>DateTimeField</code></td><td>普通关卡开始时间</td><td>默认是当前时间</td></tr><tr><td><code>lastflag</code></td><td>时间 <code>DateTimeField</code></td><td>普通关卡通关时间</td><td>默认是当前时间</td></tr><tr><td><code>superflag</code></td><td>时间 <code>DateTimeField</code></td><td>最后一关通关时间</td><td>默认是当前时间</td></tr><tr><td><code>specialflag</code></td><td>时间 <code>DateTimeField</code></td><td>彩蛋通关时间</td><td>默认是当前时间</td></tr><tr><td><code>rank</code></td><td>整数 <code>IntegerField</code></td><td>通关记录</td><td>默认是 1</td></tr><tr><td><code>timesubtract</code></td><td>整数 <code>IntegerField</code></td><td>普通关卡时间差</td><td>默认是 0</td></tr><tr><td><code>timesubtract_last</code></td><td>整数 <code>IntegerField</code></td><td>最后一关时间差</td><td>默认是 0</td></tr><tr><td><code>timesubtract_suprise</code></td><td>整数 <code>IntegerField</code></td><td>彩蛋时间差</td><td>默认是 0</td></tr></tbody></table><p>我们可以在 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/ref/models/fields/#textfield" target="_blank">官方文档<i data-feather='external-link'></i></a></span> 找到可能需要用到的数据类型。</p><p>接下来我们将表格转为代码。在 <code>myapp/models.py</code> 在这个文件中，每个模型被表示为一个<strong>类</strong>。每个模型有许多类变量，它们都表示模型里的一个数据库字段。</p><p>我们可以在 <span class="external-link"><a href="https://docs.djangoproject.com/zh-hans/3.0/intro/tutorial02/#creating-models" target="_blank">官方文档<i data-feather='external-link'></i></a></span> 找到很多代码实现的例子。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-b47f6fec80a7087a341fa9643c90fe2e95" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-b47f6fec80a7087a341fa9643c90fe2e95" class="panel-body collapse">
</p><pre><code class="lang-python">from django.db import models
import django.utils.timezone as timezone

class STUDB(models.Model):
    userid = models.TextField(max_length=11)
    username = models.TextField(max_length=10)
    passwd = models.TextField(max_length=20)
    firstflag = models.DateTimeField(default=timezone.now)
    lastflag = models.DateTimeField(default=timezone.now)
    superflag = models.DateTimeField(default=timezone.now)
    specialflag = models.DateTimeField(default=timezone.now)
    rank = models.IntegerField(default=1)
    timesubtract = models.IntegerField(default=0)
    timesubtract_last = models.IntegerField(default=0)
    timesubtract_suprise = models.IntegerField(default=0)</code></pre><p>
</div>
</div></p><p>接下来是第二步，我们让 Django 检测你对模型文件的修改，并且把修改的部分储存为一次迁移。</p><pre><code class="lang-python">$ python manage.py makemigrations</code></pre><p>最后是第三步，在数据库里创建新定义的模型的数据表。</p><pre><code>$ python manage.py migrate</code></pre><h3>表单处理与数据库交互</h3><p>既然数据库已经配置完毕，接下来我们要做的是读取用户的输入并写入数据库。</p><p>怎样获取和处理用户的输入呢？Web 前端曾经讲过怎样用 Javascript 处理 GET 请求和 POST 请求，这里也是类似的，甚至还简单一些。</p><p>首先还是要回到前端，我们已经写了一个 form 表单，目前我们的 <code>form</code> 标签是这样的：</p><pre><code class="lang-html">&lt;form method=&quot;post&quot; action=&quot;#&quot;&gt;&lt;/form&gt;</code></pre><p>我们需要将 <code>action</code> 属性补充完整。为此我们需要另外制作一个「页面」用来接收表单的信息，这个页面不一定要给用户看到些什么。我们在这个页面处理完用户的信息后就会跳转到相应的页面。我们把这个页面命名为 <code>register_to_db</code>。</p><p>我们来写一下视图函数，这回我们需要进行一些逻辑上的处理了，所以这个函数注定要写的又臭又长，我们拆分一下我们要实现的逻辑。</p><p>首先，我们要接收表单发过来的 POST 请求。在 Web 前端课程上，我们已经知道前端表单的 <code>name</code> 属性会被用于对提交到服务器后的表单数据进行标识。所以我们现在要接收的，就是 <code>userid</code>、<code>username</code>、<code>passwd</code> 和 <code>repasswd</code>。</p><pre><code class="lang-python">userid = request.POST.get('userid', None)
username = request.POST.get('username', None)
passwd = request.POST.get('passwd', None)
repasswd = request.POST.get('repasswd', None)</code></pre><p>接下来，我们看看学号是否已经被注册，如果被注册了，我们就跳转回注册页。从这里开始，我们就要用到数据库的增删改查操作了，然而我们并不需要写 SQL 语句，因为 Django 模型使用自带的对象关系映射（ORM）连接业务逻辑层和数据库层。简单来说，ORM 会将 Python 代码转成为 SQL 语句。</p><p><span class="external-link"><a href="https://www.runoob.com/django/django-model.html" target="_blank">菜鸟教程<i data-feather='external-link'></i></a></span> 提供了数据库增删改查实现的不少例子，可供参考。</p><p>我们也来照葫芦画瓢，首先导入我们的模板，接下来我们使用 <code>filter</code> 方法查询学号信息，返回一个列表：</p><pre><code class="lang-python">from .models import STUDB
users = STUDB.objects.filter(userid=userid)</code></pre><p>如果这个列表不为空，意味着这个学号已经被注册，我们就跳转回注册页。怎样实现跳转呢，可以想到的第一个方法是直接使用之前讲过的 <code>render</code> 方法：</p><pre><code class="lang-python">if len(users) == 1:
    return render(request, 'register.html')</code></pre><p>会发现确实是重新「显示」注册页了，但是我们看 URL 并没有变，依然是 <span class="external-link"><a href="http://127.0.0.1:8000/register_to_db/" target="_blank">http://127.0.0.1:8000/register_to_db/<i data-feather='external-link'></i></a></span>。我们不要忘了 <code>register.html</code> 只是一个模板而已。但是我们希望的是跳转到 <span class="external-link"><a href="http://127.0.0.1:8000/register/" target="_blank">http://127.0.0.1:8000/register/<i data-feather='external-link'></i></a></span>。这里我们就要介绍到我们的 <code>redirect</code> 方法了，它专为重定向而生，我们看看它最基本的使用方法：</p><pre><code class="lang-python">if len(users) == 1:
    return redirect(&quot;http://127.0.0.1:8000/register/&quot;)</code></pre><p>和我们学 Web 前端接触的 <code>a</code> 标签的 <code>href</code> 属性几乎一样，填上 URL 就行。当然，上面这样填写绝对路径是不利于后续维护的。哪怕改成相对路径 <code>redirect(&quot;../register/&quot;)</code>，由于我们可以随时修改 <code>myapp/urls.py</code> 中的映射关系，事实上也不是最优方法。事实上对于所有的模板，我们都应该避免硬编码链接硬编码。</p><p>还记得我们刚开始编辑 <code>myapp/urls.py</code> 时提到的 <code>name</code> 吗？</p><pre><code class="lang-python">path('register/', views.register, name='register')</code></pre><p>现在是将它派上用场的好机会。我们使用 <code>reverse</code> 方法，填上注册页的 <code>name</code> 参数：</p><pre><code class="lang-python">from django.shortcuts import render, reverse, redirect
if len(users) == 1:
    return redirect(reverse('register'))</code></pre><p>接下来我们再进一步，我们希望跳转过去之后弹出一条提示。我们知道 GET 的参数就是在 URL 后面跟一个 <code>?</code>，然后是参数列表。不妨就利用 GET 请求通知注册页弹窗，我们这里就用一个参数 <code>code</code>，当然参数名可以自定。具体的弹窗实现我们稍后再提及：</p><pre><code class="lang-python">from django.shortcuts import render, reverse, redirect
if len(users) == 1:
    return redirect(reverse('register')+&quot;?code=-1&quot;)</code></pre><p>我们尝试实现另外的几个逻辑，首先是判断输入是否齐全，然后是判断学号是否为 11 位且开头为 <code>201</code>，然后是判断密码是否是 6-18 位且必须是英文字母或数字，最后判断两次输入的密码是否一致。这里需要使用到正则表达式。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-3ce75ca26cbe4a356295b3d7fef5fb5d58" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-3ce75ca26cbe4a356295b3d7fef5fb5d58" class="panel-body collapse">
</p><pre><code class="lang-python">import re

# 判断是否为空
if not userid or not passwd or not username or not repasswd:
    return redirect(reverse('register')+&quot;?code=-5&quot;)

# 判断学号格式
if not re.match(r'^(201).*\d{8}$', userid):
    return redirect(reverse('register')+&quot;?code=-4&quot;)

# 判断密码是否为 6-18 位且为字母或数字
if not re.match(r'^[A-Za-z0-9]{6,18}$', passwd):
    return redirect(reverse('register')+&quot;?code=-3&quot;)

# 判断两次密码是否一致
if passwd != repasswd:
    return redirect(reverse('register')+&quot;?code=-2&quot;)</code></pre><p>
</div>
</div></p><p>如果没啥问题，我们就可以写入数据库了，然后跳转到登录页。现在我们用到的是 <code>save</code> 函数。这里博主再次给出 <span class="external-link"><a href="https://www.runoob.com/django/django-model.html" target="_blank">菜鸟教程<i data-feather='external-link'></i></a></span> 的链接。</p><pre><code class="lang-python">STUDBdent = STUDB.objects.create(
    userid=userid, username=username, passwd=passwd)
STUDBdent.save()
return redirect(reverse('login')+&quot;?code=1&quot;)</code></pre><p>视图函数就写好了，我们再来检查一下我们刚才写的东西：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-c429bece257ecd0b18e64a820dfb6a5512" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-c429bece257ecd0b18e64a820dfb6a5512" class="panel-body collapse">
</p><pre><code class="lang-python">from django.shortcuts import render, reverse, redirect
from django.http import HttpResponse
import re
from .models import STUDB

def register_to_db(request):
    userid = request.POST.get('userid', None)
    username = request.POST.get('username', None)
    passwd = request.POST.get('passwd', None)
    repasswd = request.POST.get('repasswd', None)
    if not userid or not passwd or not username or not repasswd:
        return redirect(reverse('register')+&quot;?code=-5&quot;)
    if not re.match(r'^(201).*\d{8}$', userid):
        return redirect(reverse('register')+&quot;?code=-4&quot;)
    if not re.match(r'^[A-Za-z0-9]{6,18}$', passwd):
        return redirect(reverse('register')+&quot;?code=-3&quot;)
    if passwd != repasswd:
        return redirect(reverse('register')+&quot;?code=-2&quot;)
    users = STUDB.objects.filter(userid=userid)
    if len(users) == 1:
        return redirect(reverse('register')+&quot;?code=-1&quot;)
    STUDBdent = STUDB.objects.create(
        userid=userid, username=username, passwd=passwd)
    STUDBdent.save()
    return redirect(reverse('login')+&quot;?code=1&quot;)</code></pre><p>
</div>
</div></p><p>接下来别忘了把 <code>register_to_db</code> 页的映射关系写好：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-6a98636240190de575638e18c7c9574335" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-6a98636240190de575638e18c7c9574335" class="panel-body collapse">
</p><p>编辑 <code>myapp/urls.py</code>：</p><pre><code>urlpatterns = [
    path('', views.index, name='index'),
    path('register/', views.register, name='register'),
    path('login/', views.login, name='login'),
    path('play/', views.play, name='play'),
    path('win/', views.win, name='win'),
    path('register_to_db/', views.register_to_db, name='register_to_db'),
]</code></pre><p>
</div>
</div></p><p>接下来，我们回到前端的表单，我们把这个 <code>form</code> 标签给鸽了很久了。</p><pre><code class="lang-html">&lt;form method=&quot;post&quot; action=&quot;#&quot;&gt;&lt;/form&gt;</code></pre><p>首先是 <code>action</code> 属性。在后端，我们使用的是 <code>reverse</code> 方法，回忆一下？</p><pre><code class="lang-python">return redirect(reverse('login')+&quot;?code=1&quot;)</code></pre><p>在模板这里，我们可以使用 <code>{% url %}</code> 标签。我们曾经讲过 <code>{% static %}</code> 标签，回忆一下？</p><pre><code class="lang-html">{% load static %}
&lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;</code></pre><p>下面我们就来看看 <code>{% url %}</code> 最简单的用法，就是带上页面的 <code>name</code> 参数：</p><pre><code class="lang-html">&lt;form method=&quot;post&quot; action=&quot;{% url 'register_to_db' %}&quot;&gt;&lt;/form&gt;</code></pre><p>我们看看另一个例子，知道注册页底部有一个按钮是链接到登录页的：</p><pre><code class="lang-html">&lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;直接登录&quot; onclick=&quot;location.href='#'&quot;&gt;</code></pre><p>我们来实现一下它的跳转功能吧，使用 <code>{% url %}</code> 标签：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-67a5e37503f5edc8123e2a3beb156da434" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-67a5e37503f5edc8123e2a3beb156da434" class="panel-body collapse">
</p><pre><code class="lang-html">&lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;直接登录&quot; onclick=&quot;location.href='{% url 'login' %}'&quot;&gt;</code></pre><p>
</div>
</div></p><p>由于我们创建一个 POST 表单（它具有修改数据的作用），所以我们需要小心跨站点请求伪造。Django 自带了一个非常有用的防御系统。所有针对内部 URL 的 POST 表单都应该使用 <code>{% csrf_token %}</code> 模板标签，这里就没有什么用法了，在 <code>form</code> 标签内添加一行 <code>{% csrf_token %}</code> 即可。</p><p>我们来看看现在的 <code>myapp/templates/register.html</code> 是什么样子的：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-4582f43d8b3e35c740aee69b46c2345b93" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-4582f43d8b3e35c740aee69b46c2345b93" class="panel-body collapse">
</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Register&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{% static 'myapp/css/style.css' %}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;lg_content&quot;&gt;
        &lt;table cellspacing=&quot;30px&quot; align=&quot;center&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;{% url 'register_to_db' %}&quot;&gt;
                {% csrf_token %}
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;userid&quot; class=&quot;reg_ip&quot; placeholder=&quot;学号&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;username&quot; class=&quot;reg_ip&quot; placeholder=&quot;昵称&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;passwd&quot; class=&quot;reg_ip&quot; placeholder=&quot;密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;repasswd&quot; class=&quot;reg_ip&quot; placeholder=&quot;确认密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;

                &lt;tr&gt;
                    &lt;td align=&quot;left&quot;&gt;

                        &lt;input type=&quot;submit&quot; value=&quot;注册&quot; style=&quot;position:relative;left:40px;&quot; class=&quot;button&quot;&gt;

                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/form&gt;
            &lt;td align=&quot;center&quot; style=&quot;position:relative;left:-50px&quot;&gt;
                &lt;span class=&quot;font1&quot;&gt;已经注册？&lt;/span&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;直接登录&quot;
                    onclick=&quot;location.href='{% url 'login' %}'&quot;&gt;
            &lt;/td&gt;
        &lt;/table&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre><p>
</div>
</div></p><h3>消息框架</h3><p>现在我们来实现注册页的最后一部分内容，也就是弹窗提示。由于是根据 GET 请求中的 <code>code</code> 参数的值弹出响应的内容，我们在 Web 前端已经学过怎样用 Javascript 来做这件事了。但是 Django 提供了另外一个实现的思路，也就是消息框架。</p><p>具体实现分为两步，一步是添加消息，另一步是显示消息。</p><p>首先是添加信息，我们使用到的是 <code>add_message</code> 方法，例如我们要添加一条 Hello World 信息：</p><pre><code class="lang-python">from django.contrib import messages
messages.add_message(request, messages.INFO, 'Hello World')</code></pre><p>但是我们通常不按照上面的方式写，因为有另外的更简单的写法：</p><pre><code class="lang-python">from django.contrib import messages
messages.info(request, 'Hello World')</code></pre><p>在这里 <code>Hello World</code> 就是通知的内容了，<code>info</code> 指的是通知的级别。你可以将它换成 <code>success</code>、<code>warning</code>、<code>error</code>、<code>debug</code> 中的一种。至于通知级别的用途，简单来说就是用于添加 HTML 标签的类，<span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/ref/contrib/messages/#using-messages-in-views-and-templates" target="_blank">官方文档<i data-feather='external-link'></i></a></span> 有相关的例子，当然我们这里还不需要到。</p><p>回到项目，我们看看怎样根据 <code>code</code> 参数添加响应的信息，编辑 <code>myapp/views.py</code>，我们开始修改我们的 <code>register</code> 视图函数。</p><p>首先是获取 <code>code</code> 参数，回忆一下我们是怎样获取用户的表单信息的，注意这里使用的是 GET 请求。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-06ae66f90c8d0590fdbb1802abda477260" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-06ae66f90c8d0590fdbb1802abda477260" class="panel-body collapse">
</p><pre><code class="lang-python">code = request.GET.get('code', None)</code></pre><p>
</div>
</div></p><p>接下来我们来添加信息，如果不记得 <code>code</code> 值对应的含义的话，可以回看一下 <code>register_to_db</code> 视图函数。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-b2b6d5ac4d4cbadba81d9bf8543ccda792" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-b2b6d5ac4d4cbadba81d9bf8543ccda792" class="panel-body collapse">
</p><pre><code class="lang-python">if code == '-5':
    messages.error(request, &quot;不要没填完就注册啊喂！&quot;)
elif code == '-4':
    messages.error(request, &quot;学 号 格 式 有 误&quot;)
elif code == '-3':
    messages.error(request, &quot;密码需要 6-18 位且必须是英文字母或数字&quot;)
elif code == '-2':
    messages.error(request, &quot;两次密码输入不一致的说&quot;)
elif code == '-1':
    messages.error(request, &quot;这个学号已被注册！请不要试图顶替别人(｡•ˇ‸ˇ•｡)&quot;)</code></pre><p>
</div>
</div></p><p>现在我们的 <code>register</code> 函数也被改得又臭又长了，看看你的函数现在是个什么样子？</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-2dccdeec0b7ef048ed03dac6d5427be963" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-2dccdeec0b7ef048ed03dac6d5427be963" class="panel-body collapse">
</p><p>别忘了导入 <code>messages</code>。</p><pre><code class="lang-python">from django.contrib import messages

def register(request):
    code = request.GET.get('code', None)
    if code == '-5':
        messages.error(request, &quot;不要没填完就注册啊喂！&quot;)
    elif code == '-4':
        messages.error(request, &quot;学 号 格 式 有 误&quot;)
    elif code == '-3':
        messages.error(request, &quot;密码需要 6-18 位且必须是英文字母或数字&quot;)
    elif code == '-2':
        messages.error(request, &quot;两次密码输入不一致的说&quot;)
    elif code == '-1':
        messages.error(request, &quot;这个学号已被注册！请不要试图顶替别人(｡•ˇ‸ˇ•｡)&quot;)
    return render(request, 'register.html')</code></pre><p>
</div>
</div></p><p>接下来是第二步，就是显示消息。</p><p>之前讲过 <code>{% url %}</code> 和 <code>{% static %}</code>，我们接下来要使用更多的 Django 标签，包括 <code>{% if %}</code>、<code>{% endif %}</code> 和 <code>{% for %}</code>、<code>{% endfor %}</code> 标签。我们可以很快地猜出它们的作用，前两个用于判断，后两个用于循环。</p><p>我们考虑我们现在要实现的逻辑，就是如果有消息 <code>messages</code>（不能改为别的名称），我们就遍历这些消息，对于每一个消息 <code>msg</code>（可以改为别的名称），我们执行 <code>alert()</code> 方法。</p><p>我们来看一下代码实现，编辑 <code>myapp/templates/register.html</code>。</p><pre><code class="lang-html">{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>其实是很套路化的，在其它需要到消息的场合代码几乎是一样的，无非是把 <code>script</code> 标签换掉，把 <code>alert</code> 方法换掉。</p><p>到这里注册页的实现已经全部完成啦！</p><h3>Admin 管理工具</h3><p>让我们来看看刚才写的这么多东西到底起作用了没有。简单来说，就是模拟一下注册流程，看看是不是真的有东西写进数据表里面。我们就需要一个可视化的数据库管理工具。MySQL 下有<del>死掉了的</del> PHPMyAdmin 和它的继任者 Adminer，那么 SQLite 呢？</p><p>没错我们终于解锁了讲解「URL 的映射」提到过的神秘的管理工具 <span class="external-link"><a href="http://127.0.0.1:8000/admin/" target="_blank">http://127.0.0.1:8000/admin/<i data-feather='external-link'></i></a></span>。然而直接访问这个页面需要账户密码。</p><p>我们就创建一个超级用户：</p><pre><code>$ python manage.py createsuperuser</code></pre><p>输入你希望设定的账户、邮箱和密码。然后用这个帐号登录这个管理工具。似乎并没有显示我们的模型 <code>STUDB</code>。我们把将这个模型添加进管理工具里面，编辑 <code>myapp/admin.py</code>：</p><pre><code class="lang-python">from myapp.models import STUDB
admin.site.register(STUDB),</code></pre><p>现在管理页面应该能看到我们的模型，但是当我们去尝试注册几个帐号后，在管理页点击我们的模型查看具体的数据的时候（应该是 <span class="external-link"><a href="http://127.0.0.1:8000/admin/myapp/studb/" target="_blank">http://127.0.0.1:8000/admin/myapp/studb/<i data-feather='external-link'></i></a></span> 这个页面），显示的是一个个的 <code>STUDB object</code>，我们希望它能显示学号。</p><p>事实上是有解决方法的，我们编辑 <code>myapp/models.py</code>，在我们的模型类 <code>STUDB</code> 末尾加入这两行：</p><pre><code class="lang-python">def __str__(self):
    return self.userid</code></pre><p>方法名如果是 <code>__xxxx__()</code> 的，那么就有特殊的功能，因此叫做「魔法」方法。当使用 <code>print</code> 输出对象的时候，只要自己定义了 <code>__str__(self)</code> 方法，那么就会打印从在这个方法中 <code>return</code> 的数据，我们通常让它返回一个对象的描述信息。</p><p>刷新页面，这时显示的就是学号了。你还可以尝试将 <code>self.userid</code> 换成其它内容。接下来，让我们愉快地开始注册吧（大雾）。</p><h2>登录页的实现</h2><p>可以说接下来我们要做的就是另一个注册页，几乎是一样的。由于基本的套路都在刚才涉及到了，在阅读前面的部分时候，你也已经做了一部分了，这一部分我们节奏会稍微加快一些。</p><h3>前端部分</h3><p>我们首先实现的依然是模板。在实现注册页时，我们在讲「模板」、「表单处理」和「消息框架」时都涉及到了模板的编辑。博主认为你读到这里的时候应该把前面讲的忘的差不多了，所以给出几个提示：</p><ul><li>模板就是 <code>myapp/templates/</code> 里的那些 HTML 文件。</li><li>样式在制作注册页的时候就已经写好了，所以在这里你只需要引用它就好了。</li><li>尽量使用 <code>{% url %}</code> 标签替代实际的链接，减少硬编码。</li><li>POST 表单都应该使用 <code>{% csrf_token %}</code> 模板标签。</li><li>别忘了如果有信息 <code>messages</code> 要 <code>alert</code> 弹窗显示。</li></ul><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-a750de13e0fbeec8bebb32d71d17151d70" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-a750de13e0fbeec8bebb32d71d17151d70" class="panel-body collapse">
</p><p>新建并编辑 <code>myapp/templates/login.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Login&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;lg_content&quot;&gt;
        &lt;table cellspacing=&quot;30px&quot; style=&quot;width: 250px&quot; align=&quot;center&quot;&gt;
            &lt;tr&gt;
                &lt;td colspan=&quot;2&quot; align=&quot;left&quot;&gt;
                    &lt;span class=&quot;font2&quot; style=&quot;font-size:30px;&quot;&gt;WELCOME TO 1024&lt;/span&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;form action=&quot;{% url 'check_user' %}&quot; method=&quot;post&quot;&gt;
                {% csrf_token %}
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;id&quot; class=&quot;lg_ip&quot; placeholder=&quot;学号&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;passwd&quot; class=&quot;lg_ip&quot; placeholder=&quot;密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td align=&quot;right&quot;&gt;
                        &lt;input type=&quot;submit&quot; value=&quot;提交&quot; class=&quot;button&quot; style=&quot;position:relative;left:-50px&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/form&gt;
            &lt;tr&gt;
                &lt;td align=&quot;left&quot;&gt;
                    &lt;span class=&quot;font1&quot;&gt;没有账号？&lt;/span&gt;
                    &lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;注册&quot;
                        onclick=&quot;location.href='{% url 'register' %}'&quot;&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;

    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;

{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>
</div>
</div></p><h3>后端部分</h3><p>接下来，我们要实现两个视图函数，一个是 <code>login</code>（用于渲染模板）一个是 <code>check_user</code>（用于处理表单）。</p><p>值得留意的地方有三处，首先在注册页我们查询账户是否已经注册是这样实现的：</p><pre><code class="lang-python">users = STUDB.objects.filter(userid=userid)
if len(users) == 1:
    return redirect(reverse('register')+&quot;?code=-1&quot;)</code></pre><p>想想看「验证用户填写的账户密码是否正确」是否能用类似的方式实现呢？</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-f273bfb2083cb106e12f28f5db87fe5f64" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-f273bfb2083cb106e12f28f5db87fe5f64" class="panel-body collapse">
</p><pre><code class="lang-python">users = STUDB.objects.filter(userid=id, passwd=passwd)
if len(users) == 1:
    return redirect(reverse('play')+&quot;?code=1&quot;)
else:
    return redirect(reverse('login')+&quot;?code=-1&quot;)</code></pre><p>
</div>
</div></p><p>第二，我们希望在跳转到闯关页之后，后端可以知道用户是否已经登录。具体的实现需要的是「会话控制」，而 Session 对象转为存储特定用户会话所需的属性及配置信息而生。我们看看相应的代码实现，想想这两行语句应该放置在什么位置：</p><pre><code class="lang-python">request.session['userid'] = id
request.session['is_login'] = '1'</code></pre><p>最后，别忘了在注册成功后，需要我们在<strong>登录页</strong>弹窗提示注册成功。这一部分是在视图函数 <code>register_to_db</code> 实现的，可以回看一下。同样地，考虑一下是否其它页面可能会跳转到登录页的且需要弹窗？</p><p>接下来，我们尝试实现这两个视图函数吧！</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-0c7e7a06e9778da96fbfa58a8cb5e68d47" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-0c7e7a06e9778da96fbfa58a8cb5e68d47" class="panel-body collapse">
</p><p>编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">def login(request):
    code = request.GET.get('code', None)
    if code == '-3':
        messages.error(request, &quot;请 先 登 录&quot;)
    if code == '-2':
        messages.error(request, &quot;不要没填完就登录啊喂！&quot;)
    if code == '-1':
        messages.error(request, &quot;啊哦~登录失败了←_←&quot;)
    if code == '1':
        messages.success(request, &quot;注 册 成 功&quot;)
    return render(request, 'login.html')

def check_user(request):
    id = request.POST.get('id', None)
    passwd = request.POST.get('passwd', None)
    if not id or not passwd:
        return redirect(reverse('login')+&quot;?code=-2&quot;)
    users = STUDB.objects.filter(userid=id, passwd=passwd)
    if len(users) == 1:
        request.session['userid'] = id
        request.session['is_login'] = '1'
        return redirect(reverse('play')+&quot;?code=1&quot;)
    else:
        return redirect(reverse('login')+&quot;?code=-1&quot;)</code></pre><p>
</div>
</div></p><p>接下来别忘了把 <code>check_user</code> 页的映射关系写好：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-f9683816cb4e1c792e029a5e162a950897" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-f9683816cb4e1c792e029a5e162a950897" class="panel-body collapse">
</p><p>编辑 <code>myapp/urls.py</code>：</p><pre><code class="lang-python">urlpatterns = [
    path('', views.index, name='index'),
    path('register/', views.register, name='register'),
    path('login/', views.login, name='login'),
    path('play/', views.play, name='play'),
    path('win/', views.win, name='win'),
    path('register_to_db/', views.register_to_db, name='register_to_db'),
    path('check_user/', views.check_user, name='check_user'),
]</code></pre><p>
</div>
</div></p><h2>闯关页的实现</h2><p>去年有七个关卡，不知道你还记不记得它们分别是什么。但是 <span class="external-link"><a href="https://bobby285271.github.io/SoCoding2019-1024/" target="_blank">题解依然是挂着的<i data-feather='external-link'></i></a></span>，应该能唤起你的一些回忆。</p><p>由于关卡具体的 idea 和实现应该是甩锅甩给新一届师弟师妹做的，而从站点制作的角度来说，每个关卡实现起来其实差不多。正如开头所说，我们这里只完成其中的三个关卡，分别是去年第三、六、七关，当然在这里我们就重新将他们编排为第一、二、三关。</p><h3>前端部分</h3><p>博主认为闯关页部分就做一个页面好了，不然还要做防跳关处理。这意味着每个关卡要做一个模板，在用户访问闯关页的时候就渲染用户当前所在的关卡对应的模板。</p><p>我们从第一关开始（去年是第三关），是过气游戏 Flappy Bird，挂上个十次或者直接来个 F12 就通关了。这里我并不会讲解这个游戏怎样用 Web 前端学到的知识实现出来，而是会告诉你网上一大堆现成的 Javascript 实现可以随便抄。</p><p>但是我们要记得死亡十次通关还是要自己实现的，其实很简单就在重置游戏的地方调用你的计数器函数即可。</p><p>我们开始实现这个小游戏吧！既然需要到 Javascript，还记得 Javascript 这种静态文件要放在什么地方吗？</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-0f00af1724b63cd3ade72821db0fd67038" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-0f00af1724b63cd3ade72821db0fd67038" class="panel-body collapse">
</p><p>新建并编辑 <code>myapp/static/myapp/js/flappybird.js</code>，留意两个注释出现的位置，那就是你添加你的计时器的位置：</p><pre><code class="lang-js">var game = new Phaser.Game(400, 450, Phaser.AUTO, 'game_div');
var game_state = {};
var i = 1;

// 死亡十次通关
function timer(x) {
    i = i + x;
    if (i == 10) {
        alert(&quot;有时候失败就是成功！我看到你的努力了！继续前进吧！flag：2048&quot;);
    }
    if (i == 30) {
        alert(&quot;想再看一次 flag？flag：2048&quot;);
    }
    if (i == 50)
        alert(&quot;你玩很久了，继续闯关吧！&quot;);
}

game_state.main = function () { };
game_state.main.prototype = {
    preload: function () {
        this.game.stage.backgroundColor = '#F0FFFF';
        this.game.load.image('bird', '../static/myapp/img/bird.png');
        this.game.load.image('pipe', '../static/myapp/img/pipe.png');
    },
    create: function () {
        this.bird = this.game.add.sprite(100, 245, 'bird');
        this.bird.body.gravity.y = 1000;
        var space_key = this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
        space_key.onDown.add(this.jump, this);
        this.pipes = game.add.group();
        this.pipes.createMultiple(20, 'pipe');
        this.timer = this.game.time.events.loop(1500, this.add_row_of_pipes, this);
        this.score = 0;
        var style = { font: &quot;30px Arial&quot;, fill: &quot;#ffffff&quot; };
        this.label_score = this.game.add.text(20, 20, &quot;0&quot;, style);
    },
    update: function () {
        if (this.bird.inWorld == false)
            this.restart_game();
        this.game.physics.overlap(this.bird, this.pipes, this.restart_game, null, this);
    },

    jump: function () {
        this.bird.body.velocity.y = -350;
    },

    // 重置游戏
    restart_game: function () {
        if (this.score &gt;= 1) timer(1);
        this.game.time.events.remove(this.timer);
        this.game.state.start('main');
    },

    add_one_pipe: function (x, y) {
        var pipe = this.pipes.getFirstDead();
        pipe.reset(x, y);
        pipe.body.velocity.x = -200;
        pipe.outOfBoundsKill = true;
    },

    add_row_of_pipes: function () {
        var hole = Math.floor(Math.random() * 5) + 1;
        for (var i = 0; i &lt; 8; i++)
            if (i != hole &amp;&amp; i != hole + 1)
                this.add_one_pipe(400, i * 60 + 10);
        this.score += 1;
        this.label_score.content = this.score;
    },
};

game.state.add('main', game_state.main);
game.state.start('main'); </code></pre><p>不需要理解上面代码的实现，但是通过简单的阅读，我们知道我们还需要一张鸟的图片和一张管道的图片：</p><pre><code class="lang-js">this.game.load.image('bird', '../static/myapp/img/bird.png');
this.game.load.image('pipe', '../static/myapp/img/pipe.png');</code></pre><p>去年实际的代码实际上并没有这两张图片，我们补上。在 <code>myapp/static/myapp/img</code> 目录里放置好对应的图片。</p><p>这里我们使用到了硬编码链接，这确实是不被提倡的。但是 Django 标签只能在 <code>myapp/templates/</code> 中起作用，而 Javascript 中的相对路径的编写是要以 HTML 文件所在位置作为基准的。</p><p>当然你可以参考消息框架的实现，选择将部分 Javascript 代码迁移到模板中，使用 <code>&lt;script&gt;&lt;/script&gt;</code> 标签括起来，然后使用 <code>{% static %}</code> 标签替换掉硬编码链接，有兴趣的可自行尝试。</p><p>同样通过简单的阅读，我们知道我们还需要一个 Phaser（一个 HTML 5 游戏开发框架）的 Javascript 文件，从网上下载即可，放置在 <code>myapp/static/myapp/js/phaser.min.js</code>。</p><p>
</div>
</div></p><p>接下来我们在模板引用前面的 Javascript 文件，在写模板的时候别忘记了答案提交表单和消息框架（用来提示答案错误的）。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-b503824611928aa0aaea9a7a4a8af3805" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-b503824611928aa0aaea9a7a4a8af3805" class="panel-body collapse">
</p><p>新建并编辑 <code>myapp/templates/level1.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Level 1&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;containerDiv&quot;&gt;
        &lt;div class=&quot;titleDiv&quot;&gt;
            &lt;div id=&quot;game_div&quot;&gt;
                &lt;span style=&quot;font-family:Microsoft YaHei;color: azure;&quot;&gt;
                    空格键跳跃
                &lt;/span&gt;
            &lt;/div&gt;
            
            &lt;script type=&quot;text/javascript&quot; src=&quot;{% static 'myapp/js/phaser.min.js'%}&quot;&gt;&lt;/script&gt;
     
            &lt;script type=&quot;text/javascript&quot; src=&quot;{% static 'myapp/js/flappybird.js'%}&quot;&gt;&lt;/script&gt;
        &lt;/div&gt;

        &lt;div class=&quot;problemDiv&quot;&gt;
            &lt;div style=&quot;text-align:left;clear:both&quot;&gt;
                &lt;span class=&quot;font2&quot;&gt;
                    手残党的福音&lt;br&gt;
                    怎样通过这一片障碍呢
                &lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;answerDiv&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;{% url 'compare_flag' %}&quot;&gt;
                {% csrf_token %}
                &lt;input type=&quot;text&quot; class=&quot;input&quot; name=&quot;flag&quot;&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;提交&quot;&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>
</div>
</div></p><p>接下来是第二关（去年是第六关）这一关的实现比上一关简单一些，把上一关的 Flappy Bird 换成一张图片就行了，当然图片里面是隐藏了通关信息的。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-470ebcd58359c47eddafceccb2987b2793" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-470ebcd58359c47eddafceccb2987b2793" class="panel-body collapse">
</p><p>我们把 <code>huaji.png</code> 放置到 <code>myapp/static/myapp/img/</code> 目录里面，这就是题目提供的图片了。接下来我们写模板，新建并编辑 <code>myapp/templates/level2.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Level 2&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;containerDiv&quot;&gt;
        &lt;div class=&quot;titleDiv&quot;&gt;
            &lt;span class=&quot;font1&quot;&gt;Level 2&lt;/span&gt;
        &lt;/div&gt;

        &lt;div class=&quot;problemDiv&quot;&gt;
            &lt;span class=&quot;font2&quot;&gt;
                {% load static %}
                &lt;img src=&quot;{%static 'myapp/img/huaji.png'%}&quot; /&gt;
                &lt;!-- 可以打开这个神奇的网站看看哦~ --&gt;
                &lt;!-- http://www.atool9.com/steganography.php --&gt;
            &lt;/span&gt;
        &lt;/div&gt;
        &lt;div class=&quot;answerDiv&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;{% url 'compare_flag' %}&quot;&gt;
                {% csrf_token %}
                &lt;input type=&quot;text&quot; class=&quot;input&quot; name=&quot;flag&quot;&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;提交&quot;&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>
</div>
</div></p><p>最后是第三关（去年是第七关），也不知道去年给大家安利 GitHub 大家用上了没有。这回连图片都不需要了，直接开始写模板。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-b40598cadd2ed87429c8a7300524c7cf81" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-b40598cadd2ed87429c8a7300524c7cf81" class="panel-body collapse">
</p><p>新建并编辑 <code>myapp/templates/level3.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Level 3&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;containerDiv&quot;&gt;
        &lt;div class=&quot;titleDiv&quot;&gt;
            &lt;span class=&quot;font1&quot;&gt;Level 3&lt;/span&gt;
        &lt;/div&gt;

        &lt;div class=&quot;problemDiv&quot;&gt;
            &lt;span class=&quot;font2&quot;&gt;
                https://github.com/bobby285271/SoCoding2019-1024&lt;br&gt;&lt;br&gt;
                &lt;div style=&quot;font-size:18px&quot;&gt;去里面看看吧 //滑稽&lt;/div&gt;
            &lt;/span&gt;
        &lt;/div&gt;
        &lt;div class=&quot;answerDiv&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;{% url 'compare_flag' %}&quot;&gt;
                {% csrf_token %}
                &lt;input type=&quot;text&quot; class=&quot;input&quot; name=&quot;flag&quot;&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;提交&quot;&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>
</div>
</div></p><h3>后端部分</h3><p>同样地，我们要实现两个视图函数，一个是 <code>play</code>（用于渲染模板）一个是 <code>compare_flag</code>（用于处理表单）。要注意的是虽然我们只做了三关，但是他们在这里实际上都是不同的角色，第一关是普通关卡前序关卡，第二关是普通关卡最后一关，第三关是地狱关。</p><ul><li>对于普通关前序关卡，我们只需要更新用户进度即可。</li><li>对于普通关最后一关，除了更新用户进度，我们需要第一次记录用户通关时间。</li><li>对于地狱关，我们要允许用户输入彩蛋 Flag 之后记录用户彩蛋通关时间，同时还要在用户输入正确 Flag 之后记录用户完整通关时间（用于兑奖），无论先输入哪个都要允许用户继续游玩该关卡以输入另一个 Flag，同时输入正确 Flag 后要显示通关页。</li></ul><p>这里有几个要注意的地方：</p><p>首先，实现 <code>play</code> 视图函数的时候，要判断用户是否登录。</p><pre><code class="lang-python">if request.session.get('is_login') == '1':
    # do something
else:
    # do something</code></pre><p>其次，普通关前序关卡处理的逻辑都是一样的。考虑在关卡数增多的情况如何简化代码。</p><p>最后，由于地狱关要始终开放，以供用户输入正确 Flag 和彩蛋 Flag。考虑用户连输多次正确 Flag 的情况，应该如何更新用户进度？</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-eb367c95fed7f07f912f3ff225c3156b28" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-eb367c95fed7f07f912f3ff225c3156b28" class="panel-body collapse">
</p><p>编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">def play(request):
    if request.session.get('is_login') == '1':
        code = request.GET.get('code', None)
        userid = request.session['userid']
        user = STUDB.objects.filter(userid=userid).last()
        if user.rank &lt; 3 and code == '-1':
            messages.error(request, &quot;哎呀，错了orz&quot;)
        if user.rank &gt; 2 and code == '-1':
            messages.error(request, &quot;终局之战总是很坎坷的，请再找找flag是什么吧_(:з」∠)_&quot;)
        if user.rank &gt; 2 and code == '1':
            messages.success(request, '哦吼！恭喜你发现了不得了的β时间线，这一切都是命运石之门的选择~！')
        if user.rank &gt; 3:
            url = 'level3.html'
        else:
            url = 'level' + str(user.rank) + '.html'
        return render(request, url)
    else:
        return redirect(reverse('login')+&quot;?code=-3&quot;)


def compare_flag(request):
    correct_flag = [
        '',
        '2018',
    ]
    flag = request.POST.get('flag', None)
    userid = request.session['userid']
    user = STUDB.objects.filter(userid=userid).last()
    if user.rank &lt; 2:
        if correct_flag[user.rank] == flag:
            user.rank += 1
            user.save()
            return redirect(reverse('play'))
        else:
            return redirect(reverse('play')+&quot;?code=-1&quot;)
    elif user.rank == 2:
        if flag == 'sdltql':
            user.lastflag = timezone.now()
            user.timesubtract = (
                user.lastflag - user.firstflag).total_seconds()
            user.rank += 1
            user.save()
            return redirect(reverse('play'))
        else:
            return redirect(reverse('play')+&quot;?code=-1&quot;)
    elif user.rank &gt; 2:
        if flag == 'happy':
            user.superflag = timezone.now()
            user.timesubtract_last = (
                user.superflag-user.firstflag).total_seconds()
            user.rank = 4
            user.save()
            return redirect(reverse('win'))
        elif flag == '666':
            user.specialflag = timezone.now()
            user.timesubtract_suprise = (
                user.firstflag - user.specialflag).total_seconds()
            user.save()
            return redirect(reverse('play')+&quot;?code=1&quot;)
        else:
            return redirect(reverse('play')+&quot;?code=-1&quot;)
    return redirect(reverse('play'))</code></pre><p>
</div>
</div></p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-14cb9da389f88f0765eef05bd7992abf3" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-14cb9da389f88f0765eef05bd7992abf3" class="panel-body collapse">
</p><p>我赌五毛你会忘记写 <code>compare_flag</code> 的 URL 映射。</p><p>编辑 <code>myapp/urls.py</code>：</p><pre><code class="lang-python">urlpatterns = [
    path('', views.index, name='index'),
    path('register/', views.register, name='register'),
    path('login/', views.login, name='login'),
    path('play/', views.play, name='play'),
    path('win/', views.win, name='win'),
    path('register_to_db/', views.register_to_db, name='register_to_db'),
    path('check_user/', views.check_user, name='check_user'),
    path('compare_flag/', views.compare_flag, name='compare_flag'),
]</code></pre><p>
</div>
</div></p><h2>通关页的实现</h2><p><del>此部分留作习题供读者思考</del>。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-42f261aba4a65910405bb9e68e11e2f259" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-42f261aba4a65910405bb9e68e11e2f259" class="panel-body collapse">
</p><p>模板，编辑 <code>myapp/templates/win.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Win!&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css' %}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;containerDiv&quot;&gt;
        &lt;div class=&quot;titleDiv&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;problemDiv&quot;&gt;
            &lt;span class=&quot;font1&quot; style=&quot;font-size:40px&quot;&gt;
                &lt;p&gt;恭喜你通过所有关卡！&lt;/p&gt;
                &lt;p&gt;1024 程序猿节快乐！&lt;/p&gt;
                &lt;img src=&quot;{%static 'myapp/img/end.jpg' %}&quot; style=&quot;height:250px&quot; /&gt;
                &lt;p&gt;完结撒花！哔哩哔哩-(゜-゜)つロ乾杯~&lt;/p&gt;
            &lt;/span&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre><p>模板中使用了一张图片，放 <code>myapp/static/myapp/img</code> 目录，命名为 <code>end.jpg</code>。</p><p>视图函数，编辑 <code>myapp/templates/win.html</code>：</p><pre><code class="lang-python">def win(request):
    if request.session.get('is_login') == '1':
        userid = request.session['userid']
        user = STUDB.objects.filter(userid=userid).last()
        if user.rank == 4:
            return render(request, 'win.html')
        else:
            return redirect(reverse('play'))
    else:
        return redirect(reverse('login')+&quot;?code=-3&quot;)</code></pre><p>
</div>
</div></p><h2>效果预览</h2><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" data-original="https://bobby285271.coding.net/p/img/d/img/git/raw/master/2019_1024.png" alt="" title="" /></p><p>代码已经上传到 <span class="external-link"><a href="https://github.com/bobby285271/1024-demo" target="_blank">GitHub<i data-feather='external-link'></i></a></span>。</p> </div>

<div class="show-foot">
<div class="notebook">
<i class="fontello fontello-clock-o"></i>
<span>最后修改：2020 年 07 月 23 日 05 : 08 PM</span>
</div>
<div class="copyright" data-toggle="tooltip" data-html="true" data-original-title="转载请保留本文转载地址，著作权归作者所有"><span>© 允许规范转载</span>
</div>
</div>

</div>
</article>
</div>

<nav class="m-t-lg m-b-lg">
<ul class="pager">
<li class="next"> <a class="box-shadow-wrap-normal" href="../../04/15/NixOS-Installation-and-Configuration-Guide.html" title="NixOS Installation and Configuration Guide" data-toggle="tooltip">
下一篇 </a></li> </ul>
</nav>

<style>
            textarea#comment{
                background-image: url('https://s2.ax1x.com/2019/07/20/ZzaGcV.png');
                background-color: #ffffff;
                transition: all 0.25s ease-in-out 0s;
            }
            textarea#comment:focus {
                background-position-y: 105px;
                transition: all 0.25s ease-in-out 0s;
            }
        </style>
<div id="comments">


<div id="respond-post-142" class="respond comment-respond no-borders">
<h4 id="reply-title" class="comment-reply-title m-t-lg m-b">发表评论 <small><i class="glyphicon glyphicon-info-sign" data-toggle="tooltip" title="我们将使用 Cookie 保留您的个人信息以便您下次快速评论，继续评论表示您已同意我们这样做"></i>
</small>
<small class="cancel-comment-reply">
<a id="cancel-comment-reply-link" href="Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html#respond-post-142" rel="nofollow" style="display:none" onclick="if (!window.__cfRLUnblockHandlers) return false; return TypechoComment.cancelReply();" data-cf-modified-6b677945121e6806c012d3d9-="">取消回复</a> </small>
</h4>
<form id="comment_form" method="post" action="https://static.bobby285271.top/index.php/2020/07/15/Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html/comment" class="comment-form" role="form">
<div class="comment-form-comment form-group">
<label class="padder-v-sm" for="comment">评论 <span class="required text-danger">*</span></label>
<textarea id="comment" class="textarea form-control OwO-textarea" name="text" rows="5" placeholder="说点什么吧……" onkeydown="if (!window.__cfRLUnblockHandlers) return false; if(event.ctrlKey&&event.keyCode==13){document.getElementById('submit').click();return false};" data-cf-modified-6b677945121e6806c012d3d9-=""></textarea>
<div class="OwO padder-v-sm"></div>
<div class="secret_comment" id="secret_comment" data-toggle="tooltip" data-original-title="开启该功能，您的评论仅作者和评论双方可见">
<label class="secret_comment_label control-label">私密评论</label>
<div class="secret_comment_check">
<label class="i-switch i-switch-sm bg-dark m-b-ss m-r">
<input type="checkbox" id="secret_comment_checkbox">
<i></i>
</label>
</div>
</div>
</div>

<div id="author_info" class="row row-sm">
<div class="comment-form-author form-group col-sm-6 col-md-4">
<label for="author">名称 <span class="required text-danger">*</span></label>
<div>
<img class="author-avatar" src="https://secure.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=65&r=G&d=" nogallery />
<input id="author" class="form-control" name="author" type="text" value="" maxlength="245" placeholder="姓名或昵称">
</div>
</div>
<div class="comment-form-email form-group col-sm-6 col-md-4">
<label for="email">邮箱 <span class="required text-danger">*</span>
</label>
<input type="text" name="mail" id="mail" class="form-control" placeholder="邮箱 (必填,将保密)" value="" />
<input type="hidden" name="receiveMail" id="receiveMail" value="yes" />
</div>
<div class="comment-form-url form-group col-sm-12 col-md-4">
<label for="url">地址</label>
<input id="url" class="form-control" name="url" type="url" value="" maxlength="200" placeholder="网站或博客"></div>
</div>

<div class="form-group">
<button type="submit" name="submit" id="submit" class="submit btn-rounded box-shadow-wrap-lg btn-gd-primary padder-lg">
<span>发表评论</span>
<span class="text-active">提交中...</span>
</button>
<i class="animate-spin fontello fontello-spinner hide" id="spin"></i>
<input type="hidden" name="comment_post_ID" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent">
</div>
</form>
</div>
</div>
</div>
</div>

<aside class="asideBar col w-md bg-white-only bg-auto no-border-xs" role="complementary">
<div id="sidebar">
<section id="tabs-4" class="widget widget_tabs clear">
<div class="nav-tabs-alt no-js-hide">
<ul class="nav nav-tabs nav-justified box-shadow-bottom-normal tablist" role="tablist">
<li data-index="0" class="active" role="presentation"> <a href="Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html#widget-tabs-4-hots" role="tab" aria-controls="widget-tabs-4-hots" aria-expanded="true" data-toggle="tab"><div class="sidebar-icon wrapper-sm"><i data-feather="thumbs-up"></i></div><span class="sr-only">热门文章</span> </a></li>
<li role="presentation" data-index="1"> <a href="Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html#widget-tabs-4-comments" role="tab" aria-controls="widget-tabs-4-comments" aria-expanded="false" data-toggle="tab"><div class="sidebar-icon wrapper-sm"><i data-feather="message-square"></i></div> <span class="sr-only">最新评论</span> </a></li>
<li data-index="2" role="presentation"> <a href="Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html#widget-tabs-4-random" role="tab" aria-controls="widget-tabs-4-random" aria-expanded="false" data-toggle="tab"> <div class="sidebar-icon wrapper-sm"><i data-feather="gift"></i></div> <span class="sr-only">随机文章</span>
</a></li>
<span class="navs-slider-bar"></span>
</ul>
</div>
<div class="tab-content">

<div id="widget-tabs-4-hots" class="tab-pane  fade in wrapper-md active" role="tabpanel">
<h5 class="widget-title m-t-none text-md">热门文章</h5>
<ul class="list-group no-bg no-borders pull-in m-b-none">
<li class="list-group-item">
<a href="../../02/18/How-to-Port-Calamares-to-Arch-Linux-en.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/8.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../02/18/How-to-Port-Calamares-to-Arch-Linux-en.html" title="How to Port Calamares to Arch Linux (en)"> How to Port Calamares to Arch Linux (en) </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">383</span>
</span>
</small></div></li><li class="list-group-item">
<a href="../../04/15/NixOS-Installation-and-Configuration-Guide.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/4.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../04/15/NixOS-Installation-and-Configuration-Guide.html" title="NixOS Installation and Configuration Guide"> NixOS Installation and Configuration Guide </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">294</span>
</span>
</small></div></li><li class="list-group-item">
<a href="../../02/09/2020-Nowcoder-Basic-Algorithm-Training-Camp-Solutions.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/10.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../02/09/2020-Nowcoder-Basic-Algorithm-Training-Camp-Solutions.html" title="2020 Nowcoder Basic Algorithm Training Camp Solutions"> 2020 Nowcoder Basic Algorithm Training Camp Solutions </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">180</span>
</span>
</small></div></li><li class="list-group-item">
<a href="../../../2019/10/05/How-to-Launch-a-Desktop-Environment-on-WSL-2.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/9.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../../2019/10/05/How-to-Launch-a-Desktop-Environment-on-WSL-2.html" title="How to Launch a Desktop Environment on WSL 2"> How to Launch a Desktop Environment on WSL 2 </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">174</span>
</span>
</small></div></li><li class="list-group-item">
<a href="../../../2019/02/02/Chakra-CCR-Packaging-Guide.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/6.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../../2019/02/02/Chakra-CCR-Packaging-Guide.html" title="Chakra CCR Packaging Guide"> Chakra CCR Packaging Guide </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">162</span>
</span>
</small></div></li> </ul>
</div>

<div id="widget-tabs-4-comments" class="tab-pane fade wrapper-md no-js-show" role="tabpanel">
<h5 class="widget-title m-t-none text-md">最新评论</h5>
<ul class="list-group no-borders pull-in auto m-b-none no-bg">
<li class="list-group-item">
<a href="../../02/18/How-to-Port-Calamares-to-Arch-Linux-en.html#comment-22" class="pull-left thumb-sm avatar m-r">
<img nogallery src="https://q.qlogo.cn/g?b=qq&nk=1724044318&s=100" class="img-40px photo img-square normal-shadow"> </a>
<a href="../../02/18/How-to-Port-Calamares-to-Arch-Linux-en.html#comment-22" class="text-muted">

</a>
<div class="clear">
<div class="text-ellipsis">
<a href="../../02/18/How-to-Port-Calamares-to-Arch-Linux-en.html#comment-22" title="WaMonster"> WaMonster </a>
</div>
<small class="text-muted">
<span>
您好！如果我现在有个liveCD（grub或者isolinux... </span>
</small>
</div>
</li>
<li class="list-group-item">
<a href="../../../archiso.html#comment-18" class="pull-left thumb-sm avatar m-r">
<img nogallery src="https://q.qlogo.cn/g?b=qq&nk=351904948&s=100" class="img-40px photo img-square normal-shadow"> </a>
<a href="../../../archiso.html#comment-18" class="text-muted">

</a>
<div class="clear">
<div class="text-ellipsis">
<a href="../../../archiso.html#comment-18" title="妖刀黄烦烦"> 妖刀黄烦烦 </a>
</div>
<small class="text-muted">
<span>
突然想过来看一下，然后发现多了个评论功能，溜了 </span>
</small>
</div>
</li>
</ul>
</div>

<div id="widget-tabs-4-random" class="tab-pane fade wrapper-md no-js-show" role="tabpanel">
<h5 class="widget-title m-t-none text-md">随机文章</h5>
<ul class="list-group no-bg no-borders pull-in">
<li class="list-group-item">
<a href="../../../2019/02/02/Chakra-CCR-Packaging-Guide.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/8.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../../2019/02/02/Chakra-CCR-Packaging-Guide.html" title="Chakra CCR Packaging Guide"> Chakra CCR Packaging Guide </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">162</span>
</span>
</small></div></li><li class="list-group-item">
<a href="../../../2019/12/26/Dynamic-Programming-on-Tree-Structures-Luogu-P2014.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/4.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../../2019/12/26/Dynamic-Programming-on-Tree-Structures-Luogu-P2014.html" title="Dynamic Programming on Tree Structures (Luogu P2014)"> Dynamic Programming on Tree Structures (Luogu P2014) </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">153</span>
</span>
</small></div></li><li class="list-group-item">
<a href="../../04/15/NixOS-Installation-and-Configuration-Guide.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/10.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../04/15/NixOS-Installation-and-Configuration-Guide.html" title="NixOS Installation and Configuration Guide"> NixOS Installation and Configuration Guide </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">294</span>
</span>
</small></div></li><li class="list-group-item">
<a href="../../../2019/11/17/Dynamic-Prgramming---0-1-Backpack-Problem-Luogu-P1164-P1048-P1020.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/9.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../../2019/11/17/Dynamic-Prgramming---0-1-Backpack-Problem-Luogu-P1164-P1048-P1020.html" title="Dynamic Prgramming - 0/1 Backpack Problem (Luogu P1164, P1048, P1020)"> Dynamic Prgramming - 0/1 Backpack Problem (Luogu P1164, P1048, P1020) </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">153</span>
</span>
</small></div></li><li class="list-group-item">
<a href="../../../2019/12/18/Introduction-to-Segment-Tree-Luogu-P3372.html" class="pull-left thumb-sm m-r"><img src="../../../../usr/themes/handsome/usr/img/sj2/6.jpg" class="img-40px normal-shadow img-square"></a>
<div class="clear">
<h4 class="h5 l-h text-second"> <a href="../../../2019/12/18/Introduction-to-Segment-Tree-Luogu-P3372.html" title="Introduction to Segment Tree (Luogu P3372)"> Introduction to Segment Tree (Luogu P3372) </a></h4>
<small class="text-muted post-head-icon"><span class="meta-date"> <i class="fontello fontello-eye" aria-hidden="true"></i> <span class="sr-only">浏览次数:</span> <span class="meta-value">153</span>
</span>
</small></div></li> </ul>
</div>
</div>
</section>

<section id="blog_info" class="widget widget_categories wrapper-md clear">
<h5 class="widget-title m-t-none text-md">博客信息</h5>
<ul class="list-group box-shadow-wrap-normal">
<li class="list-group-item text-second"><span class="blog-info-icons"> <i data-feather="award"></i></span> <span class="badge
           pull-right">12</span>文章数目</li>
<li class="list-group-item text-second"> <span class="blog-info-icons"> <i data-feather="message-circle"></i></span>
<span class="badge
           pull-right">5</span>评论数目</li>
<li class="list-group-item text-second"><span class="blog-info-icons"> <i data-feather="calendar"></i></span>
<span class="badge
           pull-right">3年210天</span>运行天数</li>
<li class="list-group-item text-second"><span class="blog-info-icons"> <i data-feather="activity"></i></span> <span class="badge
           pull-right">5 天前</span>最后活动</li>
</ul>
</section>


<section id="tag_cloud-2" class="widget widget_tag_cloud wrapper-md clear">
<h5 class="widget-title m-t-none text-md">标签云</h5>
<div class="post-tags tags l-h-2x">
<a href="../../../tag/SCNU/index.html">SCNU</a> <a href="../../../tag/Python/index.html">Python</a> <a href="../../../tag/Guide/index.html">Guide</a> <a href="../../../tag/HTML/index.html">HTML</a> <a href="../../../tag/Django/index.html">Django</a> </div>
</section>
<div id="tag_toc_body">
<section id="tag_toc" class="widget widget_categories wrapper-md clear">
<h5 class="widget-title m-t-none text-md">文章目录</h5>
<div class="tags l-h-2x box-shadow-wrap-normal">
<div id="toc"></div>
</div>
</section>
<div class="hidden-lg tocify-mobile-panel panel panel-default
              setting_body_panel" aria-hidden="true">
<button class="border-radius-half-left btn btn-default no-shadow pos-abt " data-toggle="tooltip" data-placement="left" data-original-title="目录" data-toggle-class=".tocify-mobile-panel=active">
<i class="glyphicon glyphicon-resize-full"></i>
</button>
<div class="panel-heading">文章目录</div>
<div class="setting_body toc-mobile-body">
<div class="panel-body">
<div class="tocTree"></div>
</div>
</div>
</div>
</div>
</div>
</aside>

</div>
</main>
<div id="morphing-content" class="hidden read_mode_article">
<div class="page">
<h1 class="title">Introduction to Django - Illustrated by the Example of SCNUSE SoCoding 1024 Website</h1>
<div class="metadata singleline"><a href="Introduction-to-Django---Illustrated-by-the-Example-of-SCNUSE-SoCoding-1024-Website.html#" rel="author" class="byline">Bobby Rong</a>&nbsp;•&nbsp;<span class="delimiter"></span><time class="date">2020 年 07 月 15 日</time></div>
<p>好久没有出文章了，尝试再造一遍 2019 年 SCNUSE 软协 1024 程序员节活动网站（尽量还原，会有一些差别），算是 Django 框架的一个学习项目吧，<del>搞不好把题目换掉就是今年活动网站了</del>。博主本人的基本功也不怎么扎实，下文用到了非常多不严谨的表述，如果有任何错误欢迎指出。</p><blockquote>更新进度：7 月 23 日基本更新完成。</blockquote><h2>要实现什么</h2><p>去年也是参与到这个活动中来了，但是只是做了一个关卡，比较划水。简单来说整个网站做的就是注册登录（这个没啥好说的）和闯关（七个关卡，根据游戏、图片、代码或文字提示要求用户找出 Flag 并输入，要保存用户进度和通关时间），去年最后具体实现用到的是 Django 框架，使用 MySQL 数据库。</p><p>由于博主快被 ACM 多校训练和团委项目两座大山压垮了，这里就略过需求分析，把注册登录、其中的三个关卡和通关页给做出来。页面的规划、数据表字段的规划等系统分析部分会在文章中穿插。博主使用的是 SQLite 数据库。</p><h2>铺垫</h2><p>博主认为有一些技能在开始动手之前还是要先掌握的。</p><p>首先是 Python，其实有了程序设计基础之后 Python 的语法其实很简单。完全不会 Python 的推荐看 <span class="external-link"><a href="https://github.com/jackfrued/Python-100-Days" target="_blank">Python 100 天教程<i data-feather='external-link'></i></a></span> 前 15 天部分的内容，然后找个 Online Judge 做几道水题，最多两个小时应该都能熟悉。</p><p>然后是 Web 前端 HTML、CSS、Javascript 的一些最基本的应用，学校讲的足够用了，这里推荐 <span class="external-link"><a href="https://www.runoob.com/" target="_blank">菜鸟教程<i data-feather='external-link'></i></a></span>，可以尝试自己写一些小的静态网站。</p><p>最后 Django 本身还是要先做了解的。可以简单浏览 <span class="external-link"><a href="https://github.com/jackfrued/Python-100-Days" target="_blank">Python 100 天教程<i data-feather='external-link'></i></a></span> 第 14 天和第 41 天的内容，另外也推荐阅读官方推荐的一些 <span class="external-link"><a href="https://docs.djangoproject.com/zh-hans/3.0/misc/design-philosophies/" target="_blank">设计理念<i data-feather='external-link'></i></a></span> 。</p><h2>准备</h2><p>先来做一些准备工作，包括开发环境的配置、项目和应用的初始化。开发环境可以按照自己的喜好来配置，不一定要按照这里的来；项目和应用的初始化有对应的具体的命令，执行即可。</p><h3>开发环境</h3><p>要做的事情就是安装一个对 Python 支持良好的 IDE 或者为你的代码编辑器添加 Python 支持，然后安装 Django。</p><p>假设你跟我一样已经是 Arch Linux + VS Code 用户。VS Code 下的 Python 支持是需要到 pip 的，pip 是 Python 的包管理器，直接使用 Linux 下的包管理器安装。</p><pre><code># pacman -S python-pip</code></pre><p>pip 既然是包管理器，能条件反射到的是肯定要换源，我们在家目录创建并编辑 <code>.pip/pip.conf</code>：</p><pre><code>$ cd 
$ mkdir .pip
$ nano .pip/pip.conf</code></pre><pre><code>[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple</code></pre><p>启动 VS Code，先装上 Python 扩展和 Visual Studio IntelliCode 扩展，然后打开任意 Python 文件，尝试格式化文档，VS Code 就会提示你安装格式化程序，安装就可。可以观察到实质就是调用 pip 安装 <code>autopep8</code>。</p><p>接下来安装 Django，这里有两个方法，一个是继续使用 Linux 下的包管理器安装：</p><pre><code># pacman -S python-django</code></pre><p>或者是用上面刚刚讲到的 pip：</p><pre><code>$ pip install django</code></pre><p>要注意的是给 Arch Linux 软件包锁版本是不被提倡的，毕竟是滚动更新发行版。所以如果你使用 Pacman 安装 <code>python-django</code> 就得一直跟着系统走用最新版，要考虑其利弊。</p><p>接下来尝试使用 <code>django-admin</code> 命令，测试一下是不是一切都准备妥当了：</p><pre><code>$ django-admin version</code></pre><p>理想情况是输出一个版本号。如果提示命令没有找到，那就是在普通用户下使用 pip 按照 Django 导致 <code>django-admin</code> 不在 PATH 里。解决方法很多，例如改用 root 安装，或是修改 PATH，可以参考 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/faq/troubleshooting/#troubleshooting-django-admin" target="_blank">官方文档<i data-feather='external-link'></i></a></span>。</p><h3>创建项目</h3><p>我们首先使用 <code>django-admin</code> 命令为站点创建一个已经初始化的项目目录，不妨叫 <code>mysite</code>。</p><blockquote>如果你起的名字跟我的不一样，只要看到 <code>mysite</code> 改过来就行，另外不要用保留字命名，后面也是一样的道理。</blockquote><pre><code>$ django-admin startproject mysite
$ cd mysite</code></pre><p>进入项目目录之后，应该能见到另一个 <code>mysite/</code> 目录和一个 <code>manage.py</code> 文件：</p><ul><li><code>mysite/</code> 包含了 Django 项目实例需要的设置项集合，包括数据库配置、Django 配置和应用配置。</li><li><code>manage.py</code> 就是一个让你用各种方式管理 Django 项目的命令行工具。</li></ul><p>我们约定，后面涉及的所有文件和文件夹均以当前所在的项目目录为基准标注<strong>相对路径</strong>。</p><h3>创建应用</h3><p>在 Django 中，每一个应用都是一个 Python 包。<strong>应用</strong>通常是一个专门做某件事的网络应用程序，比如博客系统、投票程序。<strong>项目</strong>则是一个网站使用的配置和应用的集合。一个项目可以包含很多个应用，但这里我们只创建一个，就叫 <code>myapp</code>：</p><pre><code>$ python manage.py startapp myapp</code></pre><p>接下来往项目添加这个应用。编辑 <code>mysite/settings.py</code>，找到 <code>INSTALLED_APPS</code>：</p><blockquote>这里没有展示整个的完整的文件，只会展示需要改动的代码或是关键的代码，后面也是一样的道理。我们会在文末附上成品的代码，可以结合成品代码理解。</blockquote><pre><code class="lang-python">INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'myapp',
]</code></pre><h2>站点调试</h2><p>我们可以利用 <code>manage.py</code> 运行 Django 自带的用于开发的简易 Web 服务器对我们的网站进行预览和调试。</p><blockquote>不要将这个服务器用于和生产环境相关的任何地方，这个服务器只是为了开发而设计的。</blockquote><pre><code>$ python manage.py runserver</code></pre><p>终端应该会输出类似这样的东西：</p><pre><code>Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.</code></pre><p>按照上面的输出，我们打开浏览器访问 <span class="external-link"><a href="http://127.0.0.1:8000/" target="_blank">http://127.0.0.1:8000/<i data-feather='external-link'></i></a></span>，在下文中我们假设你的服务器设置和我的一样为监听本机内部 IP 的 <code>8000</code> 端口。在一个网页都没有完成的情况下，你应该能看到 Django 自带的测试页面。当我们写好我们的网站之后则应该能看到自己的网站，测试页面就不会再出现了。</p><p>现在我们尝试将测试页面改成中文的，其实是为 Django 设置语言。编辑 <code>mysite/settings.py</code>：</p><pre><code class="lang-python">LANGUAGE_CODE = 'zh-hans'
TIME_ZONE = 'Asia/Shanghai'</code></pre><p>不必重新启动服务器，直接刷新页面，现在测试页面显示的是中文，你的改动生效了。通常来说服务器会对每一次的访问请求重新载入一遍 Python 代码，但是例外还是有的（如添加新文件）。如果你发现你的改动没有生效，尝试重启服务器就好了。</p><p>如果你想把服务器停掉，就按照终端的提示按下 Ctrl + C 组合键即可，和 Linux 杀死其它命令的方式是一样的。</p><h2>第一个页面</h2><p>几乎所有教程做第一个页面都是 Hello World，虽然这和 1024 站点没啥关联，我们也先实现一下，目标是访问站点首页后显示一行文字 <code>Hello World</code>。</p><p>博主认为虽然是 Hello World，但可能还是会有点难度。其实不需要纠结太多，关键是记住具体的实现，知道哪些地方是套路，哪些地方要改动。我们在后面会制作更多的页面，自然就会熟悉了。</p><h3>响应与视图函数</h3><p><strong>视图函数</strong>（简称视图）是一个简单的 Python 函数，它接受 Web 请求并且返回 Web 响应。响应可以是 HTML、重定向、404、XML、图片等等。无论视图函数本身包含什么逻辑，都要返回响应。我们通常将视图函数放置在 <code>views.py</code> 文件中。</p><p>我们现在只需要在页面上显示上一行 <code>Hello World</code>，所以这个视图函数不需要做什么，直接返回响应就行。既然是首页，不妨将函数命名为 <code>index</code>，我们看看具体的实现。编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">from django.shortcuts import render, redirect
from django.http import HttpResponse

def index(request):
    return HttpResponse(&quot;&lt;h1&gt;Hello, World&lt;/h1&gt;&quot;)</code></pre><p>视图函数就写好啦！这里我们用到了 <code>HttpResponse</code> 对象，你可以翻阅 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/ref/request-response/#httpresponse-objects" target="_blank">官方文档<i data-feather='external-link'></i></a></span> 了解这个对象，并尝试将 <code>&lt;h1&gt;Hello, World&lt;/h1&gt;</code> 改成其它内容。</p><h3>URL 的映射</h3><p>接下来我们建立 URL（统一资源定位符）与视图函数 <code>index</code> 的映射。具体可以分成两步，第一步是在应用下面处理自己的映射关系，第二步是进行路由分发。</p><p>博主认为这可以理解为一个相对路径的确定，当然这里的路径指的是我们访问的 URL，和项目文件的放置没有关联。第一步实际上就是将应用根目录的绝对路径作为基准，确定各个网页的相对路径。第二步就是将项目根目录的绝对路径作为基准，确定各个应用根目录的相对路径。</p><p>现在我们想在首页显示 Hello World，我们来看看具体的实现。</p><p>先来做第一步，在 <code>myapp</code> 下面新建一个 <code>urls.py</code>：</p><pre><code class="lang-python">from django.urls import path
from . import views

urlpatterns = [
    path('', views.index, name='index'),
]</code></pre><p><code>path('', views.index, name='index')</code> 可以理解为这个网页就位于应用的根目录，响应的是 <code>views.py</code> 文件里的 <code>index</code> 函数。而最后的 <code>name='index'</code> 则是指定 <code>name</code> 属性，这里的 <code>name</code> 和 HTML 下的 <code>id</code> 属性是类似的，必须要唯一。我们会在后面用到它。</p><p>再来做第二步，编辑 <code>mysite/urls.py</code>：</p><pre><code class="lang-python">from django.contrib import admin
from django.urls import include, path

urlpatterns = [
    path('', include('myapp.urls')),
    path('admin/', admin.site.urls),
]</code></pre><p><code>path('', include('myapp.urls'))</code> 可以理解为 <code>myapp</code> 这个应用的根目录就位于项目的根目录，<code>path('admin/', admin.site.urls)</code> 为 Django 自带的管理页面，可以暂时不用理会，我们会在后面用到它。</p><p>当然了这样的理解自然是不严谨的，还是建议大家深入了解 URL 和路由，详情可以查阅 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/topics/http/urls/" target="_blank">官方文档<i data-feather='external-link'></i></a></span>。</p><p>现在使用 <code>python manage.py runserver</code> 调试，访问 <span class="external-link"><a href="http://127.0.0.1:8000/" target="_blank">http://127.0.0.1:8000/<i data-feather='external-link'></i></a></span>，显示的是 Hello World 页了。你可以尝试再对 <code>myapp/urls.py</code> 和 <code>mysite/urls.py</code> 进行编辑，看看 Hello World 页是否能在你期望的位置出现。</p><h3>更多的页面</h3><p>有了 Hello World 页的铺垫之后，我们就可以愉快地进行页面规划了。</p><p>我们需要做的实际上只有四个页面，一个是注册页（<code>register</code>），一个是登录页（<code>login</code>），一个是闯关页（<code>play</code>），还有一个通关页（<code>win</code>）。现在我们不需要把他们实际的功能做出来，而是做四个 Hello World 页，这时为了避免因为「挖了坑没填完」而导致的站点调试时报错。</p><p>现在我们就来仿照上面 Hello World 页的例子，初始化注册页、登录页、闯关页和通关页。具体来说，我们为他们分别写一个临时的视图函数并建立好 URL 映射。我们后面每一章都会展开说明一个页面具体的实际的实现，届时再对我们的视图函数做进一步的修改，也有可能因为处理表单的需要继续创建页面。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-87dc583a4e0c562779996c313a40a1ff77" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-87dc583a4e0c562779996c313a40a1ff77" class="panel-body collapse">
</p><p>首先我们写视图函数，编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">def register(request):
    return HttpResponse(&quot;&lt;p&gt;这是注册页&lt;/p&gt;&quot;)

def login(request):
    return HttpResponse(&quot;&lt;p&gt;这是登录页&lt;/p&gt;&quot;)

def play(request):
    return HttpResponse(&quot;&lt;p&gt;这是闯关页&lt;/p&gt;&quot;)

def win(request):
    return HttpResponse(&quot;&lt;p&gt;这是通关页&lt;/p&gt;&quot;)</code></pre><p>接下来我们建立 URL 映射，编辑 <code>myapp/urls.py</code>：</p><pre><code class="lang-python">urlpatterns = [
    path('', views.index, name='index'),
    path('register/', views.register, name='register'),
    path('login/', views.login, name='login'),
    path('play/', views.play, name='play'),
    path('win/', views.win, name='win'),
]</code></pre><p>路由分发我们在做 Hello World 页的时候已经做好了，无需再做改动。</p><p>
</div>
</div></p><p>现在使用 <code>python manage.py runserver</code> 调试，访问 <span class="external-link"><a href="http://127.0.0.1:8000/register/" target="_blank">http://127.0.0.1:8000/register/<i data-feather='external-link'></i></a></span> 查看注册页目前的效果。然后尝试访问登录页、关卡页和通关页。</p><h2>注册页的实现</h2><p>现在访问注册页，显示的只有五个字「这是注册页」，但我们实际需要的是：前端一个表单供用户输入账户密码，后端处理用户输入与数据库交互。接下来，我们会根据实际的需求进一步改造这个注册页，使其达到我们所要的效果。</p><h3>模板</h3><p>首先我们改造注册页的前端部分，刚刚学完 Web 前端，应该不是什么难点。现在的问题讲通俗点就是，怎样做到我访问这个地址就给我渲染指定的 HTML 文件呢？</p><p>一个方法是，我把这个 HTML 文件的内容压成一行，换掉 <code>&lt;p&gt;这是注册页&lt;/p&gt;</code> 。可以是可以，但是一个很最突出的问题是维护起来很难受。事实上这样子其实是将数据与视图混合在一起，我们说是不符合 Django 的 MVC 思想（Model View Controller，具体请百度）。于是我们有了另外一个东西叫做<strong>模板</strong>。我们可以在 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/howto/overriding-templates/" target="_blank">官方文档 How-to 部分<i data-feather='external-link'></i></a></span> 找到相关的文档。</p><p>目前而言，你可以简单地把模板跟 HTML 文件划上等号，我们后面会介绍 Django 标签，届时你将会进一步了解模板的神奇之处。模板是有专门地方存放的，在 <code>myapp/</code> 下面建立一个 <code>templates/</code> 文件夹。接下来往里面放你的 HTML 文件。</p><p>例如我把注册页命名为 <code>register.html</code>，也就是说文件的相对路径为 <code>myapp/templates/register.html</code>。就和初学 Web 前端一样，先不要管样式，也不要管按钮链接能不能工作，这些在后面会提及。</p><p>为了节省时间，这里就直接开抄了。以下的代码为去年的代码改动而来：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-690658cea5ac1872ab467babf6564e7a21" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-690658cea5ac1872ab467babf6564e7a21" class="panel-body collapse">
</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Register&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;lg_content&quot;&gt;
        &lt;table cellspacing=&quot;30px&quot; align=&quot;center&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;#&quot;&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;userid&quot; class=&quot;reg_ip&quot; placeholder=&quot;学号&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;username&quot; class=&quot;reg_ip&quot; placeholder=&quot;昵称&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;passwd&quot; class=&quot;reg_ip&quot; placeholder=&quot;密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;repasswd&quot; class=&quot;reg_ip&quot; placeholder=&quot;确认密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;

                &lt;tr&gt;
                    &lt;td align=&quot;left&quot;&gt;

                        &lt;input type=&quot;submit&quot; value=&quot;注册&quot; style=&quot;position:relative;left:40px;&quot; class=&quot;button&quot;&gt;

                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/form&gt;
            &lt;td align=&quot;center&quot; style=&quot;position:relative;left:-50px&quot;&gt;
                &lt;span class=&quot;font1&quot;&gt;已经注册？&lt;/span&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;直接登录&quot;
                    onclick=&quot;location.href='#'&quot;&gt;
            &lt;/td&gt;
        &lt;/table&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre><p>
</div>
</div></p><p>接下来我们把「注册页」三个字换掉，这里我们使用的是 <code>render</code> 方法，它可接收三个参数，一是 <code>request</code> 参数，二是待渲染的 HTML 模板文件，三是保存具体数据的字典参数。它的作用就是将数据填充进模板文件，最后把结果返回给浏览器。编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">def register(request):
    return render(request, 'register.html')</code></pre><p>我们再访问 <span class="external-link"><a href="http://127.0.0.1:8000/register/" target="_blank">http://127.0.0.1:8000/register/<i data-feather='external-link'></i></a></span>，发现已经有一个注册页面的样子了。</p><h3>静态资源</h3><p>现在我们来做注册页的样式吧！你们可能尝试过在 <code>myapp/templates/</code> 直接放一个 CSS 文件，然后在 <code>myapp/templates/register.html</code> 直接加 <code>&lt;link href=&quot;style.css&quot; rel=&quot;stylesheet&quot;&gt;</code>，你会发现是行不通的。调试的时候，你会发现它实际请求的是 <span class="external-link"><a href="http://127.0.0.1:8000/register/style.css" target="_blank">http://127.0.0.1:8000/register/style.css<i data-feather='external-link'></i></a></span>，直接 404。</p><p>注意到 <code>mysite/settings.py</code> 有这么一行：</p><pre><code class="lang-python"># Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/3.0/howto/static-files/

STATIC_URL = '/static/'</code></pre><p>事实上，关于静态资源的存放，<span class="external-link"><a href="https://docs.djangoproject.com/zh-hans/3.0/howto/static-files/" target="_blank">官方文档 How-to 部分<i data-feather='external-link'></i></a></span> 依然给出了具体的说明。和模板类似，我们要单独建立 <code>static/</code> 目录来存放这些静态资源。通常我们把这个目录放在应用目录下，我们 <code>myapp/</code> 下新建 <code>static/</code> 目录，里面再建一个 <code>css/</code> 目录。</p><p>接下来，我们尝试往 <code>css/</code> 目录里面添加我们的样式。这个样式我们会在后面多次使用，编辑 <code>myapp/static/css/style.css</code>，这里我们继续偷懒开抄：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-09f8930ec5f1b5589edef856db7e99dc68" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-09f8930ec5f1b5589edef856db7e99dc68" class="panel-body collapse">
</p><pre><code class="lang-css">body {
    /* background: url(&quot;../img/bg_img.jpg&quot;); */
    /* background-size: cover; */
    margin: 0px;
    padding: 0px;
    text-align: center;
}

.containerDiv {
    margin-top: 0;
    margin-bottom: 0;
    background-size: 100% 100%;
    width: 100%;
    text-align: center;
}

.lg_content {
    margin-top: 100px;
}

.titleDiv {
    width: 100%;
    height: 150px;
}

.problemDiv {
    width: 80%;
    height: 360px;
    margin-left: 10%;
    margin-right: 10%;
    position: relative;
}

.leftDiv {
    width: 50%;
    height: 360px;
    text-align: center;
    float: left;
}

.rightDiv {
    width: 40%;
    margin-left: 10%;
    height: 360px;
    text-align: center;
    float: left;
}

.answerDiv {
    width: 100%;
    height: 60px;
    position: relative;
}

.background {
    background-size: 100% 100%;
    width: 100%;
    height: 100%;
}

.button {
    width: 68px;
    height: 34px;
    font-size: 18px;
    color: rgb(255, 255, 255);
    background-color: rgb(76, 129, 179);
    box-shadow: none;
    border: none;
    border-style: inline;
}

.input {
    height: 40px;
    width: 250px;
    font-size: 14px;
    color: rgba(155, 152, 151, 0.774);
    border: none;
    box-shadow: none;
    border-style: none;
    border-width: 0px;
}

.font1 {
    font-family: &quot;Microsoft YaHei&quot;;
    font-size: 12px;
    font-weight: bold;
    color: azure;
}

.font2 {
    font-family: &quot;Microsoft YaHei&quot;;
    font-size: 22px;
    width: 400px;
    color: rgb(88, 99, 192);
}

#game_div,
p {
    width: 400px;
    margin: auto;
    margin-top: 0px;
}</code></pre><p>
</div>
</div></p><p>根据 <code>STATIC_URL = '/static/'</code> 这一线索，我们尝试访问 <span class="external-link"><a href="http://127.0.0.1:8000/static/css/style.css" target="_blank">http://127.0.0.1:8000/static/css/style.css<i data-feather='external-link'></i></a></span>，发现确实是有这个文件的。</p><p>事实上，只要将 <code>&lt;link href=&quot;style.css&quot; rel=&quot;stylesheet&quot;&gt;</code> 改成 <code>&lt;link href=&quot;/static/css/style.css&quot; rel=&quot;stylesheet&quot;&gt;</code> 就可以往页面加载样式了。</p><p><strong>但是</strong>，这样后续维护是很困难的。</p><p>一个问题是如果我们后面突然又需要创建应用，需要的是不同的样式呢？想象一下，你有两个应用 <code>myapp</code> 和 <code>yourapp</code>，然后你在 <code>myapp/static/css/style.css</code> 和 <code>yourapp/static/css/style.css</code> 放了不同的样式文件，你访问 <span class="external-link"><a href="http://127.0.0.1:8000/static/css/style.css" target="_blank">http://127.0.0.1:8000/static/css/style.css<i data-feather='external-link'></i></a></span> 得到的是什么呢？</p><p>对这个问题，官方的解决方案是，在 <code>myapp/static/</code> 下面再建立一个目录 <code>myapp</code>（就是应用本身的名称），然后把静态资源放里面，我们尝试将 <code>myapp/static/css</code> 目录移动到 <code>myapp/static/myapp/css</code>。现在我们在 <span class="external-link"><a href="http://127.0.0.1:8000/static/myapp/css/style.css" target="_blank">http://127.0.0.1:8000/static/myapp/css/style.css<i data-feather='external-link'></i></a></span> 可以看到我们的样式文件了。</p><p>另一个问题是如果我突然想更换一下映射到静态资源的 URL 呢？也就是说我把 <code>STATIC_URL = '/static/'</code> 改成别的，是不是所有的 HTML 文件我要逐个修改呢？</p><p>所以我们是不建议按照前面的方式去写的，我们有一个船新的方法。编辑 <code>myapp/templates/register.html</code>：</p><pre><code class="lang-html">&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;register&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;</code></pre><p>要注意的是 <code>{% load static %}</code> 和 <code>{%static 'myapp/css/style.css'%}</code> 的 <code>static</code> 和 <code>STATIC_URL = '/static/'</code> 中的路径 <code>static</code> 是没有任何联系的，就是静态资源的意思。你可以尝试将 <code>STATIC_URL</code> 改成别的再来试试。</p><p>现在访问 <span class="external-link"><a href="http://127.0.0.1:8000/register/" target="_blank">http://127.0.0.1:8000/register/<i data-feather='external-link'></i></a></span>，F12 看一下，会发现上面 <code>{% %}</code> 标签的内容都已经被替换掉了。</p><p>接下来是背景图片。同样地，我们将 <code>bg_img.jpg</code> 放置在 <code>myapp/static/myapp/img/</code> 目录中。这回没那么复杂，在 CSS 文件里引用时直接写相对路径即可，因为无论怎么修改 <code>STATIC_URL</code> 都不会对其产生影响：</p><pre><code class="lang-css">body {
    background: url(&quot;../img/bg_img.jpg&quot;);
    background-size: cover;
    margin: 0px;
    padding: 0px;
    text-align: center;
}</code></pre><p>好了，现在注册页看上去跟去年是一个样子了。</p><h3>数据库与模型</h3><p>来到后端部分了！后端部分是离不开数据库的，我们首先把数据库配置好。这里我们使用的是 SQLite 数据库，为什么在这个项目使用 SQLite 呢？</p><ul><li>轻量，无客户端和服务器端之分，跨平台，单文件。</li><li>我们现在做的网站也只是供我们自娱自乐的而已，没有高并发。</li><li>Python 内置 SQLite，所以你无需安装额外东西来使用它。</li><li>不需要事先创建数据库，数据库会在需要的时候自动创建。</li><li>Django 默认的数据库就是 SQLite，我们查看 <code>mysite/settings.py</code>：</li></ul><pre><code class="lang-python">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
    }
}</code></pre><p>让我们开始吧！首先我们对设定的数据库进行初始化：</p><pre><code>$ python manage.py migrate</code></pre><p>所谓的初始化实际上是<strong>迁移</strong>操作，为在 <code>mysite/settings.py</code> 涉及到的 <code>INSTALLED_APPS</code> 创建一些数据表。这里先不需要去纠结具体是做什么的，有兴趣的可以查看 <span class="external-link"><a href="https://docs.djangoproject.com/zh-hans/3.0/intro/tutorial02/#database-setup" target="_blank">官方文档<i data-feather='external-link'></i></a></span>。我们在后面还会使用到这个命令，到时再做说明。</p><p>接下来我们进行数据表字段的规划。在 Django，我们称数据库结构设计为<strong>模型</strong>。你可以把模型类比为数据库里的数据表，在这里我们只需要为学生这个对象创建一个模型，不妨将它命名为 <code>STUDB</code>。</p><p>下面我们就来实现这个模型，博主认为整个流程和 Git 提交代码的流程非常类似。在 Git 我们并不会在版本库直接改动代码，而是：</p><ul><li>第一步，你在工作区对文件作出改动，你的改动并不会影响到版本库。</li><li>第二步，<code>git add</code>：你的改动从工作区被转移到了暂存区。</li><li>第三步，<code>git commit</code>：你的改动从暂存区被转移到了版本库。</li></ul><p>在这个项目，我们的第一步就是编辑 <code>myapp/models.py</code> 文件，在文件记录我们需要的模型。</p><p>作为我们需要建立的唯一一个模型，我们要为其添加的字段有：</p><table><thead><tr><th>字段名</th><th>数据类型</th><th>作用</th><th>备注</th></tr></thead><tbody><tr><td><code>userid</code></td><td>文本 <code>TextField</code></td><td>学号</td><td>最大长度为 11 <code>max_length=11</code></td></tr><tr><td><code>username</code></td><td>文本 <code>TextField</code></td><td>昵称</td><td>最大长度为 10 <code>max_length=10</code></td></tr><tr><td><code>passwd</code></td><td>文本 <code>TextField</code></td><td>密码</td><td>最大长度为 20 <code>max_length=20</code></td></tr><tr><td><code>firstflag</code></td><td>时间 <code>DateTimeField</code></td><td>普通关卡开始时间</td><td>默认是当前时间</td></tr><tr><td><code>lastflag</code></td><td>时间 <code>DateTimeField</code></td><td>普通关卡通关时间</td><td>默认是当前时间</td></tr><tr><td><code>superflag</code></td><td>时间 <code>DateTimeField</code></td><td>最后一关通关时间</td><td>默认是当前时间</td></tr><tr><td><code>specialflag</code></td><td>时间 <code>DateTimeField</code></td><td>彩蛋通关时间</td><td>默认是当前时间</td></tr><tr><td><code>rank</code></td><td>整数 <code>IntegerField</code></td><td>通关记录</td><td>默认是 1</td></tr><tr><td><code>timesubtract</code></td><td>整数 <code>IntegerField</code></td><td>普通关卡时间差</td><td>默认是 0</td></tr><tr><td><code>timesubtract_last</code></td><td>整数 <code>IntegerField</code></td><td>最后一关时间差</td><td>默认是 0</td></tr><tr><td><code>timesubtract_suprise</code></td><td>整数 <code>IntegerField</code></td><td>彩蛋时间差</td><td>默认是 0</td></tr></tbody></table><p>我们可以在 <span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/ref/models/fields/#textfield" target="_blank">官方文档<i data-feather='external-link'></i></a></span> 找到可能需要用到的数据类型。</p><p>接下来我们将表格转为代码。在 <code>myapp/models.py</code> 在这个文件中，每个模型被表示为一个<strong>类</strong>。每个模型有许多类变量，它们都表示模型里的一个数据库字段。</p><p>我们可以在 <span class="external-link"><a href="https://docs.djangoproject.com/zh-hans/3.0/intro/tutorial02/#creating-models" target="_blank">官方文档<i data-feather='external-link'></i></a></span> 找到很多代码实现的例子。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-182a3aaa0902bd5a75df86c673042fa61" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-182a3aaa0902bd5a75df86c673042fa61" class="panel-body collapse">
</p><pre><code class="lang-python">from django.db import models
import django.utils.timezone as timezone

class STUDB(models.Model):
    userid = models.TextField(max_length=11)
    username = models.TextField(max_length=10)
    passwd = models.TextField(max_length=20)
    firstflag = models.DateTimeField(default=timezone.now)
    lastflag = models.DateTimeField(default=timezone.now)
    superflag = models.DateTimeField(default=timezone.now)
    specialflag = models.DateTimeField(default=timezone.now)
    rank = models.IntegerField(default=1)
    timesubtract = models.IntegerField(default=0)
    timesubtract_last = models.IntegerField(default=0)
    timesubtract_suprise = models.IntegerField(default=0)</code></pre><p>
</div>
</div></p><p>接下来是第二步，我们让 Django 检测你对模型文件的修改，并且把修改的部分储存为一次迁移。</p><pre><code class="lang-python">$ python manage.py makemigrations</code></pre><p>最后是第三步，在数据库里创建新定义的模型的数据表。</p><pre><code>$ python manage.py migrate</code></pre><h3>表单处理与数据库交互</h3><p>既然数据库已经配置完毕，接下来我们要做的是读取用户的输入并写入数据库。</p><p>怎样获取和处理用户的输入呢？Web 前端曾经讲过怎样用 Javascript 处理 GET 请求和 POST 请求，这里也是类似的，甚至还简单一些。</p><p>首先还是要回到前端，我们已经写了一个 form 表单，目前我们的 <code>form</code> 标签是这样的：</p><pre><code class="lang-html">&lt;form method=&quot;post&quot; action=&quot;#&quot;&gt;&lt;/form&gt;</code></pre><p>我们需要将 <code>action</code> 属性补充完整。为此我们需要另外制作一个「页面」用来接收表单的信息，这个页面不一定要给用户看到些什么。我们在这个页面处理完用户的信息后就会跳转到相应的页面。我们把这个页面命名为 <code>register_to_db</code>。</p><p>我们来写一下视图函数，这回我们需要进行一些逻辑上的处理了，所以这个函数注定要写的又臭又长，我们拆分一下我们要实现的逻辑。</p><p>首先，我们要接收表单发过来的 POST 请求。在 Web 前端课程上，我们已经知道前端表单的 <code>name</code> 属性会被用于对提交到服务器后的表单数据进行标识。所以我们现在要接收的，就是 <code>userid</code>、<code>username</code>、<code>passwd</code> 和 <code>repasswd</code>。</p><pre><code class="lang-python">userid = request.POST.get('userid', None)
username = request.POST.get('username', None)
passwd = request.POST.get('passwd', None)
repasswd = request.POST.get('repasswd', None)</code></pre><p>接下来，我们看看学号是否已经被注册，如果被注册了，我们就跳转回注册页。从这里开始，我们就要用到数据库的增删改查操作了，然而我们并不需要写 SQL 语句，因为 Django 模型使用自带的对象关系映射（ORM）连接业务逻辑层和数据库层。简单来说，ORM 会将 Python 代码转成为 SQL 语句。</p><p><span class="external-link"><a href="https://www.runoob.com/django/django-model.html" target="_blank">菜鸟教程<i data-feather='external-link'></i></a></span> 提供了数据库增删改查实现的不少例子，可供参考。</p><p>我们也来照葫芦画瓢，首先导入我们的模板，接下来我们使用 <code>filter</code> 方法查询学号信息，返回一个列表：</p><pre><code class="lang-python">from .models import STUDB
users = STUDB.objects.filter(userid=userid)</code></pre><p>如果这个列表不为空，意味着这个学号已经被注册，我们就跳转回注册页。怎样实现跳转呢，可以想到的第一个方法是直接使用之前讲过的 <code>render</code> 方法：</p><pre><code class="lang-python">if len(users) == 1:
    return render(request, 'register.html')</code></pre><p>会发现确实是重新「显示」注册页了，但是我们看 URL 并没有变，依然是 <span class="external-link"><a href="http://127.0.0.1:8000/register_to_db/" target="_blank">http://127.0.0.1:8000/register_to_db/<i data-feather='external-link'></i></a></span>。我们不要忘了 <code>register.html</code> 只是一个模板而已。但是我们希望的是跳转到 <span class="external-link"><a href="http://127.0.0.1:8000/register/" target="_blank">http://127.0.0.1:8000/register/<i data-feather='external-link'></i></a></span>。这里我们就要介绍到我们的 <code>redirect</code> 方法了，它专为重定向而生，我们看看它最基本的使用方法：</p><pre><code class="lang-python">if len(users) == 1:
    return redirect(&quot;http://127.0.0.1:8000/register/&quot;)</code></pre><p>和我们学 Web 前端接触的 <code>a</code> 标签的 <code>href</code> 属性几乎一样，填上 URL 就行。当然，上面这样填写绝对路径是不利于后续维护的。哪怕改成相对路径 <code>redirect(&quot;../register/&quot;)</code>，由于我们可以随时修改 <code>myapp/urls.py</code> 中的映射关系，事实上也不是最优方法。事实上对于所有的模板，我们都应该避免硬编码链接硬编码。</p><p>还记得我们刚开始编辑 <code>myapp/urls.py</code> 时提到的 <code>name</code> 吗？</p><pre><code class="lang-python">path('register/', views.register, name='register')</code></pre><p>现在是将它派上用场的好机会。我们使用 <code>reverse</code> 方法，填上注册页的 <code>name</code> 参数：</p><pre><code class="lang-python">from django.shortcuts import render, reverse, redirect
if len(users) == 1:
    return redirect(reverse('register'))</code></pre><p>接下来我们再进一步，我们希望跳转过去之后弹出一条提示。我们知道 GET 的参数就是在 URL 后面跟一个 <code>?</code>，然后是参数列表。不妨就利用 GET 请求通知注册页弹窗，我们这里就用一个参数 <code>code</code>，当然参数名可以自定。具体的弹窗实现我们稍后再提及：</p><pre><code class="lang-python">from django.shortcuts import render, reverse, redirect
if len(users) == 1:
    return redirect(reverse('register')+&quot;?code=-1&quot;)</code></pre><p>我们尝试实现另外的几个逻辑，首先是判断输入是否齐全，然后是判断学号是否为 11 位且开头为 <code>201</code>，然后是判断密码是否是 6-18 位且必须是英文字母或数字，最后判断两次输入的密码是否一致。这里需要使用到正则表达式。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-fb1863479dc5170c3e926f132ed6bb8d93" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-fb1863479dc5170c3e926f132ed6bb8d93" class="panel-body collapse">
</p><pre><code class="lang-python">import re

# 判断是否为空
if not userid or not passwd or not username or not repasswd:
    return redirect(reverse('register')+&quot;?code=-5&quot;)

# 判断学号格式
if not re.match(r'^(201).*\d{8}$', userid):
    return redirect(reverse('register')+&quot;?code=-4&quot;)

# 判断密码是否为 6-18 位且为字母或数字
if not re.match(r'^[A-Za-z0-9]{6,18}$', passwd):
    return redirect(reverse('register')+&quot;?code=-3&quot;)

# 判断两次密码是否一致
if passwd != repasswd:
    return redirect(reverse('register')+&quot;?code=-2&quot;)</code></pre><p>
</div>
</div></p><p>如果没啥问题，我们就可以写入数据库了，然后跳转到登录页。现在我们用到的是 <code>save</code> 函数。这里博主再次给出 <span class="external-link"><a href="https://www.runoob.com/django/django-model.html" target="_blank">菜鸟教程<i data-feather='external-link'></i></a></span> 的链接。</p><pre><code class="lang-python">STUDBdent = STUDB.objects.create(
    userid=userid, username=username, passwd=passwd)
STUDBdent.save()
return redirect(reverse('login')+&quot;?code=1&quot;)</code></pre><p>视图函数就写好了，我们再来检查一下我们刚才写的东西：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-c32c84a1455db01505dd1ae92647ae8746" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-c32c84a1455db01505dd1ae92647ae8746" class="panel-body collapse">
</p><pre><code class="lang-python">from django.shortcuts import render, reverse, redirect
from django.http import HttpResponse
import re
from .models import STUDB

def register_to_db(request):
    userid = request.POST.get('userid', None)
    username = request.POST.get('username', None)
    passwd = request.POST.get('passwd', None)
    repasswd = request.POST.get('repasswd', None)
    if not userid or not passwd or not username or not repasswd:
        return redirect(reverse('register')+&quot;?code=-5&quot;)
    if not re.match(r'^(201).*\d{8}$', userid):
        return redirect(reverse('register')+&quot;?code=-4&quot;)
    if not re.match(r'^[A-Za-z0-9]{6,18}$', passwd):
        return redirect(reverse('register')+&quot;?code=-3&quot;)
    if passwd != repasswd:
        return redirect(reverse('register')+&quot;?code=-2&quot;)
    users = STUDB.objects.filter(userid=userid)
    if len(users) == 1:
        return redirect(reverse('register')+&quot;?code=-1&quot;)
    STUDBdent = STUDB.objects.create(
        userid=userid, username=username, passwd=passwd)
    STUDBdent.save()
    return redirect(reverse('login')+&quot;?code=1&quot;)</code></pre><p>
</div>
</div></p><p>接下来别忘了把 <code>register_to_db</code> 页的映射关系写好：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-f9f34e4b169b0fd6f6fcbb51a1adf45d49" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-f9f34e4b169b0fd6f6fcbb51a1adf45d49" class="panel-body collapse">
</p><p>编辑 <code>myapp/urls.py</code>：</p><pre><code>urlpatterns = [
    path('', views.index, name='index'),
    path('register/', views.register, name='register'),
    path('login/', views.login, name='login'),
    path('play/', views.play, name='play'),
    path('win/', views.win, name='win'),
    path('register_to_db/', views.register_to_db, name='register_to_db'),
]</code></pre><p>
</div>
</div></p><p>接下来，我们回到前端的表单，我们把这个 <code>form</code> 标签给鸽了很久了。</p><pre><code class="lang-html">&lt;form method=&quot;post&quot; action=&quot;#&quot;&gt;&lt;/form&gt;</code></pre><p>首先是 <code>action</code> 属性。在后端，我们使用的是 <code>reverse</code> 方法，回忆一下？</p><pre><code class="lang-python">return redirect(reverse('login')+&quot;?code=1&quot;)</code></pre><p>在模板这里，我们可以使用 <code>{% url %}</code> 标签。我们曾经讲过 <code>{% static %}</code> 标签，回忆一下？</p><pre><code class="lang-html">{% load static %}
&lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;</code></pre><p>下面我们就来看看 <code>{% url %}</code> 最简单的用法，就是带上页面的 <code>name</code> 参数：</p><pre><code class="lang-html">&lt;form method=&quot;post&quot; action=&quot;{% url 'register_to_db' %}&quot;&gt;&lt;/form&gt;</code></pre><p>我们看看另一个例子，知道注册页底部有一个按钮是链接到登录页的：</p><pre><code class="lang-html">&lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;直接登录&quot; onclick=&quot;location.href='#'&quot;&gt;</code></pre><p>我们来实现一下它的跳转功能吧，使用 <code>{% url %}</code> 标签：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-b3b0290f7200d1d125444c66fc17f6ad33" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-b3b0290f7200d1d125444c66fc17f6ad33" class="panel-body collapse">
</p><pre><code class="lang-html">&lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;直接登录&quot; onclick=&quot;location.href='{% url 'login' %}'&quot;&gt;</code></pre><p>
</div>
</div></p><p>由于我们创建一个 POST 表单（它具有修改数据的作用），所以我们需要小心跨站点请求伪造。Django 自带了一个非常有用的防御系统。所有针对内部 URL 的 POST 表单都应该使用 <code>{% csrf_token %}</code> 模板标签，这里就没有什么用法了，在 <code>form</code> 标签内添加一行 <code>{% csrf_token %}</code> 即可。</p><p>我们来看看现在的 <code>myapp/templates/register.html</code> 是什么样子的：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-4e8622fba7b1b4b9718d49c0d0751a0015" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-4e8622fba7b1b4b9718d49c0d0751a0015" class="panel-body collapse">
</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Register&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{% static 'myapp/css/style.css' %}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;lg_content&quot;&gt;
        &lt;table cellspacing=&quot;30px&quot; align=&quot;center&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;{% url 'register_to_db' %}&quot;&gt;
                {% csrf_token %}
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;userid&quot; class=&quot;reg_ip&quot; placeholder=&quot;学号&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;username&quot; class=&quot;reg_ip&quot; placeholder=&quot;昵称&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;passwd&quot; class=&quot;reg_ip&quot; placeholder=&quot;密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;repasswd&quot; class=&quot;reg_ip&quot; placeholder=&quot;确认密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;

                &lt;tr&gt;
                    &lt;td align=&quot;left&quot;&gt;

                        &lt;input type=&quot;submit&quot; value=&quot;注册&quot; style=&quot;position:relative;left:40px;&quot; class=&quot;button&quot;&gt;

                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/form&gt;
            &lt;td align=&quot;center&quot; style=&quot;position:relative;left:-50px&quot;&gt;
                &lt;span class=&quot;font1&quot;&gt;已经注册？&lt;/span&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;直接登录&quot;
                    onclick=&quot;location.href='{% url 'login' %}'&quot;&gt;
            &lt;/td&gt;
        &lt;/table&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre><p>
</div>
</div></p><h3>消息框架</h3><p>现在我们来实现注册页的最后一部分内容，也就是弹窗提示。由于是根据 GET 请求中的 <code>code</code> 参数的值弹出响应的内容，我们在 Web 前端已经学过怎样用 Javascript 来做这件事了。但是 Django 提供了另外一个实现的思路，也就是消息框架。</p><p>具体实现分为两步，一步是添加消息，另一步是显示消息。</p><p>首先是添加信息，我们使用到的是 <code>add_message</code> 方法，例如我们要添加一条 Hello World 信息：</p><pre><code class="lang-python">from django.contrib import messages
messages.add_message(request, messages.INFO, 'Hello World')</code></pre><p>但是我们通常不按照上面的方式写，因为有另外的更简单的写法：</p><pre><code class="lang-python">from django.contrib import messages
messages.info(request, 'Hello World')</code></pre><p>在这里 <code>Hello World</code> 就是通知的内容了，<code>info</code> 指的是通知的级别。你可以将它换成 <code>success</code>、<code>warning</code>、<code>error</code>、<code>debug</code> 中的一种。至于通知级别的用途，简单来说就是用于添加 HTML 标签的类，<span class="external-link"><a href="https://docs.djangoproject.com/en/3.0/ref/contrib/messages/#using-messages-in-views-and-templates" target="_blank">官方文档<i data-feather='external-link'></i></a></span> 有相关的例子，当然我们这里还不需要到。</p><p>回到项目，我们看看怎样根据 <code>code</code> 参数添加响应的信息，编辑 <code>myapp/views.py</code>，我们开始修改我们的 <code>register</code> 视图函数。</p><p>首先是获取 <code>code</code> 参数，回忆一下我们是怎样获取用户的表单信息的，注意这里使用的是 GET 请求。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-541b7613c6f290d15bb02473f9f94dd038" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-541b7613c6f290d15bb02473f9f94dd038" class="panel-body collapse">
</p><pre><code class="lang-python">code = request.GET.get('code', None)</code></pre><p>
</div>
</div></p><p>接下来我们来添加信息，如果不记得 <code>code</code> 值对应的含义的话，可以回看一下 <code>register_to_db</code> 视图函数。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-1d01d2481c84d8e53e1dacbdab22915c20" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-1d01d2481c84d8e53e1dacbdab22915c20" class="panel-body collapse">
</p><pre><code class="lang-python">if code == '-5':
    messages.error(request, &quot;不要没填完就注册啊喂！&quot;)
elif code == '-4':
    messages.error(request, &quot;学 号 格 式 有 误&quot;)
elif code == '-3':
    messages.error(request, &quot;密码需要 6-18 位且必须是英文字母或数字&quot;)
elif code == '-2':
    messages.error(request, &quot;两次密码输入不一致的说&quot;)
elif code == '-1':
    messages.error(request, &quot;这个学号已被注册！请不要试图顶替别人(｡•ˇ‸ˇ•｡)&quot;)</code></pre><p>
</div>
</div></p><p>现在我们的 <code>register</code> 函数也被改得又臭又长了，看看你的函数现在是个什么样子？</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-ec9c569918bfebf57f14b91ffe6d8da780" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-ec9c569918bfebf57f14b91ffe6d8da780" class="panel-body collapse">
</p><p>别忘了导入 <code>messages</code>。</p><pre><code class="lang-python">from django.contrib import messages

def register(request):
    code = request.GET.get('code', None)
    if code == '-5':
        messages.error(request, &quot;不要没填完就注册啊喂！&quot;)
    elif code == '-4':
        messages.error(request, &quot;学 号 格 式 有 误&quot;)
    elif code == '-3':
        messages.error(request, &quot;密码需要 6-18 位且必须是英文字母或数字&quot;)
    elif code == '-2':
        messages.error(request, &quot;两次密码输入不一致的说&quot;)
    elif code == '-1':
        messages.error(request, &quot;这个学号已被注册！请不要试图顶替别人(｡•ˇ‸ˇ•｡)&quot;)
    return render(request, 'register.html')</code></pre><p>
</div>
</div></p><p>接下来是第二步，就是显示消息。</p><p>之前讲过 <code>{% url %}</code> 和 <code>{% static %}</code>，我们接下来要使用更多的 Django 标签，包括 <code>{% if %}</code>、<code>{% endif %}</code> 和 <code>{% for %}</code>、<code>{% endfor %}</code> 标签。我们可以很快地猜出它们的作用，前两个用于判断，后两个用于循环。</p><p>我们考虑我们现在要实现的逻辑，就是如果有消息 <code>messages</code>（不能改为别的名称），我们就遍历这些消息，对于每一个消息 <code>msg</code>（可以改为别的名称），我们执行 <code>alert()</code> 方法。</p><p>我们来看一下代码实现，编辑 <code>myapp/templates/register.html</code>。</p><pre><code class="lang-html">{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>其实是很套路化的，在其它需要到消息的场合代码几乎是一样的，无非是把 <code>script</code> 标签换掉，把 <code>alert</code> 方法换掉。</p><p>到这里注册页的实现已经全部完成啦！</p><h3>Admin 管理工具</h3><p>让我们来看看刚才写的这么多东西到底起作用了没有。简单来说，就是模拟一下注册流程，看看是不是真的有东西写进数据表里面。我们就需要一个可视化的数据库管理工具。MySQL 下有<del>死掉了的</del> PHPMyAdmin 和它的继任者 Adminer，那么 SQLite 呢？</p><p>没错我们终于解锁了讲解「URL 的映射」提到过的神秘的管理工具 <span class="external-link"><a href="http://127.0.0.1:8000/admin/" target="_blank">http://127.0.0.1:8000/admin/<i data-feather='external-link'></i></a></span>。然而直接访问这个页面需要账户密码。</p><p>我们就创建一个超级用户：</p><pre><code>$ python manage.py createsuperuser</code></pre><p>输入你希望设定的账户、邮箱和密码。然后用这个帐号登录这个管理工具。似乎并没有显示我们的模型 <code>STUDB</code>。我们把将这个模型添加进管理工具里面，编辑 <code>myapp/admin.py</code>：</p><pre><code class="lang-python">from myapp.models import STUDB
admin.site.register(STUDB),</code></pre><p>现在管理页面应该能看到我们的模型，但是当我们去尝试注册几个帐号后，在管理页点击我们的模型查看具体的数据的时候（应该是 <span class="external-link"><a href="http://127.0.0.1:8000/admin/myapp/studb/" target="_blank">http://127.0.0.1:8000/admin/myapp/studb/<i data-feather='external-link'></i></a></span> 这个页面），显示的是一个个的 <code>STUDB object</code>，我们希望它能显示学号。</p><p>事实上是有解决方法的，我们编辑 <code>myapp/models.py</code>，在我们的模型类 <code>STUDB</code> 末尾加入这两行：</p><pre><code class="lang-python">def __str__(self):
    return self.userid</code></pre><p>方法名如果是 <code>__xxxx__()</code> 的，那么就有特殊的功能，因此叫做「魔法」方法。当使用 <code>print</code> 输出对象的时候，只要自己定义了 <code>__str__(self)</code> 方法，那么就会打印从在这个方法中 <code>return</code> 的数据，我们通常让它返回一个对象的描述信息。</p><p>刷新页面，这时显示的就是学号了。你还可以尝试将 <code>self.userid</code> 换成其它内容。接下来，让我们愉快地开始注册吧（大雾）。</p><h2>登录页的实现</h2><p>可以说接下来我们要做的就是另一个注册页，几乎是一样的。由于基本的套路都在刚才涉及到了，在阅读前面的部分时候，你也已经做了一部分了，这一部分我们节奏会稍微加快一些。</p><h3>前端部分</h3><p>我们首先实现的依然是模板。在实现注册页时，我们在讲「模板」、「表单处理」和「消息框架」时都涉及到了模板的编辑。博主认为你读到这里的时候应该把前面讲的忘的差不多了，所以给出几个提示：</p><ul><li>模板就是 <code>myapp/templates/</code> 里的那些 HTML 文件。</li><li>样式在制作注册页的时候就已经写好了，所以在这里你只需要引用它就好了。</li><li>尽量使用 <code>{% url %}</code> 标签替代实际的链接，减少硬编码。</li><li>POST 表单都应该使用 <code>{% csrf_token %}</code> 模板标签。</li><li>别忘了如果有信息 <code>messages</code> 要 <code>alert</code> 弹窗显示。</li></ul><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-aa78e404ca56763372a2091507a434560" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-aa78e404ca56763372a2091507a434560" class="panel-body collapse">
</p><p>新建并编辑 <code>myapp/templates/login.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Login&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;lg_content&quot;&gt;
        &lt;table cellspacing=&quot;30px&quot; style=&quot;width: 250px&quot; align=&quot;center&quot;&gt;
            &lt;tr&gt;
                &lt;td colspan=&quot;2&quot; align=&quot;left&quot;&gt;
                    &lt;span class=&quot;font2&quot; style=&quot;font-size:30px;&quot;&gt;WELCOME TO 1024&lt;/span&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;form action=&quot;{% url 'check_user' %}&quot; method=&quot;post&quot;&gt;
                {% csrf_token %}
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;text&quot; name=&quot;id&quot; class=&quot;lg_ip&quot; placeholder=&quot;学号&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot;&gt;
                        &lt;input type=&quot;password&quot; name=&quot;passwd&quot; class=&quot;lg_ip&quot; placeholder=&quot;密码&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td align=&quot;right&quot;&gt;
                        &lt;input type=&quot;submit&quot; value=&quot;提交&quot; class=&quot;button&quot; style=&quot;position:relative;left:-50px&quot;&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/form&gt;
            &lt;tr&gt;
                &lt;td align=&quot;left&quot;&gt;
                    &lt;span class=&quot;font1&quot;&gt;没有账号？&lt;/span&gt;
                    &lt;input type=&quot;submit&quot; class=&quot;button&quot; style=&quot;height:25px;width:80px;font-size:12px&quot; value=&quot;注册&quot;
                        onclick=&quot;location.href='{% url 'register' %}'&quot;&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;

    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;

{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>
</div>
</div></p><h3>后端部分</h3><p>接下来，我们要实现两个视图函数，一个是 <code>login</code>（用于渲染模板）一个是 <code>check_user</code>（用于处理表单）。</p><p>值得留意的地方有三处，首先在注册页我们查询账户是否已经注册是这样实现的：</p><pre><code class="lang-python">users = STUDB.objects.filter(userid=userid)
if len(users) == 1:
    return redirect(reverse('register')+&quot;?code=-1&quot;)</code></pre><p>想想看「验证用户填写的账户密码是否正确」是否能用类似的方式实现呢？</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-f2746c3f202f37a5cc3bcd270bb950ea19" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-f2746c3f202f37a5cc3bcd270bb950ea19" class="panel-body collapse">
</p><pre><code class="lang-python">users = STUDB.objects.filter(userid=id, passwd=passwd)
if len(users) == 1:
    return redirect(reverse('play')+&quot;?code=1&quot;)
else:
    return redirect(reverse('login')+&quot;?code=-1&quot;)</code></pre><p>
</div>
</div></p><p>第二，我们希望在跳转到闯关页之后，后端可以知道用户是否已经登录。具体的实现需要的是「会话控制」，而 Session 对象转为存储特定用户会话所需的属性及配置信息而生。我们看看相应的代码实现，想想这两行语句应该放置在什么位置：</p><pre><code class="lang-python">request.session['userid'] = id
request.session['is_login'] = '1'</code></pre><p>最后，别忘了在注册成功后，需要我们在<strong>登录页</strong>弹窗提示注册成功。这一部分是在视图函数 <code>register_to_db</code> 实现的，可以回看一下。同样地，考虑一下是否其它页面可能会跳转到登录页的且需要弹窗？</p><p>接下来，我们尝试实现这两个视图函数吧！</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-009c27585653c3ff64859478dfbd2f8456" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-009c27585653c3ff64859478dfbd2f8456" class="panel-body collapse">
</p><p>编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">def login(request):
    code = request.GET.get('code', None)
    if code == '-3':
        messages.error(request, &quot;请 先 登 录&quot;)
    if code == '-2':
        messages.error(request, &quot;不要没填完就登录啊喂！&quot;)
    if code == '-1':
        messages.error(request, &quot;啊哦~登录失败了←_←&quot;)
    if code == '1':
        messages.success(request, &quot;注 册 成 功&quot;)
    return render(request, 'login.html')

def check_user(request):
    id = request.POST.get('id', None)
    passwd = request.POST.get('passwd', None)
    if not id or not passwd:
        return redirect(reverse('login')+&quot;?code=-2&quot;)
    users = STUDB.objects.filter(userid=id, passwd=passwd)
    if len(users) == 1:
        request.session['userid'] = id
        request.session['is_login'] = '1'
        return redirect(reverse('play')+&quot;?code=1&quot;)
    else:
        return redirect(reverse('login')+&quot;?code=-1&quot;)</code></pre><p>
</div>
</div></p><p>接下来别忘了把 <code>check_user</code> 页的映射关系写好：</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-fed053919a375e364ed61a9cd9e98d8289" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-fed053919a375e364ed61a9cd9e98d8289" class="panel-body collapse">
</p><p>编辑 <code>myapp/urls.py</code>：</p><pre><code class="lang-python">urlpatterns = [
    path('', views.index, name='index'),
    path('register/', views.register, name='register'),
    path('login/', views.login, name='login'),
    path('play/', views.play, name='play'),
    path('win/', views.win, name='win'),
    path('register_to_db/', views.register_to_db, name='register_to_db'),
    path('check_user/', views.check_user, name='check_user'),
]</code></pre><p>
</div>
</div></p><h2>闯关页的实现</h2><p>去年有七个关卡，不知道你还记不记得它们分别是什么。但是 <span class="external-link"><a href="https://bobby285271.github.io/SoCoding2019-1024/" target="_blank">题解依然是挂着的<i data-feather='external-link'></i></a></span>，应该能唤起你的一些回忆。</p><p>由于关卡具体的 idea 和实现应该是甩锅甩给新一届师弟师妹做的，而从站点制作的角度来说，每个关卡实现起来其实差不多。正如开头所说，我们这里只完成其中的三个关卡，分别是去年第三、六、七关，当然在这里我们就重新将他们编排为第一、二、三关。</p><h3>前端部分</h3><p>博主认为闯关页部分就做一个页面好了，不然还要做防跳关处理。这意味着每个关卡要做一个模板，在用户访问闯关页的时候就渲染用户当前所在的关卡对应的模板。</p><p>我们从第一关开始（去年是第三关），是过气游戏 Flappy Bird，挂上个十次或者直接来个 F12 就通关了。这里我并不会讲解这个游戏怎样用 Web 前端学到的知识实现出来，而是会告诉你网上一大堆现成的 Javascript 实现可以随便抄。</p><p>但是我们要记得死亡十次通关还是要自己实现的，其实很简单就在重置游戏的地方调用你的计数器函数即可。</p><p>我们开始实现这个小游戏吧！既然需要到 Javascript，还记得 Javascript 这种静态文件要放在什么地方吗？</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-7e609851c82535fe589303ef8b945a7575" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-7e609851c82535fe589303ef8b945a7575" class="panel-body collapse">
</p><p>新建并编辑 <code>myapp/static/myapp/js/flappybird.js</code>，留意两个注释出现的位置，那就是你添加你的计时器的位置：</p><pre><code class="lang-js">var game = new Phaser.Game(400, 450, Phaser.AUTO, 'game_div');
var game_state = {};
var i = 1;

// 死亡十次通关
function timer(x) {
    i = i + x;
    if (i == 10) {
        alert(&quot;有时候失败就是成功！我看到你的努力了！继续前进吧！flag：2048&quot;);
    }
    if (i == 30) {
        alert(&quot;想再看一次 flag？flag：2048&quot;);
    }
    if (i == 50)
        alert(&quot;你玩很久了，继续闯关吧！&quot;);
}

game_state.main = function () { };
game_state.main.prototype = {
    preload: function () {
        this.game.stage.backgroundColor = '#F0FFFF';
        this.game.load.image('bird', '../static/myapp/img/bird.png');
        this.game.load.image('pipe', '../static/myapp/img/pipe.png');
    },
    create: function () {
        this.bird = this.game.add.sprite(100, 245, 'bird');
        this.bird.body.gravity.y = 1000;
        var space_key = this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
        space_key.onDown.add(this.jump, this);
        this.pipes = game.add.group();
        this.pipes.createMultiple(20, 'pipe');
        this.timer = this.game.time.events.loop(1500, this.add_row_of_pipes, this);
        this.score = 0;
        var style = { font: &quot;30px Arial&quot;, fill: &quot;#ffffff&quot; };
        this.label_score = this.game.add.text(20, 20, &quot;0&quot;, style);
    },
    update: function () {
        if (this.bird.inWorld == false)
            this.restart_game();
        this.game.physics.overlap(this.bird, this.pipes, this.restart_game, null, this);
    },

    jump: function () {
        this.bird.body.velocity.y = -350;
    },

    // 重置游戏
    restart_game: function () {
        if (this.score &gt;= 1) timer(1);
        this.game.time.events.remove(this.timer);
        this.game.state.start('main');
    },

    add_one_pipe: function (x, y) {
        var pipe = this.pipes.getFirstDead();
        pipe.reset(x, y);
        pipe.body.velocity.x = -200;
        pipe.outOfBoundsKill = true;
    },

    add_row_of_pipes: function () {
        var hole = Math.floor(Math.random() * 5) + 1;
        for (var i = 0; i &lt; 8; i++)
            if (i != hole &amp;&amp; i != hole + 1)
                this.add_one_pipe(400, i * 60 + 10);
        this.score += 1;
        this.label_score.content = this.score;
    },
};

game.state.add('main', game_state.main);
game.state.start('main'); </code></pre><p>不需要理解上面代码的实现，但是通过简单的阅读，我们知道我们还需要一张鸟的图片和一张管道的图片：</p><pre><code class="lang-js">this.game.load.image('bird', '../static/myapp/img/bird.png');
this.game.load.image('pipe', '../static/myapp/img/pipe.png');</code></pre><p>去年实际的代码实际上并没有这两张图片，我们补上。在 <code>myapp/static/myapp/img</code> 目录里放置好对应的图片。</p><p>这里我们使用到了硬编码链接，这确实是不被提倡的。但是 Django 标签只能在 <code>myapp/templates/</code> 中起作用，而 Javascript 中的相对路径的编写是要以 HTML 文件所在位置作为基准的。</p><p>当然你可以参考消息框架的实现，选择将部分 Javascript 代码迁移到模板中，使用 <code>&lt;script&gt;&lt;/script&gt;</code> 标签括起来，然后使用 <code>{% static %}</code> 标签替换掉硬编码链接，有兴趣的可自行尝试。</p><p>同样通过简单的阅读，我们知道我们还需要一个 Phaser（一个 HTML 5 游戏开发框架）的 Javascript 文件，从网上下载即可，放置在 <code>myapp/static/myapp/js/phaser.min.js</code>。</p><p>
</div>
</div></p><p>接下来我们在模板引用前面的 Javascript 文件，在写模板的时候别忘记了答案提交表单和消息框架（用来提示答案错误的）。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-128a5f00102ead160b8cac1e10714add95" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-128a5f00102ead160b8cac1e10714add95" class="panel-body collapse">
</p><p>新建并编辑 <code>myapp/templates/level1.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Level 1&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;containerDiv&quot;&gt;
        &lt;div class=&quot;titleDiv&quot;&gt;
            &lt;div id=&quot;game_div&quot;&gt;
                &lt;span style=&quot;font-family:Microsoft YaHei;color: azure;&quot;&gt;
                    空格键跳跃
                &lt;/span&gt;
            &lt;/div&gt;
            
            &lt;script type=&quot;text/javascript&quot; src=&quot;{% static 'myapp/js/phaser.min.js'%}&quot;&gt;&lt;/script&gt;
     
            &lt;script type=&quot;text/javascript&quot; src=&quot;{% static 'myapp/js/flappybird.js'%}&quot;&gt;&lt;/script&gt;
        &lt;/div&gt;

        &lt;div class=&quot;problemDiv&quot;&gt;
            &lt;div style=&quot;text-align:left;clear:both&quot;&gt;
                &lt;span class=&quot;font2&quot;&gt;
                    手残党的福音&lt;br&gt;
                    怎样通过这一片障碍呢
                &lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;answerDiv&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;{% url 'compare_flag' %}&quot;&gt;
                {% csrf_token %}
                &lt;input type=&quot;text&quot; class=&quot;input&quot; name=&quot;flag&quot;&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;提交&quot;&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>
</div>
</div></p><p>接下来是第二关（去年是第六关）这一关的实现比上一关简单一些，把上一关的 Flappy Bird 换成一张图片就行了，当然图片里面是隐藏了通关信息的。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-0637165bb2f8f574d1b0431510e104c776" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-0637165bb2f8f574d1b0431510e104c776" class="panel-body collapse">
</p><p>我们把 <code>huaji.png</code> 放置到 <code>myapp/static/myapp/img/</code> 目录里面，这就是题目提供的图片了。接下来我们写模板，新建并编辑 <code>myapp/templates/level2.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Level 2&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;containerDiv&quot;&gt;
        &lt;div class=&quot;titleDiv&quot;&gt;
            &lt;span class=&quot;font1&quot;&gt;Level 2&lt;/span&gt;
        &lt;/div&gt;

        &lt;div class=&quot;problemDiv&quot;&gt;
            &lt;span class=&quot;font2&quot;&gt;
                {% load static %}
                &lt;img src=&quot;{%static 'myapp/img/huaji.png'%}&quot; /&gt;
                &lt;!-- 可以打开这个神奇的网站看看哦~ --&gt;
                &lt;!-- http://www.atool9.com/steganography.php --&gt;
            &lt;/span&gt;
        &lt;/div&gt;
        &lt;div class=&quot;answerDiv&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;{% url 'compare_flag' %}&quot;&gt;
                {% csrf_token %}
                &lt;input type=&quot;text&quot; class=&quot;input&quot; name=&quot;flag&quot;&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;提交&quot;&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>
</div>
</div></p><p>最后是第三关（去年是第七关），也不知道去年给大家安利 GitHub 大家用上了没有。这回连图片都不需要了，直接开始写模板。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-5f4622d3df1e24934b563e38456f18f998" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-5f4622d3df1e24934b563e38456f18f998" class="panel-body collapse">
</p><p>新建并编辑 <code>myapp/templates/level3.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Level 3&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css'%}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;containerDiv&quot;&gt;
        &lt;div class=&quot;titleDiv&quot;&gt;
            &lt;span class=&quot;font1&quot;&gt;Level 3&lt;/span&gt;
        &lt;/div&gt;

        &lt;div class=&quot;problemDiv&quot;&gt;
            &lt;span class=&quot;font2&quot;&gt;
                https://github.com/bobby285271/SoCoding2019-1024&lt;br&gt;&lt;br&gt;
                &lt;div style=&quot;font-size:18px&quot;&gt;去里面看看吧 //滑稽&lt;/div&gt;
            &lt;/span&gt;
        &lt;/div&gt;
        &lt;div class=&quot;answerDiv&quot;&gt;
            &lt;form method=&quot;post&quot; action=&quot;{% url 'compare_flag' %}&quot;&gt;
                {% csrf_token %}
                &lt;input type=&quot;text&quot; class=&quot;input&quot; name=&quot;flag&quot;&gt;
                &lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;提交&quot;&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
{% if messages %}
&lt;script&gt;
    {% for msg in messages %}
    alert('{{msg.message}}')
    {% endfor %}
&lt;/script&gt;
{% endif %}</code></pre><p>
</div>
</div></p><h3>后端部分</h3><p>同样地，我们要实现两个视图函数，一个是 <code>play</code>（用于渲染模板）一个是 <code>compare_flag</code>（用于处理表单）。要注意的是虽然我们只做了三关，但是他们在这里实际上都是不同的角色，第一关是普通关卡前序关卡，第二关是普通关卡最后一关，第三关是地狱关。</p><ul><li>对于普通关前序关卡，我们只需要更新用户进度即可。</li><li>对于普通关最后一关，除了更新用户进度，我们需要第一次记录用户通关时间。</li><li>对于地狱关，我们要允许用户输入彩蛋 Flag 之后记录用户彩蛋通关时间，同时还要在用户输入正确 Flag 之后记录用户完整通关时间（用于兑奖），无论先输入哪个都要允许用户继续游玩该关卡以输入另一个 Flag，同时输入正确 Flag 后要显示通关页。</li></ul><p>这里有几个要注意的地方：</p><p>首先，实现 <code>play</code> 视图函数的时候，要判断用户是否登录。</p><pre><code class="lang-python">if request.session.get('is_login') == '1':
    # do something
else:
    # do something</code></pre><p>其次，普通关前序关卡处理的逻辑都是一样的。考虑在关卡数增多的情况如何简化代码。</p><p>最后，由于地狱关要始终开放，以供用户输入正确 Flag 和彩蛋 Flag。考虑用户连输多次正确 Flag 的情况，应该如何更新用户进度？</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-8cc70836ea19cb546ff2f66ba4f8346117" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-8cc70836ea19cb546ff2f66ba4f8346117" class="panel-body collapse">
</p><p>编辑 <code>myapp/views.py</code>：</p><pre><code class="lang-python">def play(request):
    if request.session.get('is_login') == '1':
        code = request.GET.get('code', None)
        userid = request.session['userid']
        user = STUDB.objects.filter(userid=userid).last()
        if user.rank &lt; 3 and code == '-1':
            messages.error(request, &quot;哎呀，错了orz&quot;)
        if user.rank &gt; 2 and code == '-1':
            messages.error(request, &quot;终局之战总是很坎坷的，请再找找flag是什么吧_(:з」∠)_&quot;)
        if user.rank &gt; 2 and code == '1':
            messages.success(request, '哦吼！恭喜你发现了不得了的β时间线，这一切都是命运石之门的选择~！')
        if user.rank &gt; 3:
            url = 'level3.html'
        else:
            url = 'level' + str(user.rank) + '.html'
        return render(request, url)
    else:
        return redirect(reverse('login')+&quot;?code=-3&quot;)


def compare_flag(request):
    correct_flag = [
        '',
        '2018',
    ]
    flag = request.POST.get('flag', None)
    userid = request.session['userid']
    user = STUDB.objects.filter(userid=userid).last()
    if user.rank &lt; 2:
        if correct_flag[user.rank] == flag:
            user.rank += 1
            user.save()
            return redirect(reverse('play'))
        else:
            return redirect(reverse('play')+&quot;?code=-1&quot;)
    elif user.rank == 2:
        if flag == 'sdltql':
            user.lastflag = timezone.now()
            user.timesubtract = (
                user.lastflag - user.firstflag).total_seconds()
            user.rank += 1
            user.save()
            return redirect(reverse('play'))
        else:
            return redirect(reverse('play')+&quot;?code=-1&quot;)
    elif user.rank &gt; 2:
        if flag == 'happy':
            user.superflag = timezone.now()
            user.timesubtract_last = (
                user.superflag-user.firstflag).total_seconds()
            user.rank = 4
            user.save()
            return redirect(reverse('win'))
        elif flag == '666':
            user.specialflag = timezone.now()
            user.timesubtract_suprise = (
                user.firstflag - user.specialflag).total_seconds()
            user.save()
            return redirect(reverse('play')+&quot;?code=1&quot;)
        else:
            return redirect(reverse('play')+&quot;?code=-1&quot;)
    return redirect(reverse('play'))</code></pre><p>
</div>
</div></p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-4411c11c29cbb31f0c423702271c0d1f77" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-4411c11c29cbb31f0c423702271c0d1f77" class="panel-body collapse">
</p><p>我赌五毛你会忘记写 <code>compare_flag</code> 的 URL 映射。</p><p>编辑 <code>myapp/urls.py</code>：</p><pre><code class="lang-python">urlpatterns = [
    path('', views.index, name='index'),
    path('register/', views.register, name='register'),
    path('login/', views.login, name='login'),
    path('play/', views.play, name='play'),
    path('win/', views.win, name='win'),
    path('register_to_db/', views.register_to_db, name='register_to_db'),
    path('check_user/', views.check_user, name='check_user'),
    path('compare_flag/', views.compare_flag, name='compare_flag'),
]</code></pre><p>
</div>
</div></p><h2>通关页的实现</h2><p><del>此部分留作习题供读者思考</del>。</p><p><div class="panel panel-default collapse-panel box-shadow-wrap-lg">
<div class="panel-heading panel-collapse" data-toggle="collapse" data-target="#collapse-4b076d76c49bb671da045844c0ec12b354" aria-expanded="true">
<div class="accordion-toggle"><span>点击这里查看具体实现</span>
<i class="pull-right fontello icon-fw fontello-angle-right"></i>
</div>
</div>
<div id="collapse-4b076d76c49bb671da045844c0ec12b354" class="panel-body collapse">
</p><p>模板，编辑 <code>myapp/templates/win.html</code>：</p><pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Win!&lt;/title&gt;
    {% load static %}
    &lt;link href=&quot;{%static 'myapp/css/style.css' %}&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div class=&quot;containerDiv&quot;&gt;
        &lt;div class=&quot;titleDiv&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;problemDiv&quot;&gt;
            &lt;span class=&quot;font1&quot; style=&quot;font-size:40px&quot;&gt;
                &lt;p&gt;恭喜你通过所有关卡！&lt;/p&gt;
                &lt;p&gt;1024 程序猿节快乐！&lt;/p&gt;
                &lt;img src=&quot;{%static 'myapp/img/end.jpg' %}&quot; style=&quot;height:250px&quot; /&gt;
                &lt;p&gt;完结撒花！哔哩哔哩-(゜-゜)つロ乾杯~&lt;/p&gt;
            &lt;/span&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre><p>模板中使用了一张图片，放 <code>myapp/static/myapp/img</code> 目录，命名为 <code>end.jpg</code>。</p><p>视图函数，编辑 <code>myapp/templates/win.html</code>：</p><pre><code class="lang-python">def win(request):
    if request.session.get('is_login') == '1':
        userid = request.session['userid']
        user = STUDB.objects.filter(userid=userid).last()
        if user.rank == 4:
            return render(request, 'win.html')
        else:
            return redirect(reverse('play'))
    else:
        return redirect(reverse('login')+&quot;?code=-3&quot;)</code></pre><p>
</div>
</div></p><h2>效果预览</h2><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" data-original="https://bobby285271.coding.net/p/img/d/img/git/raw/master/2019_1024.png" alt="" title="" /></p><p>代码已经上传到 <span class="external-link"><a href="https://github.com/bobby285271/1024-demo" target="_blank">GitHub<i data-feather='external-link'></i></a></span>。</p>
</div>
</div>
<script data-cfasync="false" src="../../../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="6b677945121e6806c012d3d9-text/javascript">
        try {
            $("[data-morphing]").fancyMorph({
                hash : 'morphing'
            });
        }catch (e){

        }

            </script>

<script type="6b677945121e6806c012d3d9-text/javascript">
(function () {
    window.TypechoComment = {
        dom : function (id) {
            return document.getElementById(id);
        },
    
        create : function (tag, attr) {
            var el = document.createElement(tag);
        
            for (var key in attr) {
                el.setAttribute(key, attr[key]);
            }
        
            return el;
        },

        reply : function (cid, coid) {
            var comment = this.dom(cid), parent = comment.parentNode,
                response = this.dom('respond-post-142'), input = this.dom('comment-parent'),
                form = 'form' == response.tagName ? response : response.getElementsByTagName('form')[0],
                textarea = response.getElementsByTagName('textarea')[0];

            if (null == input) {
                input = this.create('input', {
                    'type' : 'hidden',
                    'name' : 'parent',
                    'id'   : 'comment-parent'
                });

                form.appendChild(input);
            }

            input.setAttribute('value', coid);

            if (null == this.dom('comment-form-place-holder')) {
                var holder = this.create('div', {
                    'id' : 'comment-form-place-holder'
                });

                response.parentNode.insertBefore(holder, response);
            }

            comment.appendChild(response);
            this.dom('cancel-comment-reply-link').style.display = '';

            if (null != textarea && 'text' == textarea.name) {
                textarea.focus();
            }

            return false;
        },

        cancelReply : function () {
            var response = this.dom('respond-post-142'),
            holder = this.dom('comment-form-place-holder'), input = this.dom('comment-parent');

            if (null != input) {
                input.parentNode.removeChild(input);
            }

            if (null == holder) {
                return true;
            }

            this.dom('cancel-comment-reply-link').style.display = 'none';
            holder.parentNode.insertBefore(response, holder);
            return false;
        }
    };
})();
</script>
<script type="6b677945121e6806c012d3d9-text/javascript">
var registCommentEvent = function() {
    var event = document.addEventListener ? {
        add: 'addEventListener',
        focus: 'focus',
        load: 'DOMContentLoaded'
    } : {
        add: 'attachEvent',
        focus: 'onfocus',
        load: 'onload'
    };
    var r = document.getElementById('respond-post-142');
        
    if (null != r) {
        var forms = r.getElementsByTagName('form');
        if (forms.length > 0) {
            var f = forms[0], textarea = f.getElementsByTagName('textarea')[0], added = false;

            if (null != textarea && 'text' == textarea.name) {
                textarea[event.add](event.focus, function () {
                    if (!added) {
                        var input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = '_';
                            input.value = (function () {
    var _3OZa = 'e'//'1x'
+'f94'//'yXc'
+//'Hq'
'96'+//'DTg'
'f4'+'e6'//'4M'
+''///*'64M'*/'64M'
+'9f'//'w'
+'185'//'VIV'
+'9'//'0RO'
+'e'//'w'
+'b'//'c'
+//'N'
'0'+'Dk'//'Dk'
+''///*'B'*/'B'
+'4'//'MX1'
+'25a'//'b'
+'f1'//'V24'
+'07a'//'v'
+//'We'
'4'+'ec'//'zE0'
+//'1D9'
'3', _OwdJi = [[19,21]];
    
    for (var i = 0; i < _OwdJi.length; i ++) {
        _3OZa = _3OZa.substring(0, _OwdJi[i][0]) + _3OZa.substring(_OwdJi[i][1]);
    }

    return _3OZa;
})();
                    
                        f.appendChild(input);
                        
                        input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = 'checkReferer';
                        input.value = 'false';
                        
                        f.appendChild(input);
                        

                        added = true;
                    }
                });
            }
        }
    }
};
</script></div>
<footer id="footer" class="app-footer" role="footer">
<div class="wrapper bg-light">
<span class="pull-right hidden-xs text-ellipsis">
Powered by <a target="_blank" href="http://www.typecho.org">Typecho</a>&nbsp;|&nbsp;Theme by <a target="_blank" href="https://www.ihewro.com/archives/489/">handsome</a>
</span>
<span class="text-ellipsis">&copy;&nbsp;2020 Copyright&nbsp;</span>
</div>

<style>
          .topButton>.btn{
              top: 0;
          }
          </style>
<div class="topButton panel panel-default">
<button id="goToTop" class="btn btn-default no-shadow pos-abt hide  border-radius-half-left" data-toggle="tooltip" data-placement="left" data-original-title="返回顶部">
<i class="fontello fontello-chevron-circle-up" aria-hidden="true"></i>
</button>
</div>
</footer>
</div>
<script type="6b677945121e6806c012d3d9-text/javascript">
SearchConfig = {
    url : "https://static.bobby285271.top/usr/plugins/Handsome/cache/search.json"
}
</script>

<script type="6b677945121e6806c012d3d9-text/javascript">
        window['LocalConst'] = {
            COMMENT_NAME_INFO: '必须填写昵称或姓名',
            COMMENT_EMAIL_INFO: '必须填写电子邮箱地址',
            COMMENT_EMAIL_LEGAL_INFO: '邮箱地址不合法',
            COMMENT_CONTENT_INFO: '必须填写评论内容',
            COMMENT_SUBMIT_ERROR: '提交失败，请重试！',
            COMMENT_CONTENT_LEGAL_INFO: '提交失败,评论被拦截，可能发言太快或内容不符合规则',

            LOGIN_USERNAME_INFO: '必须填写用户名',
            LOGIN_PASSWORD_INFO: '请填写密码',
            LOGIN_SUBMIT_ERROR: '登录失败，请重新登录',
            LOGIN_SUBMIT_INFO: '用户名或者密码错误，请重试',
            LOGIN_SUBMIT_SUCCESS: '登录成功',
            CLICK_TO_REFRESH: '点击以刷新页面',
            LOGOUT_SUCCESS_REFRESH: '退出成功，正在刷新当前页面',

            LOGOUT_ERROR: '退出失败，请重试',
            LOGOUT_SUCCESS: '退出成功',

            SUBMIT_PASSWORD_INFO: '密码错误，请重试',
            COMMENT_TITLE: '评论通知',
            LOGIN_TITLE: '登录通知',
            ChANGYAN_APP_KEY: '',
            CHANGYAN_CONF: '',

            COMMENT_SYSTEM: '0',
            COMMENT_SYSTEM_ROOT: '0',
            COMMENT_SYSTEM_CHANGYAN: '1',
            COMMENT_SYSTEM_OTHERS: '2',
            EMOJI: '表情',
            IS_PJAX: '1',
            IS_PAJX_COMMENT: '1',
            BASE_SCRIPT_URL: 'https://static.bobby285271.top/usr/themes/handsome/',
            BLOG_URL: 'https://static.bobby285271.top/',
            BLOG_URL_PHP: 'https://static.bobby285271.top/index.php/',
            THEME_COLOR: '14',
            THEME_COLOR_EDIT: 'white-white-white',
            THEME_HEADER_FIX: '1',
            THEME_ASIDE_FIX: '1',
            THEME_ASIDE_FOLDED: '',
            THEME_ASIDE_DOCK: '',
            THEME_CONTAINER_BOX: '1',
            THEME_HIGHLIGHT_CODE: '1',
            THEME_TOC: '1',
            TOC_TITLE: '文章目录',
            HEADER_FIX: '固定头部',
            ASIDE_FIX: '固定导航',
            ASIDE_FOLDED: '折叠导航',
            ASIDE_DOCK: '置顶导航',
            CONTAINER_BOX: '盒子模型',
            OFF_SCROLL_HEIGHT: '50',
            COMMENT_REJECT_PLACEHOLDER: '居然什么也不说，哼',
            COMMENT_PLACEHOLDER: '说点什么吧……',
            SHOW_SETTING_BUTTON: '',
            THEME_VERSION: '6.0.020191205',

            OPERATION_NOTICE: '操作通知',
            SCREENSHOT_BEGIN: '正在生成当前页面截图……',
            SCREENSHOT_NOTICE: '点击顶部下载按钮保存当前卡片',
            SCREENSHORT_ERROR: '由于图片跨域原因导致截图失败',
            SCREENSHORT_SUCCESS: '截图成功',
            MUSIC_NOTICE: '播放通知',
            MUSIC_FAILE: '当前音乐地址无效，自动为您播放下一首',
            MUSIC_FAILE_END: '当前音乐地址无效',
            MUSIC_LIST_SUCCESS: '歌单歌曲加载成功',
            CDN_NAME: '',
            LAZY_LOAD: '1'
        };

    </script>

<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js" type="6b677945121e6806c012d3d9-text/javascript"></script>
<script src="../../../../usr/themes/handsome/assets/js/features/jquery.pjax.min.js" type="6b677945121e6806c012d3d9-text/javascript"></script>
<script type="6b677945121e6806c012d3d9-text/javascript">
        $(document).pjax('a[href^="https://static.bobby285271.top/"]:not(a[target="_blank"], a[no-pjax])', {
            container: '#content',
            fragment: '#content',
            timeout: 8000
        }).on('pjax:send',function () {
                        $('#loading').removeClass('hide');
                    }).on('pjax:click', function() {

            window['Page'].doPJAXClickAction();
            
                        $('body,html').animate({scrollTop:0},100);
            

        }).on('pjax:complete', function() {
            window['Page'].doPJAXCompleteAction();
            if ($(".post-position").length > 0){
                window['Page'].doPJAXCompletePostAction();
            }
                                            $("#post-content img").lazyload({
                    effect: "fadeIn",
                    threshold: "200"
                });
                $(".lazy").lazyload({
                    effect: "fadeIn",
                    threshold: "200"
                });
                                                    $('#loading').addClass('hide');
            
                                    MathJax.Hub.Queue(["Typeset",MathJax.Hub,"body"]);
            

        })
    </script>


<script src="../../../../usr/themes/handsome/assets/js/features/lazyload.min.js" type="6b677945121e6806c012d3d9-text/javascript"></script>
<script type="6b677945121e6806c012d3d9-text/javascript">
        $("img").lazyload({
            effect: "fadeIn",
            threshold: "200"
        });

        $(".lazy").lazyload({
            effect: "fadeIn",
            threshold: "200"
        });

        //后退的时候
        if (window.history && window.history.pushState) {
            $(window).on('popstate', function () {
                /// 当点击浏览器的 后退和前进按钮 时才会被触发，
                window.history.pushState('forward', null, '');
                window.history.forward(1);//当前页 ,
                $("img").lazyload({
                    effect: "fadeIn",
                    threshold: "200"
                });

                $(".lazy").lazyload({
                    effect: "fadeIn",
                    threshold: "200"
                });
            });
        }
        //在ie中必须有这两行
        window.history.pushState('forward', null, '');
        window.history.forward(1);
    </script>
<script src="../../../../usr/themes/handsome/assets/js/features/feather.min.js%3Fv=6.0.020191205" type="6b677945121e6806c012d3d9-text/javascript"></script>

<script src="https://cdn.staticfile.org/mathjax/2.7.0/MathJax.js" type="6b677945121e6806c012d3d9-text/javascript"></script>
<script src="https://cdn.staticfile.org/mathjax/2.7.0/config/TeX-AMS-MML_SVG.js" type="6b677945121e6806c012d3d9-text/javascript"></script>

<script src="../../../../usr/themes/handsome/assets/js/features/jquery.fancybox.min.js%3Fv=6.0.020191205" type="6b677945121e6806c012d3d9-text/javascript"></script>
<script src="../../../../usr/themes/handsome/assets/js/features/easypiechart.min.js%3Fv=6.0.020191205" type="6b677945121e6806c012d3d9-text/javascript"></script>

<script src="../../../../usr/themes/handsome/assets/js/features/OwO.min.js%3Fv=6.0.020191205" type="6b677945121e6806c012d3d9-text/javascript"></script>



<script src="../../../../usr/themes/handsome/assets/js/function.min.js%3Fv=6.0.020191205" type="6b677945121e6806c012d3d9-text/javascript"></script>
<script src="../../../../usr/themes/handsome/assets/js/core.min.js%3Fv=6.0.020191205" type="6b677945121e6806c012d3d9-text/javascript"></script>

<script src="../../../../usr/themes/handsome/assets/js/features/music.min.js%3Fv=6.0.020191205" type="6b677945121e6806c012d3d9-text/javascript"></script>
<script type="6b677945121e6806c012d3d9-text/javascript">
                var player = new skPlayer({"autoplay":false,"listshow":false,"mode":"listloop","music":{"type":"file","source":[{"name":"\u6b69\u3044\u3066\u3082\u6b69\u3044\u3066\u3082\u3001\u591c\u7a7a\u306f\u50d5\u3092\u8ffd\u3044\u304b\u3051\u3066\u304f\u308b","author":"\u9396\u90a3","src":"https:\/\/bobby285271.coding.net\/p\/img\/d\/img\/git\/raw\/master\/%E6%97%A0%E8%AE%BA%E6%80%8E%E4%B9%88%E8%B5%B0%E5%A4%9C%E7%A9%BA%E9%83%BD%E4%BC%9A%E6%9D%A5%E8%BF%BD%E9%80%90%E7%9D%80%E6%88%91.mp3","cover":"https:\/\/bobby285271.coding.net\/p\/img\/d\/img\/git\/raw\/master\/music-background.jpg"}]}});
    </script>
<script type="6b677945121e6806c012d3d9-text/javascript">
            </script>
<script src="https://ajax.cloudflare.com/cdn-cgi/scripts/7089c43e/cloudflare-static/rocket-loader.min.js" data-cf-settings="6b677945121e6806c012d3d9-|49" defer=""></script></body>
</html>

