<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
xmlns:content="http://purl.org/rss/1.0/modules/content/"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
xmlns:atom="http://www.w3.org/2005/Atom"
xmlns:wfw="http://wellformedweb.org/CommentAPI/">
<channel>
<title>Dasyatis - Arch Linux</title>
<link>https://static.bobby285271.top/index.php/tag/Arch-Linux/</link>
<atom:link href="https://static.bobby285271.top/index.php/feed/tag/Arch-Linux/" rel="self" type="application/rss+xml" />
<language>zh-CN</language>
<description></description>
<lastBuildDate>Mon, 17 Feb 2020 16:00:00 +0000</lastBuildDate>
<pubDate>Mon, 17 Feb 2020 16:00:00 +0000</pubDate>
<item>
<title>How to Port Calamares to Arch Linux (en)</title>
<link>https://static.bobby285271.top/index.php/2020/02/18/How-to-Port-Calamares-to-Arch-Linux-en.html</link>
<guid>https://static.bobby285271.top/index.php/2020/02/18/How-to-Port-Calamares-to-Arch-Linux-en.html</guid>
<pubDate>Mon, 17 Feb 2020 16:00:00 +0000</pubDate>
<dc:creator>bobby285271</dc:creator>
<description><![CDATA[This article is for reference ONLY.Calamares is a distribution-independent installer framework. A...]]></description>
<content:encoded xml:lang="zh-CN"><![CDATA[
<blockquote>This article is for reference ONLY.</blockquote><p>Calamares is a distribution-independent installer framework. As distributions like Arch Linux don't provide graphical installer, we can try to adapt Calamares to them. To make things easier, we simply start by trying to provide a <code>pacstrap</code> part for Calamares, which allow users to install a minimal Arch Linux system, then we add the Calamares installer to our Archiso.</p><h2>Getting Started</h2><p>Make sure that you have Git installed, fetch the source code by cloning the Calamares repository, to speed up, add <code>--depth=1</code> option:</p><pre><code>git clone https://github.com/calamares/calamares.git --depth=1
</code></pre><p>Entering the repository, you will find lots of files and directories, don't panic! All you have to focus on are three files/directories: <code>settings.conf</code>, <code>src/branding/</code> and <code>src/modules/</code>. Let's try to deal with them one by one.</p><h2>Step One: <code>settings.conf</code></h2><p>Firstly, you will find something like this:</p><pre><code>sequence:
- show:
  - welcome
  - locale
  - ...
- exec:
  - partition
  - mount
  - ...
- show:
  - finished
</code></pre><p>This is the installation process of Calamares, consisting of the <code>show</code> part and the <code>exec</code> part. Unlike Arch Linux's official install way where users DIY their system from the beginning to the end, users should setup their system in the <code>show</code> part and the <code>exec</code> part should handle the rest of the work then <code>show</code> again to inform user whether the installation work is succeed or not, which is considered more user-friendly. Each part (<code>show</code> and <code>exec</code>) includes several modules like <code>welcome</code>, <code>locale</code> and so on. We will talk about them later.</p><p>Now go to ArchWiki and have a look at the Installation Guide, you will find that some of the modules can be safely removed because when you perform a installation by following the ArchWiki, you never do such things like <code>plymouthcfg</code> (In fact, plymouth is not supported by Arch Linux at all). However, you will need to add some part because Calamares doesn't provide such option, such as a <code>pacstrap</code> part. Simply add the line <code>- pacstrap</code> and do rest of the thing later in step three.</p><pre><code>sequence:
- show:
  - welcome
  - locale
  - keyboard
  - partition
  - users
  - summary
- exec:
  - partition
  - mount
  - pacstrap
  - networkcfg
  - packages
  - machineid
  - fstab
  - locale
  - keyboard
  - localecfg
  - users
  - networkcfg
  - hwclock
  - bootloader
  - umount
- show:
  - finished
</code></pre><p>Let's move on. You will then see some of the boolean variables with notes above each of them. Simply set <code>true</code> or <code>false</code> according to the notes. Leave <code>branding</code> as <code>default</code>, you will configure it in step two.</p><h2>Step Two: <code>src/branding/</code></h2><p>In fact, this step is optional if you don't care about branding at all. The problem is that your users will be faced with something strange like the distro name <code>Fancy GNU/Linux 2020.2 LTS &quot;Turgid Tuba&quot;</code> and the slide show texted <code>This is a customizable QML slideshow.</code> So it is not recommend to skip this step if you want to distribute the Calamares and Archiso to others.</p><p>Navigate to the <code>src/branding/</code> directory, read the <code>README.md</code> carefully, and enter the <code>default/</code> directory. There are two files that you have to pay attention. One of them is <code>branding.desc</code>. These entries should be modified to the actual one:</p><pre><code>strings:
    productName:         &quot;@{NAME}&quot;
    shortProductName:    Arch Linux
    version:             Rolling
    shortVersion:        Rolling
    versionedName:       Arch Linux
    shortVersionedName:  Arch Linux
    bootloaderEntryName: Arch Linux
    productUrl:          https://www.archlinux.org/
    supportUrl:          https://bbs.archlinux.org/
    knownIssuesUrl:      https://bugs.archlinux.org/
    releaseNotesUrl:     https://www.archlinux.org/
</code></pre><p>Another one is <code>show.qml</code>. It is used to control slide shows. Here we only add one page, with the image <code>squid.png</code> (already included in the directory) and text <code>Arch Linux is a lightweight and flexible Linux distribution that tries to Keep It Simple.</code></p><pre><code>    Slide {

        Image {
            id: background
            source: &quot;squid.png&quot;
            width: 200; height: 200
            fillMode: Image.PreserveAspectFit
            anchors.centerIn: parent
        }
        Text {
            anchors.horizontalCenter: background.horizontalCenter
            anchors.top: background.bottom
            text: &quot;Arch Linux is a lightweight and flexible Linux distribution that tries to Keep It Simple.&quot;
            wrapMode: Text.WordWrap
            width: presentation.width
            horizontalAlignment: Text.Center
        }
    }
</code></pre><h2>Step Three: <code>src/modules/</code></h2><p>This is the most difficult part. You should do configurations for all modules listed in <code>settings.conf</code>. In most of the time, you don't have to do programming work, but simply edit the <code>*.conf</code> file. For example, if you want to edit the <code>users</code> module, open <code>src/modules/users.conf</code> and edit it. Here is a sample file:</p><pre><code>---
defaultGroups:
    - users
    - wheel

autologinGroup:  autologin
doAutologin:     true
setRootPassword: true
doReusePassword: true

passwordRequirements:
    nonempty: true
    minLength: -1
    maxLength: -1
    libpwquality:
        - minlen=0
        - minclass=0

allowWeakPasswords: false
allowWeakPasswordsDefault: false
</code></pre><p>For modules you created by yourself, like <code>pactrap</code>, you have to create a folder for it with the same name. Make sure you have already known a little bit about Python and Shell script, now start coding!</p><p>All we have to do is to call the real <code>pactrap</code> command. But it seems that if we really do that, the installation process may failed because of the behavior of Calamares. So we also have to port <code>pacstrap</code> for Calamares later. For now, we just name the script <code>pacstrap_calamares</code> and forget it. Let's create a file <code>main.py</code>.</p><pre><code>#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import subprocess
import libcalamares
from pathlib import Path

root_mount_point = libcalamares.globalstorage.value(&quot;rootMountPoint&quot;)
    
def run():
    &quot;&quot;&quot;
    Installing base filesystem. Please wait! It may take some time!
    &quot;&quot;&quot;

    PACSTRAP = &quot;/usr/bin/pacstrap_calamares&quot;
    PACKAGES = &quot;base grub efibootmgr linux linux-firmware vi nano networkmanager&quot;

    subprocess.call(PACSTRAP.split(' ') + [root_mount_point] + PACKAGES.split(' '))

</code></pre><p>In fact, <code>subprocess</code> can always be used to write Shell script in Python. The only thing you have do is to save command into a string <code>foo</code>, then split it using <code>foo.split(' ')</code>, and put it into <code>subprocess.call()</code>. Here, we call <code>/usr/bin/pacstrap_calamares</code> and ask it to install some basic package <code>base grub efibootmgr linux linux-firmware vi nano networkmanager</code>. When <code>pacstrap_calamares</code> is running, Calamares will show <code>Installing base filesystem. Please wait! It may take some time!</code> on the screen.</p><h2>Step Four: Build Calamares</h2><p>We can build Calamares when we are building Archiso so the build process won't make your system dirty. Assume that you already have a Archiso profile. First, we add the needed packages to <code>packages.x86_64</code>.</p><pre><code>kf5
qt5
boost
kpmcore
yaml-cpp
polkit-qt5
</code></pre><p>Assume that you have entered the chroot environment. To build Calamares, three steps are reqired: <code>cmake</code>, <code>make</code> and <code>make install</code>. Write all the steps down, and put it into <code>airootfs/root/</code>. Here is an example file:</p><pre><code>#/bin/bash
cd /root/
mkdir ./calamares/build/
cd ./calamares/build/
cmake ..
make
make install
mkdir /etc/calamares/
cp -p /root/archlinux-calamares/settings.conf /etc/calamares/
rm -rf /root/archlinux-calamares/ /root/calamares/ /root/build_calamares.sh
pacman -Rscun qt5-doc qt5-examples --noconfirm
</code></pre><p>Now we can ask <code>airootfs/root/customize_airootfs.sh</code> to run this shell script after a chroot environment is entered. Make sure the script is executable.</p><pre><code>cd /root
./build_calamares.sh
</code></pre><p>Almost done! Don't forget to create a <code>pacstrap_calamares</code> file for Calamares. Create a <code>airootfs/usr/bin/pacstrap_calamares</code> file. You don't have to worry about how to fill the file. Someone has already done that for you! And <a href="https://raw.githubusercontent.com/endeavouros-team/install-scripts/master/pacstrap_calamares">here is the file</a>. Thanks for the work done by Endeavour OS team.</p>
]]></content:encoded>
<slash:comments>0</slash:comments>
<comments>https://static.bobby285271.top/index.php/2020/02/18/How-to-Port-Calamares-to-Arch-Linux-en.html#comments</comments>
<wfw:commentRss>https://static.bobby285271.top/index.php/feed/2020/02/18/How-to-Port-Calamares-to-Arch-Linux-en.html</wfw:commentRss>
</item>
</channel>
</rss>