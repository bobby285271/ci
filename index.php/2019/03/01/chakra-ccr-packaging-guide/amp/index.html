<!DOCTYPE html>
<html amp lang="zh-CN" i-amphtml-layout="" i-amphtml-no-boilerplate="" transformed="self;v=1">
<head><meta charset="utf-8"><style amp-runtime="" i-amphtml-version="012004172112280">html{overflow-x:hidden!important}html.i-amphtml-fie{height:100%!important;width:100%!important}html:not([amp4ads]),html:not([amp4ads]) body{height:auto!important}html:not([amp4ads]) body{margin:0!important}body{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%}html.i-amphtml-singledoc.i-amphtml-embedded{-ms-touch-action:pan-y;touch-action:pan-y}html.i-amphtml-fie>body,html.i-amphtml-singledoc>body{overflow:visible!important}html.i-amphtml-fie:not(.i-amphtml-inabox)>body,html.i-amphtml-singledoc:not(.i-amphtml-inabox)>body{position:relative!important}html.i-amphtml-webview>body{overflow-x:hidden!important;overflow-y:visible!important;min-height:100vh!important}html.i-amphtml-ios-embed-legacy>body{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important}html.i-amphtml-ios-embed{overflow-y:auto!important;position:static}#i-amphtml-wrapper{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;margin:0!important;display:block!important}html.i-amphtml-ios-embed.i-amphtml-ios-overscroll,html.i-amphtml-ios-embed.i-amphtml-ios-overscroll>#i-amphtml-wrapper{-webkit-overflow-scrolling:touch!important}#i-amphtml-wrapper>body{position:relative!important;border-top:1px solid transparent!important}#i-amphtml-wrapper+body{visibility:visible}#i-amphtml-wrapper+body .i-amphtml-lightbox-element,#i-amphtml-wrapper+body[i-amphtml-lightbox]{visibility:hidden}#i-amphtml-wrapper+body[i-amphtml-lightbox] .i-amphtml-lightbox-element{visibility:visible}#i-amphtml-wrapper.i-amphtml-scroll-disabled,.i-amphtml-scroll-disabled{overflow-x:hidden!important;overflow-y:hidden!important}amp-instagram{padding:54px 0px 0px!important;background-color:#fff}amp-iframe iframe{box-sizing:border-box!important}[amp-access][amp-access-hide]{display:none}[subscriptions-dialog],body:not(.i-amphtml-subs-ready) [subscriptions-action],body:not(.i-amphtml-subs-ready) [subscriptions-section]{display:none!important}amp-experiment,amp-live-list>[update],amp-share-tracking{display:none}.i-amphtml-jank-meter{position:fixed;background-color:rgba(232,72,95,0.5);bottom:0;right:0;color:#fff;font-size:16px;z-index:1000;padding:5px}amp-list[resizable-children]>.i-amphtml-loading-container.amp-hidden{display:none!important}amp-list[load-more] [load-more-button],amp-list[load-more] [load-more-end],amp-list[load-more] [load-more-failed],amp-list[load-more] [load-more-loading]{display:none}amp-story-page,amp-story[standalone]{min-height:1px!important;display:block!important;height:100%!important;margin:0!important;padding:0!important;overflow:hidden!important;width:100%!important}amp-story[standalone]{background-color:#202125!important;position:relative!important}amp-story-page{background-color:#757575}amp-story .amp-active>div{display:none!important}amp-story-page:not(:first-of-type):not([distance]):not([active]){transform:translateY(1000vh)!important}amp-autocomplete{position:relative!important;display:inline-block!important}amp-autocomplete>input,amp-autocomplete>textarea{padding:0.5rem;border:1px solid rgba(0,0,0,0.33)}.i-amphtml-autocomplete-results,amp-autocomplete>input,amp-autocomplete>textarea{font-size:1rem;line-height:1.5rem}[amp-fx^=fly-in]{visibility:hidden}
/*# sourceURL=/css/ampdoc.css*/[hidden]{display:none!important}.i-amphtml-element{display:inline-block}.i-amphtml-blurry-placeholder{transition:opacity 0.3s cubic-bezier(0.0,0.0,0.2,1)!important}[layout=nodisplay]:not(.i-amphtml-element){display:none!important}.i-amphtml-layout-fixed,[layout=fixed][width][height]:not(.i-amphtml-layout-fixed){display:inline-block;position:relative}.i-amphtml-layout-responsive,[layout=responsive][width][height]:not(.i-amphtml-layout-responsive),[width][height][sizes]:not(.i-amphtml-layout-responsive){display:block;position:relative}.i-amphtml-layout-intrinsic{display:inline-block;position:relative;max-width:100%}.i-amphtml-intrinsic-sizer{max-width:100%;display:block!important}.i-amphtml-layout-container,.i-amphtml-layout-fixed-height,[layout=container],[layout=fixed-height][height]{display:block;position:relative}.i-amphtml-layout-fill,[layout=fill]:not(.i-amphtml-layout-fill){display:block;overflow:hidden!important;position:absolute;top:0;left:0;bottom:0;right:0}.i-amphtml-layout-flex-item,[layout=flex-item]:not(.i-amphtml-layout-flex-item){display:block;position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.i-amphtml-layout-fluid{position:relative}.i-amphtml-layout-size-defined{overflow:hidden!important}.i-amphtml-layout-awaiting-size{position:absolute!important;top:auto!important;bottom:auto!important}i-amphtml-sizer{display:block!important}.i-amphtml-blurry-placeholder,.i-amphtml-fill-content{display:block;height:0;max-height:100%;max-width:100%;min-height:100%;min-width:100%;width:0;margin:auto}.i-amphtml-layout-size-defined .i-amphtml-fill-content{position:absolute;top:0;left:0;bottom:0;right:0}.i-amphtml-layout-intrinsic .i-amphtml-sizer{max-width:100%}.i-amphtml-replaced-content,.i-amphtml-screen-reader{padding:0!important;border:none!important}.i-amphtml-screen-reader{position:fixed!important;top:0px!important;left:0px!important;width:4px!important;height:4px!important;opacity:0!important;overflow:hidden!important;margin:0!important;display:block!important;visibility:visible!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:8px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:12px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:16px!important}.i-amphtml-unresolved{position:relative;overflow:hidden!important}.i-amphtml-select-disabled{-webkit-user-select:none!important;-moz-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.i-amphtml-notbuilt,[layout]:not(.i-amphtml-element){position:relative;overflow:hidden!important;color:transparent!important}.i-amphtml-notbuilt:not(.i-amphtml-layout-container)>*,[layout]:not([layout=container]):not(.i-amphtml-element)>*{display:none}.i-amphtml-ghost{visibility:hidden!important}.i-amphtml-element>[placeholder],[layout]:not(.i-amphtml-element)>[placeholder]{display:block}.i-amphtml-element>[placeholder].amp-hidden,.i-amphtml-element>[placeholder].hidden{visibility:hidden}.i-amphtml-element:not(.amp-notsupported)>[fallback],.i-amphtml-layout-container>[placeholder].amp-hidden,.i-amphtml-layout-container>[placeholder].hidden{display:none}.i-amphtml-layout-size-defined>[fallback],.i-amphtml-layout-size-defined>[placeholder]{position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;z-index:1}.i-amphtml-notbuilt>[placeholder]{display:block!important}.i-amphtml-hidden-by-media-query{display:none!important}.i-amphtml-element-error{background:red!important;color:#fff!important;position:relative!important}.i-amphtml-element-error:before{content:attr(error-message)}i-amp-scroll-container,i-amphtml-scroll-container{position:absolute;top:0;left:0;right:0;bottom:0;display:block}i-amp-scroll-container.amp-active,i-amphtml-scroll-container.amp-active{overflow:auto;-webkit-overflow-scrolling:touch}.i-amphtml-loading-container{display:block!important;pointer-events:none;z-index:1}.i-amphtml-notbuilt>.i-amphtml-loading-container{display:block!important}.i-amphtml-loading-container.amp-hidden{visibility:hidden}.i-amphtml-element>[overflow]{cursor:pointer;position:relative;z-index:2;visibility:hidden}.i-amphtml-element>[overflow].amp-visible{visibility:visible}template{display:none!important}.amp-border-box,.amp-border-box *,.amp-border-box :after,.amp-border-box :before{box-sizing:border-box}amp-pixel{display:none!important}amp-analytics,amp-story-auto-ads{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}html.i-amphtml-fie>amp-analytics{position:initial!important}[visible-when-invalid]:not(.visible),amp-list [fetch-error],form [submit-error],form [submit-success],form [submitting]{display:none}amp-accordion{display:block!important}amp-accordion>section{float:none!important}amp-accordion>section>*{float:none!important;display:block!important;overflow:hidden!important;position:relative!important}amp-accordion,amp-accordion>section{margin:0}amp-accordion>section>:last-child{display:none!important}amp-accordion>section[expanded]>:last-child{display:block!important}
/*# sourceURL=/css/ampshared.css*/</style><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1"><meta name="generator" content="AMP Plugin v1.5.3; mode=reader"><title>Chakra CCR Packaging Guide – Dasyatis</title><link rel="preconnect" href="https://cdn.ampproject.org"><link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js"><script async="" src="https://cdn.ampproject.org/v0.js"></script><style amp-custom="">.wp-block-image{margin-bottom:1em}.wp-block-image amp-img{max-width:100%}.wp-block-code{font-family:Menlo,Consolas,monaco,monospace;font-size:14px;color:#23282d;padding:.8em 1em;border:1px solid #e2e4e7;border-radius:4px}.wp-block-quote{border-left:4px solid #000;margin:0 0 28px;padding-left:1em}.wp-block-quote footer{color:#6c7781;font-size:13px;margin-top:1em;position:relative;font-style:normal}.amp-wp-enforced-sizes{max-width:100%;margin:0 auto}amp-img.amp-wp-enforced-sizes[layout="intrinsic"] > img{object-fit:contain}html{background:#0a89c0}body{background:#fff;color:#353535;font-family:Georgia,"Times New Roman",Times,Serif;font-weight:300;line-height:1.75em}p,ul,figure{margin:0 0 1em;padding:0}a,a:visited{color:#0a89c0}a:hover,a:active,a:focus{color:#353535}blockquote{color:#353535;background:rgba(127,127,127,.125);border-left:2px solid #0a89c0;margin:8px 0 24px 0;padding:16px}blockquote p:last-child{margin-bottom:0}.amp-wp-meta,.amp-wp-header div,.amp-wp-title,.amp-wp-tax-category,.amp-wp-tax-tag,.amp-wp-comments-link,.amp-wp-footer p,.back-to-top{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen-Sans","Ubuntu","Cantarell","Helvetica Neue",sans-serif}.amp-wp-header{background-color:#0a89c0}.amp-wp-header div{color:#fff;font-size:1em;font-weight:400;margin:0 auto;max-width:calc(840px - 32px);padding:.875em 16px;position:relative}.amp-wp-header a{color:#fff;text-decoration:none}.amp-wp-article{color:#353535;font-weight:400;margin:1.5em auto;max-width:840px;overflow-wrap:break-word;word-wrap:break-word}.amp-wp-article-header{align-items:center;align-content:stretch;display:flex;flex-wrap:wrap;justify-content:space-between;margin:1.5em 16px 0}.amp-wp-title{color:#353535;display:block;flex:1 0 100%;font-weight:900;margin:0 0 .625em;width:100%}.amp-wp-meta{color:#696969;display:inline-block;flex:2 1 50%;font-size:.875em;line-height:1.5em;margin:0 0 1.5em;padding:0}.amp-wp-article-header .amp-wp-meta:last-of-type{text-align:right}.amp-wp-article-header .amp-wp-meta:first-of-type{text-align:left}.amp-wp-byline amp-img,.amp-wp-byline .amp-wp-author{display:inline-block;vertical-align:middle}.amp-wp-byline amp-img{border:1px solid #0a89c0;border-radius:50%;position:relative;margin-right:6px}.amp-wp-posted-on{text-align:right}.amp-wp-article-content{margin:0 16px}.amp-wp-article-content ul{margin-left:1em}.amp-wp-article-content amp-img{margin:0 auto}.amp-wp-article-footer .amp-wp-meta{display:block}.amp-wp-tax-category,.amp-wp-tax-tag{color:#696969;font-size:.875em;line-height:1.5em;margin:1.5em 16px}.amp-wp-comments-link{color:#696969;font-size:.875em;line-height:1.5em;text-align:center;margin:2.25em 0 1.5em}.amp-wp-comments-link a{border-style:solid;border-color:#c2c2c2;border-width:1px 1px 2px;border-radius:4px;background-color:transparent;color:#0a89c0;cursor:pointer;display:block;font-size:14px;font-weight:600;line-height:18px;margin:0 auto;max-width:200px;padding:11px 16px;text-decoration:none;width:50%;-webkit-transition:background-color .2s ease;transition:background-color .2s ease}.amp-wp-footer{border-top:1px solid #c2c2c2;margin:calc(1.5em - 1px) 0 0}.amp-wp-footer div{margin:0 auto;max-width:calc(840px - 32px);padding:1.25em 16px 1.25em;position:relative}.amp-wp-footer h2{font-size:1em;line-height:1.375em;margin:0 0 .5em}.amp-wp-footer p{color:#696969;font-size:.8em;line-height:1.5em;margin:0 85px 0 0}.amp-wp-footer a{text-decoration:none}.back-to-top{bottom:1.275em;font-size:.8em;font-weight:600;line-height:2em;position:absolute;right:16px}

/*# sourceURL=amp-custom.css */</style><link rel="canonical" href="../../../../../../index.html%3Fp=1002.html"><script type="application/ld+json">{"@context":"http:\/\/schema.org","publisher":{"@type":"Organization","name":"Dasyatis","logo":"https:\/\/www.bobby285271.top\/wp-content\/plugins\/amp\/assets\/images\/amp-page-fallback-wordpress-publisher-logo.png"},"@type":"BlogPosting","mainEntityOfPage":"https:\/\/www.bobby285271.top\/index.php\/2019\/03\/01\/chakra-ccr-packaging-guide\/","headline":"Chakra CCR Packaging Guide","datePublished":"2019-03-01T08:31:00+08:00","dateModified":"2019-03-01T08:31:00+08:00","author":{"@type":"Person","name":"Bobby Rong"},"image":{"@type":"ImageObject","url":"https:\/\/cn.gravatar.com\/1d4930fdc37d3baf980e8e6e8ffc224e?s=200&d=mm&r=g","width":200,"height":200}}</script></head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="../../../../../../index.html">
									<span class="amp-site-title">
				Dasyatis			</span>
		</a>

					</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">Chakra CCR Packaging Guide</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://cn.gravatar.com/1d4930fdc37d3baf980e8e6e8ffc224e?s=24&amp;d=mm&amp;r=g" alt="Bobby Rong" width="24" height="24" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:24px;height:24px;" i-amphtml-layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">Bobby Rong</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2019-03-01T16:31:00+00:00">
		1年 ago	</time>
</div>
	</header>

	
	<div class="amp-wp-article-content">
		
<blockquote class="wp-block-quote"><p><strong>2020 年更新：</strong>好了现在我大概会一点从零开始打 AUR / CCR 包了，但是整个过程自认为还是有点玄学，不太能整理出来，晚点再说吧（咕）。</p></blockquote>



<p>Chakra 的成功证明了只围绕 KDE 和 Qt 搭建一个简约的系统是完全可行的。但正是因为「简约」这一特性，一些用户需要的软件可能不被包含在我们的官方软件仓库中。<a href="https://ccr.chakralinux.org" target="_blank" rel="nofollow">Chakra 社区软件仓库</a>（CCR）也就因此诞生了，它由社区维护，为所有类型的软件都敞开了大门。</p>



<h2>搜索、安装、升级 CCR 软件包</h2>



<blockquote class="wp-block-quote"><p>老用户请注意：<code>ccr</code> 工具已经被弃用，请转而使用 <code>chaser</code>。</p></blockquote>



<p>Chakra 提供了一个叫 <code>chaser</code> 的工具供用户管理 CCR 软件包。它的一些常见用法如下：</p>



<pre class="wp-block-code"><code>[chakra@localhost ~]$ chaser -h
usage: chaser [-h] [-v] [-b BUILD_DIR]
              {get,install,listupdates,update,search,info} ...

Next-generation community package management for Chakra.

positional arguments:
  {get,install,listupdates,update,search,info}
    get                 download source files here
    install             install a package from the CCR
    listupdates         list available updates
    update              search for and install updates for CCR packages
    search              search CCR packages
    info                display package information

optional arguments:
  -h, --help            show this help message and exit
  -v, --version         show version information and exit
  -b BUILD_DIR, --build-dir BUILD_DIR
                        build packages in BUILD_DIR. default = /tmp/chaser</code></pre>



<h3>搜索</h3>



<p>搜索 CCR 软件包有两种方式，一种是直接访问 <a href="https://ccr.chakralinux.org/" target="_blank" rel="nofollow">CCR</a> 站点并发起搜索，另一种是使用 <code>chaser search</code> 命令，比如搜索 <code>neofetch</code>：</p>



<pre class="wp-block-code"><code>[chakra@localhost ~]$ chaser search neofetch</code></pre>



<p><code>chaser</code> 既会扫描官方软件仓库，也会扫描 CCR。两处符合条件的软件包都会被输出。</p>



<ul><li>如果您没有在其中找到您所需要的包，请考虑阅读下一章节。</li><li>如果您找到的包位于 <code>[core]</code>、<code>[desktop]</code>、<code>[gtk]</code>、<code>[lib32]</code>、<code>[testing]</code> 之一，这意味着您所需的包已经存在于官方软件仓库，请使用 <a href="https://community.chakralinux.org/t/chakra-package-manager-simplified-chinese/7341" target="_blank" rel="nofollow">Pacman</a> 进行后续操作。</li><li>如果您找到的包位于 <code>[ccr]</code>，请继续阅读。</li></ul>



<p>下面可以使用 <code>chaser info</code> 进一步了解软件包信息。</p>



<pre class="wp-block-code"><code>[chakra@localhost ~]$ chaser info neofetch</code></pre>



<p>下面是一个示例输出：</p>



<pre class="wp-block-code"><code>Name           : neofetch
Version        : 5.0.0-1
URL            : https://github.com/dylanaraps/neofetch
Licenses       : MIT
Category       : utils
Votes          : 2
Maintainer     : bobby285271
OutOfDate      : False
Description    : A CLI system information tool written in BASH that supports displaying images.</code></pre>



<p>由于 CCR 活跃用户不多，请务必通过 <code>Version</code> 和 <code>OutOfDate</code> 了解清楚软件包维护情况，如果这个软件包过旧，考虑帮忙维护它（请阅读下一章节）。</p>



<h3>安装</h3>



<p>如果您决定安装，使用 <code>chaser install</code> 命令。<strong>不要</strong>使用 <code>root</code> 运行以下命令，当 <code>chaser</code> 需要管理员权限的时候会要求您输入密码。</p>



<pre class="wp-block-code"><code>[live@localhost ~]$ chaser install neofetch</code></pre>



<p>大致的安装流程如下（以安装 <code>neofetch</code> 为例，部分输出被省略）。</p>



<ul><li>确认构建软件包：请在此处回答 <code>y</code>（是）。</li></ul>



<pre class="wp-block-code"><code>resolving dependencies...
Downloading neofetch

Targets (1) neofetch

:: Proceed with installation? [Y/n]</code></pre>



<ul><li>定制软件包：PKGBUILD 是 Arch Linux 的一大特色，也被 Chakra 很好地继承了下来。感兴趣的请阅读 <a href="https://www.archlinux.org/pacman/PKGBUILD.5.html" target="_blank" rel="nofollow">PKGBUILD 语法</a>，一般用户直接回答 <code>n</code>（否）。</li></ul>



<pre class="wp-block-code"><code>Downloading neofetch
Edit neofetch PKGBUILD with $EDITOR? [Y/n]</code></pre>



<ul><li>构建软件包：此过程全自动，无需用户干预。</li></ul>



<pre class="wp-block-code"><code>==&gt; Making package: neofetch 5.0.0-1
==&gt; Checking runtime dependencies...
==&gt; Checking buildtime dependencies...
==&gt; Retrieving sources...
==&gt; Validating source files with sha256sums...
==&gt; Extracting sources...
==&gt; Entering fakeroot environment...
==&gt; Starting package()...
==&gt; Tidying install...
==&gt; Checking for packaging issue...
==&gt; WARNING: backup entry file not in package : etc/neofetch/config.conf
==&gt; Creating package "neofetch"...
==&gt; Leaving fakeroot environment.
==&gt; Finished making: neofetch 5.0.0-1
==&gt; Installing package neofetch with pacman -U...</code></pre>



<ul><li>确认安装软件包：后续的工作将自动交由 Pacman 完成。请在此处回答 <code>y</code>（是）。</li></ul>



<pre class="wp-block-code"><code>loading packages...
resolving dependencies...
looking for conflicting packages...

Packages (1) neofetch-5.0.0-1

Total Installed Size:  0.26 MiB

:: Proceed with installation? [Y/n] </code></pre>



<ul><li>安装软件包：此过程全自动，无需用户干预。</li></ul>



<pre class="wp-block-code"><code>(1/1) checking keys in keyring                                                                                                                                     [#####################################################################################################] 100%
(1/1) checking package integrity                                                                                                                                   [#####################################################################################################] 100%
(1/1) loading package files                                                                                                                                        [#####################################################################################################] 100%
(1/1) checking for file conflicts                                                                                                                                  [#####################################################################################################] 100%
(1/1) checking available disk space                                                                                                                                [#####################################################################################################] 100%
:: Processing package changes...
(1/1) installing neofetch                                                                                                                                          [#####################################################################################################] 100%
:: Running post-transaction hooks...
(1/1) Arming ConditionNeedsUpdate...</code></pre>



<h3>升级</h3>



<p>使用 <code>chaser listupdates</code> 查看可用的更新，使用 <code>chaser update</code> 检查并应用更新 CCR 软件包。</p>



<h3>移除</h3>



<p>要查看您安装的 CCR 软件包，使用 <code>pacman -Qm</code> 命令。</p>



<blockquote class="wp-block-quote"><p>这个命令可能会输出一些您觉得很陌生的软件包，这很有可能是从官方软件仓库仓库移除且不再受 Chakra 团队支持的包。</p></blockquote>



<p>使用 Pacman 移除您不再需要的包，详见 <a href="https://community.chakralinux.org/t/chakra-package-manager-simplified-chinese/7341" target="_blank" rel="nofollow">这篇文章</a>。</p>



<h2>提交、维护 CCR 软件包（初阶）</h2>



<p>感谢您为 Chakra 做出贡献！接下来，您将了解到如何准备 PKGBUILD，制作源码包并上传到 CCR 上。首先，请先前往 CCR 的 <a href="https://ccr.chakralinux.org/account.php" target="_blank" rel="nofollow">帐户页面</a> 注册一个帐号。</p>



<h3>准备 PKGBUILD：概述</h3>



<p>PKGBUILD 是整个 CCR 包的灵魂所在。要知道的是，所谓的「制作源码包」不过是将 PKGBUILD 和几个补丁捆起来制作一个压缩包罢了。用户试图安装一个 CCR 包，本质上来说，其实是将 PKGBUILD 给下载下来，并执行里面的命令，从而编译安装真正的软件包。</p>



<h4>PKGBUILD 示例</h4>



<p>编写 PKGBUILD 并不是一件容易事，这里提供一个示例文件：</p>



<blockquote class="wp-block-quote"><p>如果您知道分包是什么，请注意：<strong>CCR 不支持分包，一个 PKGBUILD 只能对应一个软件包</strong>。</p></blockquote>



<pre class="wp-block-code"><code># This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

# Maintainer: Your Name &lt;youremail@domain.com&gt;
pkgname=NAME
pkgver=VERSION
pkgrel=1
epoch=
pkgdesc=""
arch=()
url=""
license=('GPL')
groups=()
depends=()
makedepends=()
checkdepends=()
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=
source=("$pkgname-$pkgver.tar.gz"
        "$pkgname-$pkgver.patch")
noextract=()
md5sums=()
validpgpkeys=()

prepare() {
        cd "$pkgname-$pkgver"
        patch -p1 -i "$srcdir/$pkgname-$pkgver.patch"
}

build() {
        cd "$pkgname-$pkgver"
        ./configure --prefix=/usr
        make
}

check() {
        cd "$pkgname-$pkgver"
        make -k check
}

package() {
        cd "$pkgname-$pkgver"
        make DESTDIR="$pkgdir/" install
}</code></pre>



<h4>简要说明</h4>



<p>基本信息：</p>



<ul><li><code>pkgbase</code>： 软件包的名称，名称由小写字母、数字和任意以下字符组成： <code>@ . _ + -</code>；</li><li><code>pkgver</code>：软件包的版本号，应该与软件原作者发布的版本号一致；</li><li><code>pkgrel</code>：发布号，一个正整数，用来区分同一版本软件的多次构建；</li><li><code>epoch</code>：当一个软件的版本编号方式改变，使用此数值进行强制升级。</li></ul>



<p>描述：</p>



<ul><li><code>pkgdesc</code>：软件包描述，合理使用关键字以方便搜索；</li><li><code>arch</code>： PKGBUILD 可以编译和使用的架构（Chakra 仅支持 <code>x86_64</code>） ；</li><li><code>url</code>：软件官方站点的网址；</li><li><code>license</code>：软件发布许可证；</li><li><code>groups</code>：软件包所在的组。</li></ul>



<p>依赖关系：</p>



<ul><li><code>depends</code>：软件的运行时依赖列表；</li><li><code>optdepends</code>：一组不影响软件主要功能，但能提供额外特性的软件包；</li><li><code>makedepends</code>：仅在软件编译时需要的软件包列表；</li><li><code>checkdepends</code>：运行测试组件时需要，而运行时不需要的包列表。</li></ul>



<p>相关性：</p>



<ul><li><code>provides</code>：这个变量说明当前包能提供的功能（或者像 cron、sh 这样的虚包）；</li><li><code>conflicts</code>：与当前软件包发生冲突的包列表；</li><li><code>replaces</code>：会因安装当前包而取代的包列表。</li></ul>



<p>其它：</p>



<ul><li><code>backup</code>：当包被升级或卸载时，应当备份的文件；</li><li><code>options</code>：这个变量允许您重置 <code>makepkg</code> 的部分默认行为；</li><li><code>install</code>：<code>.install</code> 脚本的名称，应该和 <code>pkgname</code> 相同；</li><li><code>changelog</code>：软件包 changelog 的名称。</li></ul>



<p>源码：</p>



<ul><li><code>source</code>：构建软件包时需要的文件列表；</li><li><code>noextract</code>：一些列举于 <code>source</code> 中，但不需要在运行 <code>makepkg</code> 时解包的文件；</li><li><code>validpgpkeys</code>：PGP 指纹列表；</li></ul>



<p>完整性：</p>



<ul><li><code>md5sums</code>：<code>source</code> 列表文件中的 128 位 MD5 校验和；</li><li><code>sha1sums</code>：<code>source</code> 列表文件中 160 位 SHA-1 校验和；</li><li><code>sha224sums</code>、<code>sha256sums</code>、<code>sha384sums</code>、<code>sha512sums</code>：<code>source</code> 列表文件中224、256、384 或 512 位 SHA-2 校验和。</li></ul>



<p>想要了解更多，可以阅读 ArchWiki 上的 <a href="https://wiki.archlinux.org/index.php/PKGBUILD" target="_blank" rel="nofollow">相关页面</a>。</p>



<h3>准备 PKGBUILD：从零开始（进阶）</h3>



<p>准备好大干一场？如果您打算从零开始编写一个 PKGBUILD，建议继续阅读以下文章：</p>



<ul><li><a href="https://wiki.archlinux.org/index.php/Arch_package_guidelines" target="_blank" rel="nofollow">AUR 打包准则</a>（对 CCR 也是同样适用的）；</li><li><a href="https://www.archlinux.org/pacman/PKGBUILD.5.html" target="_blank" rel="nofollow">PKGBUILD 官方手册</a>。</li></ul>



<p>请确认您已经彻底了解清楚您所维护的软件包<strong>依赖什么包</strong>以及<strong>如何编译安装</strong>，否则还是建议先往下阅读。</p>



<h3>准备 PKGBUILD：从外部导入</h3>



<p>要知道现实情况是：CCR 的成熟程度远远落后于 AUR，和 <a href="https://kaos-community-packages.github.io/" target="_blank" rel="nofollow">KCP</a>（KaOS 社区软件仓库）差不多。AUR 的生态就摆在那里，<strong>几乎所有原生支持 Linux 的应用程序都能在 AUR 找到对应的软件包</strong>。而 KaOS 的定位和 Chakra 类似，也是围绕 KDE 和 Qt 搭建的发行版。所以说，在大部分情况下是没有必要自己造轮子的。<strong>有些轮子说不定 Chakra 团队已经为您造好了，在 Chakra 官方软件仓库里，不要重复提交这些软件包！</strong></p>



<p>请从 <strong>Arch Linux 官方软件仓库 &amp; AUR</strong> 和 <strong>KaOS 官方软件仓库 &amp; KCP</strong> 两个来源选择一个，并继续阅读下面的教程。</p>



<h4>Arch Linux 官方软件仓库 &amp; AUR</h4>



<p>前往 <a href="https://www.archlinux.org/packages/" target="_blank" rel="nofollow">Arch Linux 软件包页面</a> 和 <a href="https://aur.archlinux.org/" target="_blank" rel="nofollow">AUR 首页</a> 发起搜索，直到您找到您打算提交到 CCR 的软件包。点击软件包名进入软件包详情页，定位到页面右侧的「Package Actions」方框：</p>



<figure class="wp-block-image"><amp-img class="lazyload amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" data-src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/1.png" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;75&quot; width=&quot;75&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img class="lazyload" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75"></noscript></amp-img></figure>
<!--noscript--><amp-img src="https://i1.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/1.png?w=640&amp;ssl=1" alt="" width="640" height="360" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;360&quot; width=&quot;640&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img src="https://i1.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/1.png?w=640&amp;ssl=1" alt="" width="640" height="360" class=""></noscript></amp-img><!--/noscript-->



<figure class="wp-block-image"><amp-img class="lazyload amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" data-src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/2.png" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;75&quot; width=&quot;75&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img class="lazyload" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75"></noscript></amp-img></figure>
<!--noscript--><amp-img src="https://i0.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/2.png?w=640&amp;ssl=1" alt="" width="640" height="360" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;360&quot; width=&quot;640&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img src="https://i0.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/2.png?w=640&amp;ssl=1" alt="" width="640" height="360" class=""></noscript></amp-img><!--/noscript-->



<p>对于 AUR 软件包页面，选择「View PKGBUILD」，当页面加载完毕后还需要点击「summary」链接前往 Git 仓库概览页面。</p>



<p>对于 Arch Linux 官方软件包，直接选择「Source Files」。</p>



<p>AUR 的软件包是一个软件包对应一个 Git 仓库的，而 Arch Linux 官方软件包则是 [core]、[extra] 仓库中的<strong>所有软件包</strong>放一个 Git 仓库，[community]、[multilib] 仓库中的<strong>所有软件包</strong>放另一个 Git 仓库。为了效率最大化，对于 AUR 包我们会选择 Clone 整个 Git 仓库，而官方软件包我们会选择逐个文件拷贝。</p>



<p>对于 AUR 软件包，找到 Clone 这一栏，下面有一个地址，将它复制下来：</p>



<figure class="wp-block-image"><amp-img class="lazyload amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" data-src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/3.png" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;75&quot; width=&quot;75&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img class="lazyload" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75"></noscript></amp-img></figure>
<!--noscript--><amp-img src="https://i1.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/3.png?w=640&amp;ssl=1" alt="" width="640" height="360" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;360&quot; width=&quot;640&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img src="https://i1.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/3.png?w=640&amp;ssl=1" alt="" width="640" height="360" class=""></noscript></amp-img><!--/noscript-->



<p>打开终端，输入 <code>git clone &lt;刚刚复制的 URL 地址&gt; --depth=1</code>，例如：</p>



<pre class="wp-block-code"><code>git clone https://aur.archlinux.org/wps-office.git/ --depth=1</code></pre>



<p>至于 Arch Linux 官方软件包，新建一个文件夹（名字随意），然后回到浏览器，<strong>逐个文件</strong>点击文件名旁边的「plain」链接（如图所示），如果是文本文件复制一下，在刚刚新建的文件夹新建一个<strong>同样名称</strong>的文件（千万不要随意改名），将文本粘贴下去。</p>



<figure class="wp-block-image"><amp-img class="lazyload amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" data-src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/4.png" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;75&quot; width=&quot;75&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img class="lazyload" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75"></noscript></amp-img></figure>
<!--noscript--><amp-img src="https://i1.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/4.png?w=640&amp;ssl=1" alt="" width="640" height="360" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;360&quot; width=&quot;640&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img src="https://i1.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/4.png?w=640&amp;ssl=1" alt="" width="640" height="360" class=""></noscript></amp-img><!--/noscript-->



<p>至于二进制文件，浏览器应该会弹出下载窗口，将文件下载后放入文件夹中。</p>



<p>记得检查文件权限是否正常，如果发现文件权限和浏览器中「Mode」显示的是否一致。如果不一致，使用 <code>chmod</code> 修正妥当（<a href="http://linux.vbird.org/linux_basic/0210filepermission.php#chmod" target="_blank" rel="nofollow">这里</a> 有这个命令相关的介绍）。</p>



<h4>KaOS 官方软件仓库 &amp; KCP</h4>



<p>和前面 Arch Linux 官方软件仓库 &amp; AUR 大同小异。<a href="https://kaosx.us/packages/" target="_blank" rel="nofollow">KaOS 软件包页面</a> 和 <a href="https://kaos-community-packages.github.io/" target="_blank" rel="nofollow">KCP</a> 同样提供了搜索框，发起搜索后进入软件包详情页。</p>



<p>同样，官方包建议逐个文件获取，点击右栏的「Source Files」，剩下的操作估计大家很熟悉了，毕竟 GitHub 大家都用过，逐个查看「Raw」文件即可。</p>



<figure class="wp-block-image"><amp-img class="lazyload amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" data-src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/5.png" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;75&quot; width=&quot;75&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img class="lazyload" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75"></noscript></amp-img></figure>
<!--noscript--><amp-img src="https://i0.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/5.png?w=640&amp;ssl=1" alt="" width="640" height="360" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;360&quot; width=&quot;640&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img src="https://i0.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/5.png?w=640&amp;ssl=1" alt="" width="640" height="360" class=""></noscript></amp-img><!--/noscript-->



<p>KCP 包可以整个仓库 Clone 下来（原因同 AUR），点击右上角的「View on GitHub」，后面的我也不再多说了，依然是 <code>git clone &lt;刚刚复制的 URL 地址&gt; --depth=1</code>。</p>



<figure class="wp-block-image"><amp-img class="lazyload amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" data-src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/6.png" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;75&quot; width=&quot;75&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img class="lazyload" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75"></noscript></amp-img></figure>
<!--noscript--><amp-img src="https://i2.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/6.png?w=640&amp;ssl=1" alt="" width="640" height="360" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;360&quot; width=&quot;640&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img src="https://i2.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/6.png?w=640&amp;ssl=1" alt="" width="640" height="360" class=""></noscript></amp-img><!--/noscript-->



<h3>准备 PKGBUILD：收尾 &amp; 检查工作</h3>



<p><strong>这一步很关键，一定要重视！</strong></p>



<p>上一步完成后，我们得到了一个文件夹，里面有些什么取决于您选择的包，大多数情况下里面可能只有一个 <code>PKGBUILD</code> 文件。没关系，<strong>反正一定要有 PKGBUILD</strong>，剩下的无需我们来检查。再次强调，PKGBUILD 非常关键，所以我们一定要进行检查。</p>



<p>这里是一份 <code>PKGBUILD</code>：</p>



<pre class="wp-block-code"><code># Maintainer: Jan de Groot &lt;jgc@archlinux.org&gt;

pkgname=xorg-xprop
pkgver=1.2.3
pkgrel=1
pkgdesc="Property displayer for X"
arch=(x86_64)
url="https://xorg.freedesktop.org/"
license=('custom')
depends=('libx11')
makedepends=('xorg-util-macros')
groups=('xorg-apps' 'xorg')
source=(https://xorg.freedesktop.org/archive/individual/app/xprop-${pkgver}.tar.bz2{,.sig})
sha512sums=('ad7987fec11ae19b7adc3b0f683fc393e95155f3b6c753d1d8744aedcfb360452eee5735a4c380152b286905931515f3e1a28676b5531001eb8dd93b7249916a'
            'SKIP')
validpgpkeys=('4A193C06D35E7C670FA4EF0BA2FB9E081F2D130E') # "Alan Coopersmith &lt;alan.coopersmith@oracle.com&gt;"

build() {
  cd xprop-${pkgver}
  ./configure --prefix=/usr
  make
}

package() {
  cd xprop-${pkgver}
  make DESTDIR="${pkgdir}" install
  install -m755 -d "${pkgdir}/usr/share/licenses/${pkgname}"
  install -m644 COPYING "${pkgdir}/usr/share/licenses/${pkgname}/"
}</code></pre>



<p>聪明人看完第一行就应该知道这份 <code>PKGBUILD</code> 是从 Arch Linux 官方仓库上抓取下来的。如果您刚才「 简要说明」，大概就知道我们要重点检查什么了。</p>



<h4>依赖关系</h4>



<p>首先是 <code>depends</code> 和 <code>makedepends</code>，这两项都是针对 Arch Linux 来写的。例如说一个包依赖 <code>foo</code>，到了 Chakra 这边，可能会有这几种情况：</p>



<ul><li>Chakra 官方软件仓库正好有 <code>foo</code>，提供的是同样的功能；</li><li>Chakra 官方软件仓库没有 <code>foo</code>，但 CCR 有；</li><li>Chakra 官方软件仓库或 CCR 提供了提供同样功能，但包名不同的 <code>foo1</code>；</li><li>Chakra 官方软件仓库或 CCR 不提供 <code>foo</code>。</li></ul>



<p>第一、二种情况可以直接给过不用管，因为 <code>chaser</code> 会自动从官方软件仓库和 CCR 获取相应的依赖。</p>



<p>第三种情况要小心一点，并不是所有情况下简单地将 <code>foo</code> 改成 <code>foo1</code> 就可以的，看一下下面这个案例：</p>



<figure class="wp-block-image"><amp-img class="lazyload amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" data-src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/7.png" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;75&quot; width=&quot;75&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img class="lazyload" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75"></noscript></amp-img></figure>
<!--noscript--><amp-img src="https://i1.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/7.png?w=640&amp;ssl=1" alt="" width="640" height="360" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;360&quot; width=&quot;640&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img src="https://i1.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/7.png?w=640&amp;ssl=1" alt="" width="640" height="360" class=""></noscript></amp-img><!--/noscript-->



<p>注意到在 Arch Linux 这里同时存在 <code>openssl</code> 和 <code>openssl-1.0</code> 两个软件包，观察版本号，我们知道后者是为了兼容性而单独打包的。<code>openssl</code> 的版本号（截至 20190201）是 1.1.1.a-1，<code>openssl-1.0</code> 则是 1.0.2.q-1。</p>



<p>接下来看看 AUR 里 <code>wps-office</code> 这个包：</p>



<figure class="wp-block-image"><amp-img class="lazyload amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" data-src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/8.png" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;75&quot; width=&quot;75&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img class="lazyload" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75"></noscript></amp-img></figure>
<!--noscript--><amp-img src="https://i0.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/8.png?w=640&amp;ssl=1" alt="" width="640" height="360" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;360&quot; width=&quot;640&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img src="https://i0.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/8.png?w=640&amp;ssl=1" alt="" width="640" height="360" class=""></noscript></amp-img><!--/noscript-->



<p>它依赖的是 <code>openssl-1.0</code>。我们可以搜索 Chakra 官方软件仓库（省略部分输出）：</p>



<pre class="wp-block-code"><code>[chakra@localhost ~]$ pacman -Ss openssl
lib32/lib32-openssl 1.0.2.q-1
    The Open Source toolkit for Secure Sockets Layer and Transport Layer Security (32-bit)
core/openssl 1.0.2.q-1 [已安装]
    The Open Source toolkit for Secure Sockets Layer and Transport Layer Security
core/perl-crypt-openssl-bignum 0.04-3
    OpenSSL's multiprecision integer arithmetic
core/perl-crypt-openssl-random 0.04-8
    Interface to OpenSSL PRNG methods
core/perl-crypt-openssl-rsa 0.28-2
    Interface to OpenSSL RSA methods
core/perl-net-ssleay 1.63-1
    Perl extension for using OpenSSL
core/pkcs11-helper 1.25.1-1
    A library that simplifies the interaction with PKCS11 providers for end-user applications using a simple API and optional OpenSSL engine
core/python2-characteristic 14.3.0-1
    Service identity verification for pyOpenSSL
core/python2-service-identity 17.0.0-1
    Service identity verification for pyOpenSSL
core/python3-characteristic 14.3.0-1
    Service identity verification for pyOpenSSL
core/python3-service-identity 17.0.0-1
    Service identity verification for pyOpenSSL
core/tls 1.6.7-1
    OpenSSL extension to Tcl
desktop/python2-ndg-httpsclient 0.4.3-1
    Provides enhanced HTTPS support for httplib and urllib2 using PyOpenSSL
desktop/python2-pyopenssl 17.3.0-1
    Python2 wrapper module around the OpenSSL library
desktop/python3-ndg-httpsclient 0.4.3-1
    Provides enhanced HTTPS support for httplib and urllib2 using PyOpenSSL
desktop/python3-pyopenssl 17.3.0-1
    Python3 wrapper module around the OpenSSL library
[chakra@localhost ~]$</code></pre>



<p>这就是所有的搜索结果了，有 <code>openssl</code> 却没有 <code>openssl-1.0</code>，但是要注意 Chakra 提供的 <code>openssl</code> 版本是 1.0.2.q-1，和 Arch 中 <code>openssl-1.0</code> 是一致的。从中我们可以得出以下信息：</p>



<p>Chakra 是半滚动更新发行版，更新一般来说会滞后于 Arch Linux，Chakra 的 OpenSSL 打包落后于 Arch Linux，所以目前来说我们要将 <code>PKGBUILD</code> 文件中的 <code>openssl-1.0</code> 修改为 <code>openssl</code>，但当 Chakra 将 <code>openssl</code> 升级到 1.1+ 之后，我们要实时监测 Chakra 动态，做好两手准备：</p>



<ul><li>如果 <code>openssl-1.0</code> 可用，我们要重新打包 <code>wps-office</code>，将 PKGBUILD 改回 <code>openssl-1.0</code>；</li><li>如果 Chakra 不提供 <code>openssl-1.0</code>，我们得为 <code>openssl-1.0</code> 打包并提交到 CCR。</li></ul>



<p>注意：在这个案例中，只要 Chakra 的 <code>openssl</code> 不更新，用户就不能提前将 <code>openssl-1.0</code> 提交到 CCR，因为<strong>它和官方源所提供的重复了</strong>。</p>



<p>第四种情况，您需要前往<strong>您刚刚所选的来源</strong>（<strong>Arch Linux 官方软件仓库 &amp; AUR</strong> 或 <strong>KaOS 官方软件仓库 &amp; KCP</strong>），按照上面提供的步骤，获取这个依赖包的相关文件，在稍后一起进行打包。</p>



<h4>PGP 密钥</h4>



<p>如果您从 Arch Linux 或 KaOS 官方软件仓库获取软件包的要特意留意 <code>validpgpkeys</code> 这一项，如果有所填写，要注意的是，Charka 的 <code>chakra-keyring</code> 软件包只提供了 Chakra 维护者的签名，没有 Arch Linux 或 KaOS 的。这样会导致打包失败，因为打包工具 <code>makepkg</code> 是会检查 PGP 密钥的。</p>



<p>规避检查很简单，将 <code>validpgpkeys</code> 所在的那一行删掉。当然也别忘了将相关的文件删掉，还是上面 <code>xorg-xprop</code> 的那个例子：</p>



<pre class="wp-block-code"><code>...
source=(https://xorg.freedesktop.org/archive/individual/app/xprop-${pkgver}.tar.bz2{,.sig})
sha512sums=('ad7987fec11ae19b7adc3b0f683fc393e95155f3b6c753d1d8744aedcfb360452eee5735a4c380152b286905931515f3e1a28676b5531001eb8dd93b7249916a'
            'SKIP')
validpgpkeys=('4A193C06D35E7C670FA4EF0BA2FB9E081F2D130E') # "Alan Coopersmith &lt;alan.coopersmith@oracle.com&gt;"
...</code></pre>



<p>在删除下面这一行之后：</p>



<pre class="wp-block-code"><code>validpgpkeys=('4A193C06D35E7C670FA4EF0BA2FB9E081F2D130E') # "Alan Coopersmith &lt;alan.coopersmith@oracle.com&gt;"</code></pre>



<p>我们留意到 <code>source</code> 那一行，<code>{,.sig}</code> 意味着它同时包含了两个文件：<code>xprop-${pkgver}.tar.bz2</code> 和 <code>xprop-${pkgver}.tar.bz2.sig</code>，后者是用于验证密钥的，删除它。</p>



<p>而 <code>sha512sums</code> 那里，所有的检验值都和 <code>source</code> 的文件逐一对应，所以我们得把 <code>xprop-${pkgver}.tar.bz2.sig</code> 的校验值给相应地删除，即使它是 <code>SKIP</code>，意为「跳过校验值检查」。</p>



<p>这个文件最终被修改成了这样：</p>



<pre class="wp-block-code"><code># Maintainer: Jan de Groot &lt;jgc@archlinux.org&gt;

pkgname=xorg-xprop
pkgver=1.2.3
pkgrel=1
pkgdesc="Property displayer for X"
arch=(x86_64)
url="https://xorg.freedesktop.org/"
license=('custom')
depends=('libx11')
makedepends=('xorg-util-macros')
groups=('xorg-apps' 'xorg')
source=(https://xorg.freedesktop.org/archive/individual/app/xprop-${pkgver}.tar.bz2)
sha512sums=('ad7987fec11ae19b7adc3b0f683fc393e95155f3b6c753d1d8744aedcfb360452eee5735a4c380152b286905931515f3e1a28676b5531001eb8dd93b7249916a')

build() {
  cd xprop-${pkgver}
  ./configure --prefix=/usr
  make
}

package() {
  cd xprop-${pkgver}
  make DESTDIR="${pkgdir}" install
  install -m755 -d "${pkgdir}/usr/share/licenses/${pkgname}"
  install -m644 COPYING "${pkgdir}/usr/share/licenses/${pkgname}/"
}</code></pre>



<h4>其它</h4>



<p>如果您是从外部导入的软件包，案例来说您是无需检查校验值的，如果是自己创建的软件包就一定要检查校验值了：打开 Konsole，使用 <code>cd</code> 命令进入您的文件夹，然后执行 <code>updpkgsums</code> 命令即可。</p>



<p>另外我们还建议您将 Maintainer 后面的姓名和邮箱改成您自己的。</p>



<h4>亲自测试（建议）</h4>



<p>打开 Konsole，使用 <code>cd</code> 命令进入您的文件夹，然后执行 <code>makepkg</code> 命令。 如果 <code>PKGBUILD</code> 没有错误，将会生成一个包，但是如果 <code>PKGBUILD</code> 被破坏或未完成，它将抛出一个错误。</p>



<p><code>makepkg</code> 的用法如下：</p>



<pre class="wp-block-code"><code>用法：/usr/bin/makepkg [选项]

选项：
  -A, --ignorearch      忽略不完整的 arch 字段 (位于 PKGBUILD 中)
  -c, --clean           编译后清理工作文件
  -C, --cleanbuild      在编译软件包之前删除 $srcdir/ 文件夹
  -d, --nodeps          跳过所有依赖关系检查
  -e, --noextract       不解压源文件 (使用现存的 $srcdir/ 目录)
  -f, --force           覆盖现存的软件包
  -g, --geninteg        为源码文件生成完整性检查值
  -h, --help            显示本帮助信息并退出
  -i, --install         成功编译后安装软件包
  -L, --log             记录软件包编译过程
  -m, --nocolor         禁止彩色输出信息
  -o, --nobuild         仅下载和解压缩文件
  -p &lt;文件&gt;             使用另外的编译脚本 (而不是 'PKGBUILD' ) 
  -r, --rmdeps          编译成功后删除安装的依赖关系
  -R, --repackage       不编译而重新打包软件包内容
  -s, --syncdeps        使用 pacman 安装缺失的依赖关系
  -S, --source          不下载源文件只生成仅包含源的包
  -V, --version         显示版本信息并退出
  --allsource           只生成源码包 (包括有已下载的源码) 
  --check               运行 check() 函数 (包含于 PKGBUILD 中)
  --config &lt;文件&gt;       使用另外的配置文件 (而不是 '/etc/makepkg.conf')
  --holdver             不升级版本控制系统源
  --key &lt;密匙&gt;          指定签名 gpg 使用的密匙而不用默认密匙
  --noarchive           不生成软件包归档
  --nocheck             不执行 check() 函数在 PKGBUILD 中
  --noprepare           不执行 prepare() 函数在 PKGBUILD 中
  --nosign              不为该软件包创建签名
  --packagelist         只列出将会产生的包，不带PKGEXT
  --printsrcinfo        打印出生成的 SRCINFO 并退出
  --sign                使用 gpg 签名生成的软件包
  --skipchecksums       不验证源文件的检验值
  --skipinteg           不对源文件执行任何验证检查
  --skippgpcheck        不验证有 PGP 签名的源文件
 --verifysource         下载源文件(如果需要)并进行完整性检查

这些选项可以传递给 pacman：
  --asdeps              作为依赖安装
  --needed              不重装已是最新的目标软件包
  --noconfirm           当解决依赖关系时不询问确认
  --noprogressbar       下载文件时不显示进度条

如果没有指定 -p，makepkg 将寻找 'PKGBUILD'</code></pre>



<p>如果运行 <code>makepkg</code> 成功，在您工作的目录下将会生成一个名为 <code>$pkgname-$pkgver.pkg.tar.gz</code> 的新文件。这个文件可以使用 <code>pacman -U</code> 或 <code>pacman -A</code> 安装。如果包看起来是正确的，那您的工作就完成了。</p>



<h4>一个实用的检查工具（建议）</h4>



<p>Namcap 是 Arch Linux 推荐的检查工具，它将会做以下工作：</p>



<ul><li>检查 PKGBUILD 文件里的一些常见错误；</li><li>用 <code>ldd</code> 扫描包中所有的ELF文件，自动报告缺失或可去除的依赖；</li><li>启发式搜寻缺失或冗余的依赖。</li></ul>



<p>要养成用 Namcap 检查包的习惯，以避免提交包后再做修复的麻烦。</p>



<p>打开 Konsole，使用 <code>cd</code> 命令进入您的文件夹，然后执行：</p>



<pre class="wp-block-code"><code>namcap PKGBUILD</code></pre>



<h3>制作源码包</h3>



<p>后面的步骤都很简单了！打开 Konsole，使用 <code>cd</code> 命令进入您的文件夹，执行以下命令：</p>



<pre class="wp-block-code"><code>makepkg --source</code></pre>



<p>这个命令实际上就是将文件夹里的文件打成一个包，但为了确认您的 PKGBUILD 中的校验值准确无误，PKGBUILD 中 <code>source</code> 一栏所有文件都会被下载下来以校验完整性，耐心等待就好。</p>



<p>输出内容大概是：</p>



<pre class="wp-block-code"><code>==&gt; 正在进入 fakeroot 环境...
==&gt; 正在创建源码包...
  -&gt; 正在添加 PKGBUILD...
  -&gt; 正在生成 .SRCINFO 文件...
  -&gt; 正在压缩源码包...
==&gt; 正在离开 fakeroot 环境。
==&gt; 源代码包已创建：foo</code></pre>



<h3>将源码包上传到 CCR</h3>



<p>请确认您已经登录 CCR 帐户，接下来访问 <a href="https://ccr.chakralinux.org/pkgsubmit.php" target="_blank" rel="nofollow">上传页面</a>，选择软件包分类，接下来选择源码包，源码包应该位于您的文件夹中，包名应该是 <code>$pkgname-$pkgver.src.tar.gz</code>。</p>



<figure class="wp-block-image"><amp-img class="lazyload amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" data-src="https://bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/9.png" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;75&quot; width=&quot;75&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img class="lazyload" src="https://cdn.jsdelivr.net/gh/mirai-mamori/web-img/loadimg/inload.svg" alt="" width="75" height="75"></noscript></amp-img></figure>
<!--noscript--><amp-img src="https://i0.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/9.png?w=640&amp;ssl=1" alt="" width="640" height="360" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg height=&quot;360&quot; width=&quot;640&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; version=&quot;1.1&quot;/>"></i-amphtml-sizer><noscript><img src="https://i0.wp.com/bobby285271.coding.net/p/img/d/img/git/raw/master/ccr/9.png?w=640&amp;ssl=1" alt="" width="640" height="360" class=""></noscript></amp-img><!--/noscript-->



<p>点击「上传」即可。如果 CCR 里面本身没有这个包或这个包是一个无人维护的包（孤儿包），您将会成为维护者。CCR 里面旧版本的软件包将会被您的新软件包取代。如果这个包已经有维护者，CCR 会拒绝您的提交。如果您发现 CCR 里的包已经被标记为「过期」一段时间而维护者没有采取任何动作，您可以联系 Chakra 团队将该包重置为无人维护状态。</p>
	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: <a href="../../../../../../linux/index.html" rel="category tag">Linux</a>	</div>

	<div class="amp-wp-meta amp-wp-tax-tag">
		Tags: <a href="../../../../../tag/ccr/index.html" rel="tag">CCR</a>, <a href="../../../../../tag/chakra/index.html" rel="tag">Chakra</a>, <a href="../../../../../tag/guide/index.html" rel="tag">Guide</a>, <a href="../../../../../tag/linux/index.html" rel="tag">Linux</a>, <a href="../../../../../tag/packaging/index.html" rel="tag">Packaging</a>	</div>
		<div class="amp-wp-meta amp-wp-comments-link">
		<a href="../../../../../../index.html%3Fp=1002.html#respond">
			Leave a Comment		</a>
	</div>
	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>Dasyatis</h2>
		<a href="index.html#top" class="back-to-top">Back to top</a>
	</div>
</footer>


	<amp-pixel src="https://pixel.wp.com/g.gif?v=ext&amp;j=1%3A8.4.2&amp;blog=172618889&amp;post=1002&amp;tz=8&amp;srv=www.bobby285271.top&amp;host=www.bobby285271.top&amp;rand=RANDOM&amp;ref=DOCUMENT_REFERRER" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:1px;height:1px;" i-amphtml-layout="fixed"></amp-pixel>
	

</body></html>
